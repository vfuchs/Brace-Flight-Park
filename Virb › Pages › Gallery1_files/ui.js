(function($){virb.trigger=function(path,args){if(!args){args=[];}
$(document).trigger(path,args);}
virb.log=function(){if(virb.config.debug){var args=Array.prototype.slice.call(arguments);try{log=Function.prototype.bind.call(console.log,console);log.apply(this,args);}catch(e){}}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1);};String.prototype.toUnderscore=function(){return this.replace(/([A-Z])/g,function($1){return"_"+$1.toLowerCase();}).slice(1);};String.prototype.toCamel=function(){return this.replace(/(\_[a-z])/g,function($1){return $1.toUpperCase().replace('_','');});};String.prototype.toClass=function(){return this.toCamel().capitalize();};String.prototype.pad=function(length){var str=''+this;while(str.length<length){str='0'+str;}
return str;};String.prototype.slugify=function(whitelist){var slug=this.replace(/ /g,'-').toLowerCase();if(!whitelist){var whitelist='-_\/';}
return slug.alphaNumeric(whitelist);};String.prototype.alphaNumeric=function(whitelist){var whitelistString="a-zA-Z0-9";if(whitelist){whitelistString+=whitelist;}
var regex=new RegExp("[^"+whitelistString+"]+","g");var text=this.replace(regex,'');return text;};String.prototype.truncate=function(length){var str=''+this;if(str.length>length){return str.substring(0,length)+'&hellip;';}
return str;};Number.prototype.pad=String.prototype.pad;Date.prototype.days={0:'Sunday',1:'Monday',2:'Tuesday',3:'Wednesday',4:'Thursday',5:'Friday',6:'Saturday'};Date.prototype.months={0:'January',1:'February',2:'March',3:'April',4:'May',5:'June',6:'July',7:'August',8:'September',9:'October',10:'November',11:'December'};Date.prototype.setFromAtom=function(atom){virb.log("atom raw: "+atom);var atomSplit=atom.split('T');var dateSplit=atomSplit[0].split('-');var timeOffsetSplit=atomSplit[1].split('+');if(!timeOffsetSplit[1]){timeOffsetSplit=atomSplit[1].split('-');}
var timeSplit=timeOffsetSplit[0].substr(0,8).split(':');var timezone=timeOffsetSplit[1];this.setDateTime(dateSplit[0],dateSplit[1],dateSplit[2],timeSplit[0],timeSplit[1],timeSplit[2]);return this;};Date.prototype.setFromISO=function(iso){var isoSplit=iso.split(' ');var dateSplit=isoSplit[0].split('-');var timeSplit=isoSplit[1].split(':');var timezone=isoSplit[2];this.setDateTime(dateSplit[0],dateSplit[1],dateSplit[2],timeSplit[0],timeSplit[1],timeSplit[2]);return this;};Date.prototype.setFromYMD=function(date){var dateSplit=date.split('-');this.setDateTime(dateSplit[0],dateSplit[1],dateSplit[2]);return this;};Date.prototype.setDateTime=function(year,month,day,hours,minutes,seconds,milliseconds){if(year){this.setFullYear(year);}
if(month){this.setMonth(month-1);}
if(day){this.setDate(day);}
if(hours){this.setHours(hours);}
if(minutes){this.setMinutes(minutes);}
if(seconds){this.setSeconds(seconds);}
if(milliseconds){this.setMilliseconds(milliseconds);}};Date.prototype.setReplacements=function(){var self=this;this.replacements={D:self.days[self.getDay()].slice(0,3),d:self.getDate().pad(2),j:self.getDate(),l:self.days[self.getDay()],F:self.months[self.getMonth()],M:self.months[self.getMonth()].slice(0,3),m:(self.getMonth()+1).pad(2),n:self.getMonth()+1,Y:self.getFullYear(),y:self.getFullYear().toString().slice(-2),G:self.getHours(),H:function(){var hours=self.getHours();if(hours>12){hours=hours-12;}
return hours.pad(2);},g:function(){var hours=self.getHours();if(hours>12){hours=hours-12;}
return hours;},i:self.getMinutes().pad(2),s:self.getSeconds(),a:self.getMeridiem(),A:self.getMeridiem().toUpperCase()};};Date.prototype.format=function(format){this.setReplacements();var formattedString='';for(var i=0;i<format.length;i++){var newCharacter=character=format.charAt(i);$.each(this.replacements,function(index,value){if(character.search(index)>=0){if(typeof value=='function'){newCharacter=character.replace(index,value());}else{newCharacter=character.replace(index,value);}}});formattedString+=newCharacter;}
return formattedString;};Date.prototype.getMeridiem=function(){if(this.getHours()>11){return'pm';}else{return'am';}};var Crumbnav=function(){return this.each(function(){Crumbnav.init($(this));});};Crumbnav.init=function($navObj){this.selectedIndex=0;this.objs={navObj:$navObj,listObj:$navObj.find('li,'),linkObj:$navObj.find('li').find('a')};this.currentHash=false;this.objs.linkObj.each(function(i){$(this).attr('index',i);});this.hashInterval=setInterval(function(){Crumbnav.parseHash();},100);};Crumbnav.parseHash=function(args){var theHash=window.location.hash;if(theHash!==this.currentHash){var isDefault=true;if(theHash!=''){this.objs.linkObj.each(function(){var $this=$(this);if(theHash==$this.attr('href')){Crumbnav.selectSection($this);isDefault=false;}});}
if(isDefault)
Crumbnav.selectSectionByIndex(0);}};Crumbnav.selectSectionByIndex=function(index){this.selectSection(this.objs.navObj.find('li:eq('+index+') a'));};Crumbnav.selectSection=function($clickObj){if(window.location.hash!=='')
window.location.hash=$clickObj.attr('href');this.currentHash=window.location.hash;var visible='';var visibleSectionId=false;this.selectedIndex=$clickObj.attr('index');var clickSectionId=$clickObj.attr('href').replace('#','')+'_section';this.objs.listObj.removeClass('selected').removeClass('prev');this.objs.navObj.find('li:eq('+this.selectedIndex+')').addClass('selected').prev().addClass('prev');this.objs.linkObj.each(function(){var $this=$(this);var sectionId=$this.attr('href').replace('#','')+'_section';if($('#'+sectionId).is(':visible')){visible=$('#'+sectionId).get(0);visibleSectionId=sectionId;}});if(this.objs.navObj.parent('dd').parent('dl').length){var $dtObj=this.objs.navObj.parent('dd').parent('dl').find('dt');if(this.selectedIndex!=0)
$dtObj.addClass('alt');else
$dtObj.removeClass('alt');}
var $showIframe=$('#'+clickSectionId+' iframe');$showIframe.attr('src',$showIframe.attr('title'));$('#'+clickSectionId).fadeIn();if(visibleSectionId&&visibleSectionId!=clickSectionId)
$(visible).hide().find('iframe').attr('src','');};window.virb.$.fn.crumbnav=Crumbnav;$('select.show-hide').live('change',function(){$(this).selectShowHide();return false;});virb.$.fn.selectShowHide=function(args)
{return this.each(function()
{var select=$(this),togglees=$('[data-toggle="'+select.attr('id')+'"]');togglees.each(function(){if($(this).attr('data-toggle-on')){var toggleOnArray=$(this).attr('data-toggle-on').split(","),show=false;for(var i=0;i<toggleOnArray.length;i++){if(select.find('option:selected').val().toString()==toggleOnArray[i]){show=true;}}
if(show){$(this).show();}else{$(this).hide();}}});});}
$('a.slider').bind('click',function(event){event.preventDefault();$(this).toggleSlider();});virb.$.fn.toggleSlider=function(args)
{return this.each(function()
{var $this=$(this);var transition='fade';if($this.data('transition')){transition=$this.data('transition');}
if($this.data('status')=='on'||(args&&args.close)){$this.removeClass('on').addClass('off').data('status','off');}else{$this.removeClass('off').addClass('on').data('status','on');}
if($this.data('toggle')){var toggleParts=$this.data('toggle').split(',');for(var i in toggleParts){var direction='In';var directionParts=toggleParts[i].split('|');var toggle=directionParts[0];var showStatus=directionParts[1]?directionParts[1]:'on';var hideStatus=showStatus=='on'?'off':'on';if(showStatus==$this.data('status')){virb.log('showing '+toggle);if(transition==='slide'){direction='Down';}
virb.log('$('+toggle+')['+transition+direction+']();');$(toggle)[transition+direction]();}else{direction='Out';if(transition==='slide'){direction='Up';}
$(toggle)[transition+direction]();}}}
if($this.data('input')&&$this.data('submit')){if($this.data('status')=='on'||(args&&args.close)){$this.data('submit','yes');}
else{$this.data('submit','no');}
$('[name="'+$this.data('input')+'"]').val($this.data('submit'));}});};$('div.drawer h5 a').live('click',function(){var $drawer=$(this).closest('div.drawer');var $clothes=$drawer.find('.clothes');if($drawer.hasClass('closed')){$clothes.slideDown();$drawer.removeClass('closed').addClass('open');}else{$clothes.slideUp(function(){$drawer.removeClass('open').addClass('closed');});}
return false;});$('.expand').live('click',function(){var $this=$(this);if($this.hasClass('on')){$this.removeClass('on').addClass('off');$($this.attr('target')).slideDown();}else{$this.removeClass('off').addClass('on');$($this.attr('target')).slideUp();}});var $infoTipWrap=virb.$('<div id="info-tip-wrap"><div id="info-tip"><div class="arrow-right"></div></div></div>').hide();$infoTipWrap.appendTo('body');$infoTip=$infoTipWrap.find('#info-tip');virb.$('[data-info]').live('mouseover',function(){var $this=$(this);var info=$this.attr('data-info');var offset=$this.offset();var offsetTop=0;var offsetLeft=0;_gaq.push(['_trackEvent','Info Tips','View',info]);if($this.hasClass('mini')){$infoTipWrap.addClass('mini');}else{$infoTipWrap.removeClass('mini');}
$infoTip.html(info);if($this.hasClass('left')){$arrow=$('<div class="arrow-left"></div>');}else if($this.hasClass('right')){$arrow=$('<div class="arrow-right"></div>');}else if($this.hasClass('bottom')){$arrow=$('<div class="arrow-bottom"></div>');}else if($this.hasClass('top')){$arrow=$('<div class="arrow-top"></div>');}
$arrow.prependTo($infoTip);var outerHeight=$infoTipWrap.outerHeight();var height=$infoTipWrap.height();var width=$infoTipWrap.width();if($this.hasClass('left')){offsetLeft=$this.outerWidth()+10;offsetTop=-outerHeight/2+$this.height()/2;$arrow.css({top:(height/2-5)+'px'}).prependTo($infoTip);}else if($this.hasClass('right')){offsetLeft=-$infoTipWrap.outerWidth()-10;offsetTop=-outerHeight/2+$this.height()/2;$arrow.css({top:(height/2-5)+'px'});}else if($this.hasClass('top')){offsetLeft=-$infoTipWrap.outerWidth()/2+$this.width()/2;offsetTop=0;$arrow.css({left:(width/2-5)+'px'}).prependTo($infoTip);}else if($this.hasClass('bottom')){offsetLeft=-$infoTipWrap.outerWidth()/2+$this.width()/2;offsetTop=-outerHeight-10;$arrow.css({left:(width/2-5)+'px'}).prependTo($infoTip);}
$infoTipWrap.css({top:offset.top+offsetTop,left:offset.left+offsetLeft})
$infoTipWrap.fadeIn('fast');}).live('mouseout',function(){$infoTipWrap.hide();});virb.$.getUID=function(){var uid='';for(i=0;i<32;i++){uid+=Math.floor(Math.random()*16).toString(16);}
return uid;};virb.$.preventNav=function(invoke,message){if(typeof invoke!=='boolean'){throw new Error('virb.$.preventNav: First argument needs to be a boolean');}
if(invoke===false){window.onbeforeunload=function(){};return true;}
else
{if(!message){var message='If so, your changes will be lost.';}
window.onbeforeunload=function(evt){e=window.event?window.event:evt;e.returnValue=message;return message;};}};virb.$.encodeHTML=function(text,args){if(!args||!args.noAmp){text=text.replace(/&(?!amp;)/ig,'&amp;');}
if(!args||!args.noEncodeURI){text=encodeURIComponent(text);}
if(!args||!args.noEscape)
text=escape(text);return text;};virb.$.decodeHTML=function(text){return unescape(decodeURIComponent(text));};virb.$.getHref=function(removeHash){var href=window.location.href;if(removeHash){href=href.replace(window.location.hash,'');href=href.replace(/#/g,'');}
return href;};virb.$.preload=function(images){imageObj=new Image(35,35);imageArray=[];if(typeof images==='object'){for(var i=0;i<images.length;i++){imageObj.src=images[i];imageArray.push(imageObj);}}
else
{imageObj.src=images;imageArray.push(imageObj);}};virb.$.callback=function(callback,response){if(callback){if(!response)
var response='';try
{window[callback](response);}
catch(err){var fn=new Function("response","return "+callback+"(response);");fn(response);}}};virb.$.getDimensions=function(html){heightReg=/height=[\"\']([0-9]+)[\"\']/gi;widthReg=/width=[\"\']([0-9]+)[\"\']/gi;var heightMatches=heightReg.exec(html);var widthMatches=widthReg.exec(html);if(widthMatches!=null&&heightMatches!=null){return{height:heightMatches[1],width:widthMatches[1]}}
return false;};virb.$.canResize=function(html){var dimensions=virb.$.getDimensions(html);if(false==dimensions)
return false;return true;}
virb.$.resize=function(html,args){if(virb.$.canResize(html)){var dimensions=virb.$.getDimensions(html);var width=575;var height='';if(args&&args.width){width=args.width;}
if(args&&args.height){height=args.height;}
height=Math.ceil((width*dimensions.height)/dimensions.width);heightReg=/height=[\"\']([0-9]+)[\"\']/gi;widthReg=/width=[\"\']([0-9]+)[\"\']/gi;html=html.replace(heightReg,'height="'+height+'"');html=html.replace(widthReg,'width="'+width+'"');}
return html;};virb.$.submitAjax=function(dataString,args){var type='POST';var url='/services/ajax/post';var dataType='json';var fail=(virb.$.overlay)?virb.$.overlay.ajaxMessage:'';var getParams=dataString;if(args&&args.type&&args.type=='get'){type='GET';url='/services/ajax/get';}
if(args&&args.dataType)
dataType=args.dataType;if(args&&args.url)
url=args.url;if(typeof dataString=='object'){getParams='';$.each(dataString.params,function(index,value){getParams+='data['+dataString.model+']['+index+']='+value+'&';});}
virb.log(getParams);virb.$.ajax({"type":type,"url":url,data:getParams,"dataType":dataType,success:function(result){$.each(result,function(index,value){if(result[index].stat=='ok'){args.ok(value);}else{if(args.fail){args.fail(value);}else{fail('error',value.message);}}});}});};$.fn.attachSelect=function(){return this.each(function(){var $this=$(this);$this.prev().html('<span>'+$this.find('option:selected').html()+'</span>');$this.change(function(){var $this=$(this);$this.prev().html('<span>'+$this.find('option:selected').html()+'</span>');});});};$.fn.attachTitleInside=function(){return this.each(function(){var $this=$(this);$.data(this,'title',$this.attr('title'));if($this.val()==''){$this.val($.data(this,'title'));}
else if($this.val()!=$.data(this,'title')){if($this.attr('type')!='password')
$this.attr('title',$this.val());$this.addClass('focus');}
$this.unbind('focus').focus(function(event){var $this=$(this);if(!$this.hasClass('focus'))
$this.addClass('focus');if($this.val()==$.data(this,'title'))
$this.val('');});$this.unbind('blur').blur(function(event){var $this=$(this);if($this.val()==''){$this.removeClass('focus');$this.val($.data(this,'title'));}
if($this.attr('type')!='password')
$this.attr('title',$this.val());});});};$('.titleinside').attachTitleInside();$.fn.updateTitleInside=function(newTitle){return this.each(function(){var oldTitle=$.data(this,'title');$.data(this,'title',newTitle);if(this.value==oldTitle||this.value==''){this.value=newTitle;}});};$.fn.showTitleInside=function(){return this.each(function(){if(this.value=='')
this.value=$.data(this,'title');});};$.fn.hideTitleInside=function(){return this.each(function(){if(this.value==$.data(this,'title'))
this.value='';});};virb.$.fn.attachTitleInside=$.fn.attachTitleInside;virb.$.fn.showTitleInside=$.fn.showTitleInside;virb.$.fn.hideTitleInside=$.fn.hideTitleInside;$.fn.changeInputType=function(oType){return this.each(function(){var newObject=document.createElement('input');newObject.type=oType;if(this.size)
newObject.size=this.size;if(this.value)
newObject.value=this.value;if(this.name)
newObject.name=this.name;if(this.id)
newObject.id=this.id;if(this.title)
newObject.title=this.title;if(this.tabIndex)
newObject.tabIndex=this.tabIndex;if(this.className)
newObject.className=this.className;this.parentNode.replaceChild(newObject,this);return virb.$(newObject);});};virb.$.fn.changeInputType=$.fn.changeInputType;virb.$.alphaNumeric=function(text,whitelist){var whitelistString="a-zA-Z0-9";if(whitelist){whitelistString+=whitelist;}
var regex=new RegExp("[^"+whitelistString+"]+","g");text=text.replace(regex,'');return text;};virb.$.slugify=function(text){var slug=text.replace(/ /g,'-').toLowerCase();return $.alphaNumeric(slug,'-_\/');};virb.$.removeWhitespace=function(text){return text.replace(/ /g,'');};virb.$.getFlashMovie=function(movieName){var isIE=navigator.appName.indexOf("Microsoft")!=-1;flashMovie=(isIE)?window[movieName]:document[movieName];return flashMovie;};$('#video-tutorial').click(function(){virb.$.showTutorialVideo();return false;})
virb.$.showTutorialVideo=function(videoToShow){var videoUrl='',playerHtml='';switch(videoToShow){case"widgets":videoUrl='//player.vimeo.com/video/80384630';break;default:videoUrl='//player.vimeo.com/video/80384629';break;}
playerHtml=virb.$.getVideoPlayerHtml(videoUrl);$.overlay.show({type:'custom',html:playerHtml,customClass:'video-tutorial'});};virb.$.getVideoPlayerHtml=function(videoUrl){var html='';html+='<iframe src='+videoUrl+' width="800" height="500" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen'+'</iframe>';return html;}})(virb.$);;(function($){var methods={init:function(options){var form=this;if(form.data('jqv')===undefined||form.data('jqv')==null){methods._saveOptions(form,options);virb.$(".formError").live("click",function(){virb.$(this).fadeOut(150,function(){virb.$(this).remove();});});}},attach:function(userOptions){var form=this;var options;if(userOptions)
options=methods._saveOptions(form,userOptions);else
options=form.data('jqv');if(!options.binded){if(options.bindMethod=="bind"){form.find("[class*=validate]").not("[type=checkbox]").bind(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").bind("click",methods._onFieldEvent);form.bind("submit",methods._onSubmitEvent);}else if(options.bindMethod=="live"){form.find("[class*=validate]").not("[type=checkbox]").live(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").live("click",methods._onFieldEvent);form.live("submit",methods._onSubmitEvent);}
options.binded=true;}},detach:function(){var form=this;var options=form.data('jqv');if(options.binded){form.find("[class*=validate]").not("[type=checkbox]").unbind(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").unbind("click",methods._onFieldEvent);form.unbind("submit",methods.onAjaxFormComplete);form.find("[class*=validate]").not("[type=checkbox]").die(options.validationEventTrigger,methods._onFieldEvent);form.find("[class*=validate][type=checkbox]").die("click",methods._onFieldEvent);form.die("submit",methods.onAjaxFormComplete);form.removeData('jqv');}},validate:function(){return methods._validateFields(this);},validateField:function(el){var options=virb.$(this).data('jqv');return methods._validateField(virb.$(el),options);},validateform:function(){return methods._onSubmitEvent(this);},showPrompt:function(promptText,type,promptPosition,showArrow){var form=this.closest('form');var options=form.data('jqv');if(!promptPosition)
options.promptPosition=promptPosition;options.showArrow=showArrow===true;methods._showPrompt(this,promptText,type,false,options);},hidePrompt:function(){var promptClass="."+virb.$(this).attr("id")+"formError"
virb.$(promptClass).fadeTo("fast",0.3,function(){virb.$(this).remove();});},hide:function(){var form=this;form.find('.formError').fadeTo("fast",0.3,function(){virb.$(this).remove();});},hideAll:function(){virb.$('.formError').fadeTo("fast",0.3,function(){virb.$(this).remove();});},_onFieldEvent:function(){var field=virb.$(this);var form=field.closest('form');var options=form.data('jqv');methods._validateField(field,options);},_onSubmitEvent:function(){var form=virb.$(this);var r=methods._validateFields(form,true);var options=form.data('jqv');if(r&&options.ajaxFormValidation){methods._validateFormWithAjax(form,options);return false;}
if(options.onValidationComplete){options.onValidationComplete(form,r);return false;}
return r;},_checkAjaxStatus:function(options){var status=true;virb.$.each(options.ajaxValidCache,function(key,value){if(value===false){status=false;return false;}});return status;},_validateFields:function(form,skipAjaxFieldValidation){var options=form.data('jqv');var errorFound=false;form.find('[class*=validate]').not(':hidden').each(function(){var field=virb.$(this);if(!field.hasClass("ajaxed"))
errorFound|=methods._validateField(field,options,skipAjaxFieldValidation);});errorFound|=!methods._checkAjaxStatus(options);if(errorFound){if(options.scroll){var destination=Number.MAX_VALUE;var lst=virb.$(".formError:not('.greenPopup')");for(var i=0;i<lst.length;i++){var d=virb.$(lst[i]).offset().top;if(d<destination)
destination=d;}
if(!options.isOverflown)
virb.$("html:not(:animated),body:not(:animated)").animate({scrollTop:destination},1100);else{var overflowDIV=virb.$(options.overflownDIV);var scrollContainerScroll=overflowDIV.scrollTop();var scrollContainerPos=-parseInt(overflowDIV.offset().top);destination+=scrollContainerScroll+scrollContainerPos-5;var scrollContainer=virb.$(options.overflownDIV+":not(:animated)");scrollContainer.animate({scrollTop:destination},1100);}}
return false;}
return true;},_validateFormWithAjax:function(form,options){var data=form.serialize();virb.$.ajax({type:"GET",url:form.attr("action"),cache:false,dataType:"json",data:data,form:form,methods:methods,options:options,beforeSend:function(){return options.onBeforeAjaxFormValidation(form,options);},error:function(data,transport){methods._ajaxError(data,transport);},success:function(json){if(json!==true){var errorInForm=false;for(var i=0;i<json.length;i++){var value=json[i];var errorFieldId=value[0];var errorField=virb.$(virb.$("#"+errorFieldId)[0]);if(errorField.length==1){var msg=value[2];if(value[1]===true){if(msg=="")
methods._closePrompt(errorField);else{if(options.allrules[msg]){var txt=options.allrules[msg].alertTextOk;if(txt)
msg=txt;}
methods._showPrompt(errorField,msg,"pass",false,options);}}else{errorInForm|=true;if(options.allrules[msg]){var txt=options.allrules[msg].alertText;if(txt)
msg=txt;}
methods._showPrompt(errorField,msg,"",false,options);}}}
options.onAjaxFormComplete(!errorInForm,form,json,options);}else
options.onAjaxFormComplete(true,form,"",options);}});},_validateField:function(field,options,skipAjaxFieldValidation){if(!field.attr("id"))
virb.$.error("jQueryValidate: an ID attribute is required for this field: "+field.attr("name")+" class:"+
field.attr("class"));var rulesParsing=field.attr('class');var getRules=/\[(.*)\]/.exec(rulesParsing);if(getRules===null)
return false;var str=getRules[1];var rules=str.split(/\[|,|\]/);var isAjaxValidator=false;var fieldName=field.attr("name");var promptText="";var required=false;options.isError=false;options.showArrow=true;for(var i=0;i<rules.length;i++){var errorMsg=undefined;switch(rules[i]){case"required":required=true;errorMsg=methods._required(field,rules,i,options);break;case"custom":errorMsg=methods._customRegex(field,rules,i,options);break;case"ajax":if(!skipAjaxFieldValidation){methods._ajax(field,rules,i,options);isAjaxValidator=true;}
break;case"minSize":errorMsg=methods._minSize(field,rules,i,options);break;case"maxSize":errorMsg=methods._maxSize(field,rules,i,options);break;case"min":errorMsg=methods._min(field,rules,i,options);break;case"max":errorMsg=methods._max(field,rules,i,options);break;case"past":errorMsg=methods._past(field,rules,i,options);break;case"future":errorMsg=methods._future(field,rules,i,options);break;case"maxCheckbox":errorMsg=methods._maxCheckbox(field,rules,i,options);field=virb.$(virb.$("input[name='"+fieldName+"']"));break;case"minCheckbox":errorMsg=methods._minCheckbox(field,rules,i,options);field=virb.$(virb.$("input[name='"+fieldName+"']"));break;case"equals":errorMsg=methods._equals(field,rules,i,options);break;case"funcCall":errorMsg=methods._funcCall(field,rules,i,options);break;default:}
if(errorMsg!==undefined){promptText+=errorMsg+"<br/>";options.isError=true;}}
if(!required){if(field.val()=="")options.isError=false;}
var fieldType=field.attr("type");if((fieldType=="radio"||fieldType=="checkbox")&&virb.$("input[name='"+fieldName+"']").size()>1){field=virb.$(virb.$("input[name='"+fieldName+"'][type!=hidden]:first"));options.showArrow=false;}
if(!isAjaxValidator){if(options.isError)
methods._showPrompt(field,promptText,"",false,options);else
methods._closePrompt(field);}
return options.isError;},_required:function(field,rules,i,options){switch(field.attr("type")){case"text":case"password":case"textarea":if(!field.val())
return options.allrules[rules[i]].alertText;break;case"radio":case"checkbox":var name=field.attr("name");if(virb.$("input[name='"+name+"']:checked").size()===0){if(virb.$("input[name='"+name+"']").size()===1)
return options.allrules[rules[i]].alertTextCheckboxe;else
return options.allrules[rules[i]].alertTextCheckboxMultiple;}
break;case"select-one":if(!field.val())
return options.allrules[rules[i]].alertText;break;case"select-multiple":if(!field.find("option:selected").val())
return options.allrules[rules[i]].alertText;break;}},_customRegex:function(field,rules,i,options){var customRule=rules[i+1];var pattern=new RegExp(options.allrules[customRule].regex);if(!pattern.test(field.attr('value')))
return options.allrules[customRule].alertText;},_funcCall:function(field,rules,i,options){var functionName=rules[i+1];var fn=window[functionName];if(typeof(fn)==='function')
return fn(field,rules,i,options);},_equals:function(field,rules,i,options){var equalsField=rules[i+1];if(field.attr('value')!=virb.$("#"+equalsField).attr('value'))
return options.allrules.equals.alertText;},_maxSize:function(field,rules,i,options){var max=rules[i+1];var len=field.attr('value').length;if(len>max){var rule=options.allrules.maxSize;return rule.alertText+max+rule.alertText2;}},_minSize:function(field,rules,i,options){var min=rules[i+1];var len=field.attr('value').length;if(len<min){var rule=options.allrules.minSize;return rule.alertText+min+rule.alertText2;}},_min:function(field,rules,i,options){var min=parseFloat(rules[i+1]);var len=parseFloat(field.attr('value'));if(len<min){var rule=options.allrules.min;return rule.alertText+min;}},_max:function(field,rules,i,options){var max=parseFloat(rules[i+1]);var len=parseFloat(field.attr('value'));if(len>max){var rule=options.allrules.max;return rule.alertText+max;}},_past:function(field,rules,i,options){var p=rules[i+1];var pdate=(p.toLowerCase()=="now")?new Date():methods._parseDate(p);var vdate=methods._parseDate(field.attr('value'));if(vdate>pdate){var rule=options.allrules.past;return rule.alertText+methods._dateToString(pdate);}},_future:function(field,rules,i,options){var p=rules[i+1];var pdate=(p.toLowerCase()=="now")?new Date():methods._parseDate(p);var vdate=methods._parseDate(field.attr('value'));if(vdate<pdate){var rule=options.allrules.future;return rule.alertText+methods._dateToString(pdate);}},_maxCheckbox:function(field,rules,i,options){var nbCheck=rules[i+1];var groupname=field.attr("name");var groupSize=virb.$("input[name='"+groupname+"']:checked").size();if(groupSize>nbCheck){options.showArrow=false;return options.allrules.maxCheckbox.alertText;}},_minCheckbox:function(field,rules,i,options){var nbCheck=rules[i+1];var groupname=field.attr("name");var groupSize=virb.$("input[name='"+groupname+"']:checked").size();if(groupSize<nbCheck){options.showArrow=false;return options.allrules.minCheckbox.alertText+" "+nbCheck+" "+
options.allrules.minCheckbox.alertText2;}},_ajax:function(field,rules,i,options){var errorSelector=rules[i+1];var rule=options.allrules[errorSelector];var extraData=rule.extraData;if(!extraData)
extraData="";if(!options.isError){virb.$.ajax({type:"GET",url:rule.url,cache:false,dataType:"json",data:"fieldId="+field.attr("id")+"&fieldValue="+field.attr("value")+"&extraData="+extraData,field:field,rule:rule,methods:methods,options:options,beforeSend:function(){var loadingText=rule.alertTextLoad;if(loadingText)
methods._showPrompt(field,loadingText,"load",true,options);},error:function(data,transport){methods._ajaxError(data,transport);},success:function(json){var errorFieldId=json[0];var errorField=virb.$(virb.$("#"+errorFieldId)[0]);if(errorField.length==1){var status=json[1];if(status===false){options.ajaxValidCache[errorFieldId]=false;options.isError=true;var promptText=rule.alertText;methods._showPrompt(errorField,promptText,"",true,options);}else{if(options.ajaxValidCache[errorFieldId]!==undefined)
options.ajaxValidCache[errorFieldId]=true;var alertTextOk=rule.alertTextOk;if(alertTextOk)
methods._showPrompt(errorField,alertTextOk,"pass",true,options);else
methods._closePrompt(errorField);}}}});}},_ajaxError:function(data,transport){if(data.status===0&&transport===null)
alert("The page is not served from a server! ajax call failed");else if(console)
console.log("Ajax error: "+data.status+" "+transport);},_dateToString:function(date){return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();},_parseDate:function(d){var dateParts=d.split("-");if(dateParts!==d)
dateParts=d.split("/");return new Date(dateParts[0],(dateParts[1]-1),dateParts[2]);},_showPrompt:function(field,promptText,type,ajaxed,options){var prompt=methods._getPrompt(field);if(prompt)
methods._updatePrompt(field,prompt,promptText,type,ajaxed,options);else
methods._buildPrompt(field,promptText,type,ajaxed,options);},_buildPrompt:function(field,promptText,type,ajaxed,options){var prompt=virb.$('<div>');prompt.addClass(field.attr("id")+"formError");prompt.addClass("formError");switch(type){case"pass":prompt.addClass("greenPopup");break;case"load":prompt.addClass("blackPopup");}
if(ajaxed)
prompt.addClass("ajaxed");var promptContent=virb.$('<div>').addClass("formErrorContent").html(promptText).appendTo(prompt);if(options.showArrow){var arrow=virb.$('<div>').addClass("formErrorArrow");switch(options.promptPosition){case"bottomLeft":case"bottomRight":prompt.find(".formErrorContent").before(arrow);arrow.addClass("formErrorArrowBottom").html('<div class="line1"><!-- --></div><div class="line2"><!-- --></div><div class="line3"><!-- --></div><div class="line4"><!-- --></div><div class="line5"><!-- --></div><div class="line6"><!-- --></div><div class="line7"><!-- --></div><div class="line8"><!-- --></div><div class="line9"><!-- --></div><div class="line10"><!-- --></div>');break;case"topLeft":case"topRight":arrow.html('<div class="line10"><!-- --></div><div class="line9"><!-- --></div><div class="line8"><!-- --></div><div class="line7"><!-- --></div><div class="line6"><!-- --></div><div class="line5"><!-- --></div><div class="line4"><!-- --></div><div class="line3"><!-- --></div><div class="line2"><!-- --></div><div class="line1"><!-- --></div>');arrow.addClass('formErrorArrowLeft');prompt.append(arrow);break;}}
if(options.isOverflown)
field.before(prompt);else
virb.$("body").append(prompt);var pos=methods._calculatePosition(field,prompt,options);prompt.css({"top":pos.callerTopPosition,"left":pos.callerleftPosition,"marginTop":pos.marginTopSize,"opacity":0});return prompt.animate({"opacity":0.95});},_updatePrompt:function(field,prompt,promptText,type,ajaxed,options){if(prompt){if(type=="pass")
prompt.addClass("greenPopup");else
prompt.removeClass("greenPopup");if(type=="load")
prompt.addClass("blackPopup");else
prompt.removeClass("blackPopup");if(ajaxed)
prompt.addClass("ajaxed");else
prompt.removeClass("ajaxed");prompt.find(".formErrorContent").html(promptText);var pos=methods._calculatePosition(field,prompt,options);prompt.animate({"top":pos.callerTopPosition,"marginTop":pos.marginTopSize});}},_closePrompt:function(field){var prompt=methods._getPrompt(field);if(prompt)
prompt.fadeTo("fast",0,function(){prompt.remove();});},_getPrompt:function(field){var className="."+field.attr("id")+"formError";var match=virb.$(className)[0];if(match)
return virb.$(match);},_calculatePosition:function(field,promptElmt,options){var promptTopPosition,promptleftPosition,marginTopSize;var fieldWidth=field.width();var promptHeight=promptElmt.height();var overflow=options.isOverflown;if(overflow){promptTopPosition=promptleftPosition=0;marginTopSize=-promptHeight;}else{var offset=field.offset();promptTopPosition=offset.top;promptleftPosition=offset.left;marginTopSize=0;}
switch(options.promptPosition){default:case"topRight":if(overflow)
promptleftPosition+=fieldWidth-30;else{promptleftPosition+=fieldWidth-30;promptTopPosition+=-promptHeight;}
break;case"topLeft":promptTopPosition+=-promptHeight-10;break;case"centerRight":promptleftPosition+=fieldWidth+13;break;case"bottomLeft":promptTopPosition=promptTopPosition+field.height()+15;break;case"bottomRight":promptleftPosition+=fieldWidth-30;promptTopPosition+=field.height()+5;}
return{"callerTopPosition":promptTopPosition+"px","callerleftPosition":promptleftPosition+"px","marginTopSize":marginTopSize+"px"};},_saveOptions:function(form,options){if(virb.$.validationEngineLanguage)
var allRules=virb.$.validationEngineLanguage.allRules;else
virb.$.error("jQuery.validationEngine rules are not loaded, plz add localization files to the page");var userOptions=virb.$.extend({validationEventTrigger:"blur",scroll:true,promptPosition:"topRight",bindMethod:"bind",ajaxFormValidation:false,onAjaxFormComplete:virb.$.noop,onBeforeAjaxFormValidation:virb.$.noop,onValidationComplete:false,isOverflown:false,overflownDIV:"",allrules:allRules,binded:false,showArrow:true,isError:false,ajaxValidCache:{}},options);form.data('jqv',userOptions);return userOptions;}};virb.$.fn.validationEngine=function(method){var form=virb.$(this);if(!form[0])return false;if(typeof(method)==='string'&&method.charAt(0)!='_'&&methods[method]){methods.init.apply(form);return methods[method].apply(form,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){methods.init.apply(form,arguments);return methods.attach.apply(form);}else{virb.$.error('Method '+method+' does not exist in jQuery.validationEngine');}};})(jQuery);(function($){virb.$.fn.validationEngineLanguage=function(){};virb.$.validationEngineLanguage={newLang:function(){virb.$.validationEngineLanguage.allRules={"required":{"regex":"none","alertText":"This field is required","alertTextCheckboxMultiple":"Please select an option","alertTextCheckboxe":"This checkbox is required"},"minSize":{"regex":"none","alertText":"Minimum ","alertText2":" characters allowed"},"maxSize":{"regex":"none","alertText":"Maximum ","alertText2":" characters allowed"},"min":{"regex":"none","alertText":"Minimum value is "},"max":{"regex":"none","alertText":"Maximum value is "},"past":{"regex":"none","alertText":"Date prior to "},"future":{"regex":"none","alertText":"Date past "},"maxCheckbox":{"regex":"none","alertText":"Checks allowed Exceeded"},"minCheckbox":{"regex":"none","alertText":"Please select ","alertText2":" options"},"equals":{"regex":"none","alertText":"Fields do not match"},"phone":{"regex":/^([\+][0-9]{1,3}[ \.\-])?([\(]{1}[0-9]{2,6}[\)])?([0-9 \.\-\/]{3,20})((x|ext|extension)[ ]?[0-9]{1,4})?$/,"alertText":"Invalid phone number"},"email":{"regex":/^([A-Za-z0-9_\-\.\'])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,63})$/,"alertText":"Invalid email address"},"integer":{"regex":/^[\-\+]?\d+$/,"alertText":"Not a valid integer"},"number":{"regex":/^[\-\+]?(([0-9]+)([\.,]([0-9]+))?|([\.,]([0-9]+))?)$/,"alertText":"Invalid floating decimal number"},"date":{"regex":/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/,"alertText":"Invalid date, must be in YYYY-MM-DD format"},"ipv4":{"regex":/^([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+\.([1-9][0-9]{0,2})+$/,"alertText":"Invalid IP address"},"url":{"regex":/^(https?|ftp|feed):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/,"alertText":"Invalid URL"},"onlyNumberSp":{"regex":/^[0-9\ ]+$/,"alertText":"Numbers only"},"onlyLetterSp":{"regex":/^[a-zA-Z\ \']+$/,"alertText":"Letters only"},"onlyLetterNumber":{"regex":/^[0-9a-zA-Z]+$/,"alertText":"No special characters allowed"},"ajaxLink":{"url":"/services/ajax/post",'extraData':'&data[Page][action]=validateLinkGet',"alertTextLoad":"Checking site availability","alertText":"This site is already taken"},"ajaxEmail":{"url":"/services/ajax/post",'extraData':'&data[User][action]=validateEmail',"alertTextLoad":"Checking if email is in use","alertText":"This email is already taken"},"ajaxName":{"url":"validateUser.php","alertText":"This name is already taken","alertTextOk":"This name is available","alertTextLoad":"Loading, please wait"},"ajaxPageLink":{"url":"/services/ajax/validate/pageLink","alertText":"This link is already being used","alertTextLoad":"Checking if link is unique"},"ajaxUserCall":{"url":"ajaxValidateFieldUser","extraData":"name=eric","alertText":"This user is already taken","alertTextLoad":"Validating, please wait"},"ajaxNameCall":{"url":"ajaxValidateFieldName","alertText":"This name is already taken","alertTextOk":"This name is available","alertTextLoad":"Validating, please wait"},"validate2fields":{"alertText":"Please input HELLO"}};}};virb.$.validationEngineLanguage.newLang();})(jQuery);;(function($){$document=$(document);$window=$(window);$.overlay={init:function(){$overlay=$('#overlay');if(!$overlay.length){$('body').prepend('<div id="overlay"></div>').prepend('<div id="overlay-wrapper"><a href="" id="overlay_close" title="x"><span id="overlay-close-wrap"><span id="overlay-close-x">&times;</span><span id="overlay-close-clip"></span></span></a><div id="overlay-message"></div><div id="overlay-content"></div></div>');$overlay=$('#overlay');$overlay.css({opacity:$overlay.css('opacity')});$overlayWrapper=$('#overlay-wrapper');$overlayContent=$('#overlay-content');$overlayMessage=$('#overlay-message');}
$ajaxMessage=$('#ajaxMessage');if(!$ajaxMessage.length){$('body').prepend('<div id="ajaxMessage"></div>');$ajaxMessage=$('#ajaxMessage').click(function(){virb.$.overlay.hideAjaxMessages();});}
$('#announcement.positive .modify.edit a').click(function(){$.submitAjax('data[Page][action]=updateNotification&data[Page][type]=:feature',{ok:$.overlay.finishHideAnnouncement});$('#announcement.positive').slideUp(function(){$(this).remove();});});$('#announcement.negative .modify.edit a').click(function(){$.submitAjax('data[Page][action]=updateNotification&data[Page][type]=',{ok:$.overlay.finishHideAnnouncement});$('#announcement.negative').slideUp(function(){$(this).remove();});});var docScroll;$(document).bind('ready scroll',function(){$.overlay.handleOverlayScroll();});},handleOverlayScroll:function(){docScroll=$(document).scrollTop();if(docScroll>=60){$('#admin #ajaxMessage').addClass('ajaxMessageFixedTop');}else{$('#admin #ajaxMessage').removeClass('ajaxMessageFixedTop');}},finishHideAnnouncement:function(result){},show:function(opts){$.overlay.init();delete $.overlay.callback;delete $.overlay.callbackParams;$overlayMessage.hide();$overlayContent.show();if(opts&&opts.type){$.overlay.opts=opts;if(opts.callback)
$.overlay.callback=opts.callback;if(opts.callbackParams)
$.overlay.callbackParams=opts.callbackParams;$.overlay.buildHtml(opts);}
$overlay.fadeIn("fast",function(){$overlayWrapper.show();$overlayWrapper.center();if(!opts.killTitleinside||false==opts.killTitleinside)
$overlayWrapper.find('.titleinside').attachTitleInside();});if(!opts||!opts.cancelHide)
this.attachHideEvents(opts.type);},hide:function(cancelCallback){this.hideAjaxMessages();try{$('body').validationEngine('hideAll');}catch(e){}
$(document).unbind('keyup');$(document).unbind('keydown');if($overlayWrapper.is(':visible'))
$overlayWrapper.hide();if($.overlay.opts.autohide!==null&&false===$.overlay.opts.autohide&&$.overlay.callback&&!cancelCallback){var params=false;if($.overlay.callbackParams){params=$.overlay.callbackParams;}
try{window[$.overlay.callback](params);}catch(err){$.overlay.callback(params);}}else{$overlay.fadeOut("fast",function(){if($.overlay.callback&&!cancelCallback){var params=false;if($.overlay.callbackParams){params=$.overlay.callbackParams;}
try{window[$.overlay.callback](params);}catch(err){$.overlay.callback(params);}}
$overlayContent.html('');});}
$('input').each(function(){$(this).removeAttr('tabindex');});},overlayMessage:function(type,message){if(message)
$('#overlay-message').html('<p>'+message+'</p>');$('#overlay-message').removeClass().addClass(type).show();$('#overlay-content').hide();if(type=='error'||type=='notice')
$('#overlay-content').show();},ajaxMessage:function(type,message){$.overlay.init();if(type=='processing'){this.hideAjaxMessages();}else if(type!='processing'){$('.ajaxMessage.processing').fadeOut(function(){$(this).remove();});}
clearTimeout(this.ajaxMessageTimeout);var $output=$('<div class="ajaxMessage '+type+'"><span class="message">'+message+'</span><a href="#" onclick="virb.$.overlay.hideAjaxMessages();" class="close"></a></div>');$output.prependTo($ajaxMessage).fadeIn();this.ajaxMessageTimeout=setTimeout(function(){$('.ajaxMessage.success').fadeOut(function(){$(this).remove();});},3000);},hideAjaxMessages:function(args){var animation='fadeOut';if(args&&args.animation){animation=args.animation;}
if(animation=='fadeOut'){$('.ajaxMessage').fadeOut(function(){$(this).remove();});}else if(animation='hide'){$(this).remove();}},attachHideEvents:function(type){$('#overlay-wrapper a#overlay_close').click(function(){if($overlayContent.is(':visible'))
$.overlay.hide(true);return false;});$document.keydown(function(event){if(event.keyCode==27)event.preventDefault();});$document.keyup(function(event){if(event.keyCode==27){$document.unbind('keyup');$.overlay.hide(true);event.preventDefault();event.stopPropagation();}else if(event.keyCode==13){$document.unbind('keyup');if(type&&(type=='alert'||type=='confirm'||type=='prompt')){$.overlay.hide();}}});},buildHtml:function(opts){var output='';$overlayWrapper.prop({className:''});if(opts.customClass)
$overlayWrapper.addClass(opts.customClass);if(opts.type=='custom'&&opts.html&&opts.html!=''){output=opts.html;}else{if(opts.type=='prompt')
output+='<form action="" onsubmit="virb.$.overlay.hide();return false;">';output+='<h1>'+opts.title+'</h1>';if(opts.description)
output+='<h2>'+opts.description+'</h2>';if(opts.type=='prompt'){var titleInside='';if(opts.titleInside)
titleInside='title="'+opts.titleInside+'" class="titleinside"';output+='<span class="field"><input id="promptValue" value="" '+titleInside+' /></span>';}
output+='<div id="form_submit" class="overlay_footer">';if(opts.type=='alert'||opts.type=='prompt'){output+='<input type="button" class="modify add big" value="OK" onclick="virb.$.overlay.hide(); return false;" />';}else{var promptText="Yes";if(opts.promptText)
promptText=opts.promptText;output+='<input type="button" class="modify add big" value="'+promptText+'" onclick="virb.$.overlay.hide(false); return false;" />';}
if(opts.type=='confirm'||opts.type=='prompt'){var cancelText="Cancel";if(opts.cancelText)
cancelText=opts.cancelText;output+='<input type="button" class="cancelForm modify edit big" value="'+cancelText+'" onclick="virb.$.overlay.hide(true); return false;" />';}
if(opts.type=='prompt')
output+='</form>';output+='</div>';}
$overlayContent.html(output);$overlayWrapper.center();}};$.fn.center=function(){return this.each(function(){$this=$(this);var posTop=$window.height()/2-$this.height()/2;var posLeft=$window.width()/2-$this.width()/2;if($this.height()<$window.height())
posTop+=$window.scrollTop();if($this.width()<$window.width())
posLeft+=$window.scrollLeft();$this.css({position:"absolute",top:posTop,left:posLeft});});};$.alert=function(opts){opts.type='alert';customClass='alert';if(opts.customClass)
customClass=customClass+' '+opts.customClass;opts.customClass=customClass;$.overlay.show(opts);};$.prompt=function(opts){opts.type='prompt';opts.customClass='prompt';$.overlay.show(opts);};$.confirm=function(opts){opts.type='confirm';if(opts.customClass)
opts.customClass+=' confirm';else
opts.customClass='confirm';$.overlay.show(opts);};virb.$.overlay=$.overlay;virb.$.alert=$.alert;virb.$.prompt=$.prompt;virb.$.confirm=$.confirm;$(function(){virb.$.overlay.init();});})(virb.$);;(function($){$.logout={init:function(){$('.logout').click(function(e){e.preventDefault();$.confirm({title:'Are you sure you want to log out?',callback:$.logout.now});});},now:function(){window.location.href='/logout';}};$.login={win:false,init:function(){var self=this,mainLoginForm=$('#loginFormMain');var options={"classHandler":function(ParsleyField){return $(ParsleyField.$element).parents('fieldset');},"errorClass":"error","errorTemplate":'<li></li>',"successClass":"success"};try{mainLoginForm.parsley(options);}catch(e){virb.log('Parsley not loaded. '+e);}
$('.login').not('body.login').click(function(){$.login.show();return false;});$('#account-switcher').click(function(){$.login.accountSwitch();return false;});$('#forgot-password').on('click',function(e){e.preventDefault();self.setupResetForm();});$('#back-to-login').on('click',function(e){e.preventDefault();$('#forgotten-password').hide();mainLoginForm.show();})
mainLoginForm.on('submit',function(e){e.preventDefault();$('input#main-submit').parents('.button-wrapper').addClass('wait');self.submit({redirect:true,formId:'#loginFormMain'});});},setupResetForm:function(){var self=this,passwordForm=$('#forgotten-password');var options={"classHandler":function(ParsleyField){return $(ParsleyField.$element).parents('fieldset');},"errorClass":"error","errorTemplate":'<li></li>',"successClass":"success"};passwordForm.parsley(options);$('#loginFormMain').hide();passwordForm.show();passwordForm.on('submit',function(e){e.preventDefault();$('input#password-submit').parents('.button-wrapper').addClass('success');self.submit({redirect:true,formId:'#forgotten-password'});});},show:function(args){$('input').each(function(){$(this).attr('tabindex','-10');});var showArgs={type:'custom',html:this.getLoginHtml(),customClass:'overlay-login',killTitleinside:true};if(args&&args.cancelHide)
showArgs.cancelHide=true;$('.formError').hide();$.overlay.show(showArgs);$('#overlay-wrapper .titleinside').attachTitleInside();$('#dataUserPassword').focus(function(){$this=$(this);$this.val('').addClass('focus').unbind('focus').changeInputType('password');document.getElementById('dataUserPassword').focus();setTimeout("document.getElementById('dataUserPassword').focus()",100);});$("#loginForm").validationEngine('attach',{onValidationComplete:function(){$.login.submit({redirect:true});},bindMethod:'bind'});},showReset:function(newModal){$('.formError').hide();if($.overlay){var showArgs={type:'custom',html:this.getResetHtml(),customClass:'overlay-login overlay-password-reset'};$.overlay.show(showArgs);}else{$overlayContent.html(this.getResetHtml());$overlayWrapper.addClass('overlay-password-reset');}
$('#overlay-wrapper .titleinside').attachTitleInside();$("#loginForm").validationEngine('attach',{onValidationComplete:function(){$.login.submit();},bindMethod:'bind'});return false;},showLogin:function(){$('.formError').hide();$overlayContent.html(this.getLoginHtml());$overlayWrapper.removeClass().addClass('overlay-login');$('#overlay-wrapper .titleinside').attachTitleInside();$("#loginForm").validationEngine('attach',{onValidationComplete:function(){$.login.submit({redirect:true});},bindMethod:'bind'});return false;},showOpenId:function(){$('.formError').hide();$overlayContent.html(this.getOpenIdHtml());$overlayWrapper.addClass('overlay-openid');$('#overlay-wrapper .titleinside').attachTitleInside();$("#openIdForm").validationEngine('attach',{onValidationComplete:function(){$.login.submitOpenId();},bindMethod:'bind'});return false;},submitMainLogin:function(args){var dataString='',formId=args.formId;$(formId).find(':input').each(function(){var encodedValue=$.encodeHTML(this.value);dataString+=this.name+'='+encodedValue+'&';});$.ajax({type:"POST",url:"//"+window.location.host+"/services/ajax/post",data:dataString,dataType:'json',success:function(result){console.log(result);for(var key in result){if(result[key].stat=='ok'){if(result[key].response&&result[key].response.pages){if(result[key].redirect!=''){window.location.href=result[key].redirect;}else{$.login.showAccounts(result[key],false);}}else{if(result[key].response&&result[key].response.reset){$.overlay.hide(true);}else if(args&&args.redirect){if(result[key].redirect!=''){window.location.href=result[key].redirect;}else{window.location.href='/pages?login';}}}}else{}
break;}}});},submit:function(args){var self=this,submittedForm=$('#loginFormMain');$.overlay.ajaxMessage('processing','Processing...');var dataString='';var formId='#loginForm';if(args&&args.formId){formId=args.formId;}
if(formId==='#forgotten-password'){submittedForm=$('#forgotten-password');}
$(formId).find(':input').each(function(){var encodedValue=$.encodeHTML(this.value);dataString+=this.name+'='+encodedValue+'&';});$.ajax({type:"POST",url:"//"+window.location.host+"/services/ajax/post",data:dataString,dataType:'json',success:function(result){virb.log(result);for(var key in result){if(result[key].stat=='ok'){if(result[key].response&&result[key].response.pages){if(result[key].redirect!=''){window.location.href=result[key].redirect;}else{$.login.showAccounts(result[key],false);}}else{$.overlay.ajaxMessage('success',result[key].message);if(result[key].response&&result[key].response.reset){$.overlay.hide(true);}else if(args&&args.redirect){if(result[key].redirect!=''){window.location.href=result[key].redirect;}else{window.location.href='/pages?login';}}}}else{submittedForm.find('#form_submit .button-wrapper').removeClass('wait success');submittedForm.find('fieldset').removeClass('success');$.overlay.ajaxMessage('error',result[key].message);}
break;}},fail:function(result){virb.log('login failure');}});},submitOpenId:function(){$.overlay.ajaxMessage('processing','Processing...');var dataString='';$("#openIdForm").find(':input').each(function()
{dataString+=this.name+'='+this.value+'&';});window.open('/openid/start?'+dataString,'openid_popup','width=790,height=580');},handleOpenIdResponse:function(result){return false;if(result.OpenId.stat=="ok"){if(result.OpenId.code==12){$.overlay.hideAjaxMessages();var accounts=$.parseJSON(result.OpenId.response);$overlayContent.html(this.getAccountsHtml(result.OpenId,accounts.is_logged_in,"openid"));$overlayContent.show();$overlayWrapper.attr({'class':'overlay-accounts'});}else{$.overlay.ajaxMessage('success',result.OpenId.message);window.location.href=$.getHref(true);}}else{$.overlay.ajaxMessage('error',result.OpenId.message);}},handleLoginMultiple:function(result){return false;if(result.stat=="ok"){if(result.code==1){$.overlay.hideAjaxMessages();$overlayContent.html(this.getAccountsHtml(result,false,"openid"));$overlayContent.show();$overlayWrapper.attr({'class':'overlay-accounts'});}else{$.overlay.ajaxMessage('success',result.OpenId.message);window.location.href=$.getHref(true);}}else{$.overlay.ajaxMessage('error',result.OpenId.message);}},accountSwitch:function(){$.overlay.ajaxMessage('processing','Loading accounts...');$.submitAjax('data[User][action]=getSites',{ok:function(result){$.login.showAccounts(result,true);}});},showAccounts:function(accounts,switchAcct){$('.formError').hide();$.overlay.hideAjaxMessages();$.overlay.show({type:'custom',html:$.login.getAccountsHtml(accounts,switchAcct),customClass:'overlay-accounts'});return false;},getAccountsHtml:function(result,switchAcct,type){var html='';if(switchAcct)
html+='<h1>Switch to a different Virb site:</h1>';else
html+='<h1>Choose a Virb site to manage:</h1>';html+='<form action="" id="loginForm" onsubmit="$.login.submit({redirect: true});return false;" method="post">';html+='<input type="hidden" name="data[User][action]" value="loginByPageId" />';html+='<input type="hidden" name="data[User][page_id]" id="dataLoginPageId" value="" />';html+='</form>';html+='<ul>';var accounts=result.response.pages;for(var i in accounts){var page=accounts[i];var rowClass='';var rowText='<span>Log In &rarr;</span>';if(i==0)
rowClass+=' top';if(page.is_logged_in&&page.is_logged_in!='false'){rowClass+=' loggedin';rowText='<span>Logged In</span>';}
html+='<li class="'+rowClass+'"><a href="" id="page_id_'+page.id+'" onclick="$(\'#dataLoginPageId\').val(\''+page.id+'\');$.login.submit({redirect: true});return false;"><img src="'+page.site_icon+'" />'+page.display_name+'<em> &mdash; http://'+page.site_url+'</em>'+rowText+'</a></li>';}
html+='</ul>';return html;},getLoginHtml:function(){var html='';html+='<form action="" id="loginForm" onsubmit="return false;" method="post">';html+='<input type="hidden" name="data[User][action]" value="globalLogin" />';html+='<input type="hidden" name="data[User][type]" value="virb" />';html+='<p><span class="field"><input id="dataUserEmail" type="input" name="data[User][email]" tabindex="1" class="validate[email] titleinside" title="Email Address" value="Email Address" autocomplete="off" /></span></p>';html+='<p><span class="field password">';html+='<input id="dataUserPassword" type="text" name="data[User][password]" tabindex="2" class="validate[required] titleinside" title="Password" value="" autocomplete="off" />';html+='<a href="#reset" onclick="$.login.showReset();return false;">Forgot your password?</a>';html+='</span></p>';html+='<div id="form_submit">';html+='<a href="/signup" alt="Sign Up Now">Sign Up Now</a>';html+='<input type="submit" class="submit link green rounded_5" name="submit" tabindex="4" value="Log In" />';html+='<label class="remember" for="dataUserRemember"><input id="dataUserRemember" type="checkbox" name="data[User][remember_me]" checked="checked" tabindex="3" />';html+='Stay Logged In</label>';html+='</div>';html+='</form>';return html;},getResetHtml:function(){var html='';html+='<form action="" id="loginForm" onsubmit="return false;" method="post">';html+='<h1>Forgot your password?&nbsp;&nbsp;We\'ll email you a link to reset it:</h1>';html+='<input type="hidden" name="data[User][action]" value="passwordResetRequest" />';html+='<p><span class="field"><input id="dataUserEmail" type="input" name="data[User][email]" value="Email Address" class="titleinside" title="Email Address" /></span></p>';html+='<div id="form_submit"><input type="submit" class="submit link green rounded_5" value="Email Me" />';html+='</form>';return html;},getOpenIdHtml:function(){var html='';html+='<form action="" id="openIdForm" onsubmit="return false;" method="post">';html+='<h1>Log in to manage your site, or <a href="#signup" onclick="window.location.href=\'/signup\';return false;">sign up</a> for your free trial.</h1>';html+='<p><span class="field"><input id="dataUserOpenId" type="input" name="data[User][openid]" tabindex="1" class="validate[required] titleinside" title="Your OpenID..." value="Your OpenID..." /></span></p>';html+='<div id="form_submit"><input type="submit" tabindex="3" value="Log In" /></div>';html+='<span id="remember_me"><input id="dataUserRemember" type="checkbox" name="data[User][remember_me]" checked="checked" tabindex="2" />';html+='<label for="dataUserRemember">Remember login on this computer</label></span>';html+='<div class="overlay_footer">';html+='or <a href="#login" onclick="$.login.showLogin();return false;">log in with other services</a>';html+='</div>';html+='</form>';return html;}};virb.$.logout=$.logout;virb.$.login=$.login;$(function(){virb.$.logout.init();virb.$.login.init();});})(virb.$);;(function($){$.forms={submitCoords:{},submitPadding:{},submitInitialized:false,objs:{},updatedInputs:[],init:function(){var self=this;this.attachTextareaExpand('textarea.expand');this.attachInputChange(':input');this.objs.hash=window.location.hash;$('.delete-item').attachDelete();$('form').submit(function(){$.preventNav(false);$('.titleinside').hideTitleInside();if($(this).hasClass('validationEngine')){var result=$(this).validationEngine('validate');if(false==result){$('.titleinside').showTitleInside();}
return result;}
$('input[type=file]').prop('disabled',true).val('');});$('.saveForm').click(function(){$.forms.saveForm($(this));return false;});$('.saveItem').click(function(){$.forms.saveItem($(this));return false;});$('form .article select,form #services select, form .select select').attachSelect();$('#save-button, #save-float-button').on('click',function(e){$('#saveRedirectType').val('save');});$('#save-view-button, #save-view-float-button').on('click',function(e){$('#saveRedirectType').val('saveView');});$(window).on("load",function(e){if(self.objs.hash=='#view'){$.forms.showPreview();}});$('.new-view-mode').on('click',function(e){e.preventDefault();$.forms.showPreview();})},attachInputChange:function(selector){selector=selector+'[id!=themeCategories]';$(selector).unbind('change').change(function(event){$.forms.inputChanged($(this));});},attachTextareaExpand:function(selector){$this=$(this);$(selector).each(function(){$this=$(this);if($this.val()!=''&&$this.val()!=$.data(this,'title')){this.rows='6';}});$(selector).focus(function(){if(this.rows=='1'){this.rows='6';}});$(selector).blur(function(){if($this.val()==''||$this.val()==$.data(this,'title')){this.rows='1';}});},submitResult:function(result){if(result==false){$('.titleinside').showTitleInside();}
return result;},inputChanged:function($inputObj){if($inputObj.hasClass('autosave')){this.saveInput($inputObj);}
else{$.preventNav(true);this.updatedInputs[$inputObj.attr('name')]=$inputObj;}},saveItem:function($callbackObj){$.overlay.ajaxMessage('processing','Processing...');params=$.parseJSON($callbackObj.attr('params'));$('#'+params._handler+'_'+params.id).addClass('savedItem');dataString='';for(var i=0;i<params.length;i++){dataString+='data['+params._handler+']['+i+']='+params[i]+'&';}
if($callbackObj.attr('type')=='checkbox'){dataString+=$callbackObj.attr('name')+'='+$callbackObj.prop('checked')+'&';}
else
{dataString+=$callbackObj.attr('name')+'='+$.encodeHTML($callbackObj.val())+'&';}
$.ajax({type:"POST",url:"/services/ajax/post",data:dataString,dataType:'json',success:function(result){for(var key=0;i<result.length;i++){if(result[key].stat=='ok'){$.overlay.ajaxMessage('success',result[key].message);$('#'+params._handler+'_'+params.id).removeClass('deletedItem');if(params.callback){try
{window[params.callback](result[key].response);}
catch(err){var fn=new Function("response","return "+params.callback+"(response);");fn(result[key].response);}}}
else
{$.overlay.ajaxMessage('error',result[key].message);$('#'+params._handler+'_'+params.id).removeClass('savedItem');}}}});},deleteObj:function($deleteObj){$.overlay.ajaxMessage('processing','Processing...');var self=this;var refresh=$deleteObj.data('refresh')?true:false;var callback=$deleteObj.data('callback')?$deleteObj.data('callback'):false;var deleteSelector='#'+$deleteObj.data('handler').slugify('-_')+'_'+$deleteObj.data('id');var dataObj={model:'Build/'+$deleteObj.data('handler'),params:{id:$deleteObj.data('id'),action:'delete'}};if($deleteObj.data('selector')){deleteSelector=$deleteObj.data('selector');}
$(deleteSelector).addClass('deletedItem');virb.log('$.forms.deleteObj()');virb.log(dataObj);$.submitAjax(dataObj,{ok:function(result){$.overlay.ajaxMessage('success',result.message);$(deleteSelector).removeClass('savedItem');virb.log('$.event.trigger(delete.'+self.fromHandler(dataObj.model)+')');$.event.trigger('delete.'+self.fromHandler(dataObj.model)+'',[dataObj.params.id]);if(refresh){window.location.href=refresh;}},fail:function(result){$.overlay.ajaxMessage('error',result.message);$(deleteSelector).removeClass('deletedItem');}});},toHandler:function(toHandler){handlerSplit=toHandler.split('.');handlerSplit[handlerSplit.length-1]=handlerSplit[handlerSplit.length-1].toClass();return handlerSplit.join('/');},fromHandler:function(fromHandler){handlerSplit=fromHandler.split('/');handlerSplit[handlerSplit.length-1]=handlerSplit[handlerSplit.length-1].toUnderscore();return handlerSplit.join('.');},saveInput:function($inputObj,hideMessages){params=$.parseJSON($inputObj.attr('params'));if(typeof hideMessages=='undefined'||false==hideMessages){$.overlay.ajaxMessage('processing','Saving...');}
var dataString='';virb.log($inputObj.prop('type'));virb.log($inputObj.attr('name'));if($inputObj.prop('type')=='checkbox'){dataString+=$inputObj.attr('name')+'='+$inputObj.prop('checked')+'&';}else{dataString+=$inputObj.attr('name')+'='+$.encodeHTML($inputObj.val())+'&';}
if(params.id){dataString+='data['+params._handler+'][id]='+params.id+'&';}
for(var i=0;i<params.length;i++){if(params[i]==params._handler||params[i]==params.action){continue;}
dataString+='data['+params._handler+']['+i+']='+params[i]+'&';}
dataString+='data['+params._handler+'][action]='+params.action;$.ajax({type:"POST",url:"/services/ajax/post",data:dataString,dataType:'json',success:function(result){$.each(result,function(key,value){if(value.stat=='ok'){if(typeof hideMessages=='undefined'||false==hideMessages){$.overlay.ajaxMessage('success',value.message);}
if(value.response&&value.response.callback){try{window[value.response.callback](value.response);}catch(err){var fn=new Function("response","return "+value.response.callback+"(response);");fn(value.response);}}}else{if(typeof hideMessages=='undefined'||false==hideMessages){$.overlay.ajaxMessage('error',value.message);}}});}});},saveForm:function($clickObj){$.overlay.ajaxMessage('processing','Saving...');var $parentForm=$clickObj.closest('form');var dataString='';$parentForm.find('.titleinside').hideTitleInside();$parentForm.find(':input').each(function(i){var $this=$(this);dataString+=$this.attr('name')+'='+$this.val()+'&';});$.submitAjax(dataString,{ok:function(result){if($parentForm.attr('callback')){$.callback($parentForm.attr('callback'),'');}
$parentForm.find('.titleinside').showTitleInside();$.overlay.ajaxMessage('success',result.message);$parentForm.find(':input[type=password]').val('');$.preventNav(false);}});return false;},getInputAction:function(inputObj){nameArray=this.splitInputName($(inputObj).attr('name'));return $(':input[name="'+nameArray[0]+'['+nameArray[1]+'][action]"]:first');},splitInputName:function(name){nameArray=name.split('[');for(var i=0;i<nameArray.length;i++){nameArray[i]=nameArray[i].replace(/]/ig,'');}
return nameArray;},unsetInputsByModel:function(model){$(':input').each(function(){var inputName=this.name;inputNameSplit=$.forms.splitInputName(inputName);if(inputNameSplit[1]==model){delete $.forms.updatedInputs[inputName];}});},initializeSubmit:function(){if(this.submitInitialized==true)
return true;this.submitInitialized=true;this.objs.formSubmit=$('#form_submit');this.objs.floatFormSubmit=$('#form_float_submit');this.submitCoords=this.objs.formSubmit.offset();this.submitPadding.top=this.objs.formSubmit.css('paddingTop').replace('px','')*1;if(this.submitCoords.top>$(window).height())
this.objs.floatFormSubmit.fadeIn();$(window).scroll(function(){var $this=$(this);if($this.height()+$this.scrollTop()>=$.forms.submitCoords.top+$.forms.submitPadding.top&&$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeOut('fast');else if($this.height()+$this.scrollTop()<$.forms.submitCoords.top+$.forms.submitPadding.top&&false==$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeIn('fast');});$(window).resize(function(){var $this=$(this);if($this.height()+$this.scrollTop()>=$.forms.submitCoords.top+$.forms.submitPadding.top&&$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeOut('fast');else if($this.height()+$this.scrollTop()<$.forms.submitCoords.top+$.forms.submitPadding.top&&false==$.forms.objs.floatFormSubmit.is(':visible'))
$.forms.objs.floatFormSubmit.fadeIn('fast');});},showPreview:function(){var $sitePreview=$('#site-preview'),iframeUrl=$('#pageUrlString').val();if($('#pageUrlString').length<=0){iframeUrl='';}
if($('#postId').val()>0){iframeUrl+='/'+$('#postId').val();}
if($('#postUrl').length&&$('#postUrl').val()!='post url...'){iframeUrl+='/'+$('#postUrl').val();}
virb.log('showing the preview for '+iframeUrl);if(!$sitePreview.length){var html='';html+='<div id="site-preview">';html+='<div class="site-preview-header">';html+='<div class="container">';html+='<p class="url-preview">'+$('input#site-url').val()+iframeUrl+'</p>';html+='<a href="#close" onclick="virb.$.forms.hidePreview(); return false;">';html+='<span class="close-preview">Close and Return to Admin</span>';html+='</div>';html+='</a>';html+='</div>';html+='<iframe src="" id="site-preview-iframe"></iframe>';html+='</div>';$('body').append(html);}
$('body').css({overflow:'hidden'});$('#site-preview').show();$('#site-preview-iframe').animate({height:$(window).height()-$('#close-preview').outerHeight()},900).attr('src','/preview/'+iframeUrl);},hidePreview:function(){$('body').css({overflow:''});$('#site-preview-iframe').animate({height:0},function(){$('#site-preview').hide();$('#site-preview-iframe').attr('src','');});window.location.hash='';}};$.fn.attachDelete=function(args){return this.each(function(){var $this=$(this);$this.unbind('click').click(function(event){var $deleteObj=$(this);var confirmArgs={title:"Are you sure you want to "+this.title+"?",callback:function(){$.forms.deleteObj($deleteObj);}};$.confirm(confirmArgs);event.stopPropagation();});});};virb.$.forms=$.forms;$(function(){virb.$.forms.init();});})(jQuery);;(function(){var UploadManager={endpointUrl:'http://'+virb.config.uploadsDomain+'/upload',progressUrl:'http://'+virb.config.uploadsDomain+'/progress',statusUrl:'http://'+virb.config.virbDomain+'/services/upload/status',current:false,queue:Queue('queue.uploader'),processing:Table('processing.uploader'),completed:Table('completed.uploader'),statusPolling:false,extensions:{audio:['.mp3'],filestorage:['.jpg','.jpeg','.gif','.png','.css','.htm','.html','.js','.php','.bmp','.mp3','.mp4','.m4a','.aac','.avi','.mov','.flv','.mpg','.mpeg','.wmv','.mkv','.m4v','.pages','.doc','.docx','.txt','.rtf','.ppt','.key','.pdf','.psd','.ai','.eps','.swf','.fla','.xls','.xml','.zip','.rar','.ttf','.otf','.fon','.svg','.eot','.woff','.unity3d','.ico','.cbz','.cbr'],icon:['.jpg','.gif','.png','.jpeg'],image:['.jpg','.gif','.png','.jpeg'],video:['.flv','.avi','.mov','.mpg','.mpeg','.mp4','.m4v','.wmv','.mkv','.ogg']},init:function(){virb.log('initializing upload manager');var doc=$(document),manager=this,originalDocumentTitle=document.title;this.bindFileEvent($('.uploader'));doc.on(manager.queue.eventName('push'),function(e,pushedItem){doc.trigger('start.js.upload.uploader',[pushedItem]);manager.upload();});doc.on('next.js.upload.uploader',$.proxy(manager.upload,this));doc.on('progress.flash.upload.uploader',function(e,uid,percent){$('#uploader-'+uid).removeClass('waiting').addClass('uploading').attr('data-percent',percent+'%');document.title=percent+'% Uploaded';});doc.on('complete.flash.upload.uploader',function(e,responseStr){var response=$.parseJSON(responseStr);if(response.error!==undefined){doc.trigger('error.flash.upload.uploader',[response.uid]);return;}
var $fileUpload=$('#uploader-'+response.uid);$fileUpload.removeClass('uploading').addClass('finished');response.file=$fileUpload.find('input[type=file]');manager.processing.set(response.uid,response);manager.pollProcessingStatus();document.title=originalDocumentTitle;});doc.on('error.flash.upload.uploader',function(e,uid){var $fileUpload=$('#uploader-'+uid);$fileUpload.removeClass('uploading').removeClass('waiting').addClass('error');$.overlay.ajaxMessage('error','One or more files have failed to upload. Please re-upload them.');document.title=originalDocumentTitle;});doc.on('start.js.upload.uploader',function(e,queueItem){var container=queueItem.file.closest('.uploader');queueItem.file.attr('disabled',false);container.removeClass('upload').addClass('waiting');container.parent().find('.upload-help').addClass('hide');});doc.on('progress.js.upload.uploader',function(e,uid,percent){var container=manager.current.file.closest('.uploader');container.removeClass('waiting').addClass('uploading').attr('data-percent',percent+'%');document.title=percent+'% Uploaded';});doc.on('error.js.upload.uploader',function(e,uid,data){var container=manager.current.file.closest('.uploader');var message='One or more files have failed to upload. Please re-upload them.';container.removeClass('uploading').removeClass('waiting').addClass('error');if(data.error){message=data.error;}
$.overlay.ajaxMessage('error',message);manager.current=false;document.title=originalDocumentTitle;});doc.on('complete.js.upload.uploader',function(e,uid,response){var upload=manager.processing.get(uid),container=upload.file.closest('.uploader');if(manager.current){manager.current.file.attr('disabled',false);}
container.removeClass('waiting').removeClass('uploading').addClass('finished');manager.current=false;document.title=originalDocumentTitle;});doc.on('start.js.processing.uploader',function(e){});doc.on('complete.js.processing.uploader',function(e,uid,response){var upload=manager.completed.get(uid);if(upload.file){upload.file.closest('.uploader').removeClass('finished').addClass('upload');}
try{var flash=virb.$.getFlashMovie('flash-upload');flash.startUpload();}catch(e){}
doc.trigger('complete.file.uploader',[$.extend(upload,response)]);});},bindFileEvent:function($containers){$containers.each(function(){virb.log('binding uploader',this);Uploader($(this));});},trackImport:function(uid,data){UploadManager.processing.set(uid,data);$(document).trigger('next.js.upload.uploader');UploadManager.pollProcessingStatus();virb.log('Tracking import:',data);},upload:function(){if(UploadManager.current||UploadManager.processing.length()>=3){return;}
UploadManager.current=UploadManager.queue.next();if(false===UploadManager.current){return;}
$.preventNav(true);var current=UploadManager.current,postData={uid:current.uid,page_id:current.page_id,relation:current.relation,media_type:current.media_type,sizes:current.sizes,replace:current.replace,replace_id:current.replace_id,importing:current.importing,redirect_domain:virb.config.virbDomain,trial:virb.config.trial,extras:JSON.stringify(current.extras)};$.ajax({url:UploadManager.endpointUrl+'?X-Progress-ID='+current.uid,type:'POST',dataType:'iframe json',formData:postData,file:current.file,success:function(data){var current=UploadManager.current;if(data.error!==undefined){var error=data.error;$(document).trigger('error.js.upload.uploader',[current.uid,data]);$(document).trigger('next.js.upload.uploader',error);return;}
virb.log('upload success');UploadManager.current.token=data.token;UploadManager.processing.set(current.uid,current);$(document).trigger('complete.js.upload.uploader',[current.uid,data]);$(document).trigger('next.js.upload.uploader');UploadManager.pollProcessingStatus();},error:function(data){virb.log('upload error');$(document).trigger('error.js.upload.uploader',[current.uid,data]);$(document).trigger('next.js.upload.uploader',data);}});this.pollProgress(current.uid);},pollProgress:function(uid){var manager=this,delayedRecurse=function(){setTimeout(function(){manager.pollProgress(uid);},1000);};$.ajax({url:manager.progressUrl,type:'GET',dataType:'jsonp',data:{'X-Progress-ID':uid},success:function(upload){switch(upload.state){case'starting':virb.log('status starting');$(document).trigger('progress.js.upload.uploader',[uid,0]);delayedRecurse();break;case'uploading':var ratio=upload.received/upload.size,percent=Math.round(parseInt(ratio*100,10));virb.log('upload status at',percent);$(document).trigger('progress.js.upload.uploader',[uid,percent]);delayedRecurse();break;default:break;}}});},pollProcessingStatus:function(){var manager=this,delayedRecurse=function(){setTimeout(function(){manager.pollProcessingStatus();},1000);};if(this.processing.length()===0){this.statusPolling=false;return;}else if(this.statusPolling===false){this.statusPolling=true;}
var postData={items:{}};$.each(this.processing.all(),function(uid,item){var itemData={page_id:item.page_id,relation:item.relation,type:item.media_type,token:item.token,importing:item.importing};if(item.desired_size!==''){itemData.desired_size=item.desired_size;}
if(item.extras){itemData.extras=item.extras;}
postData.items[uid]=itemData;});$.ajax({url:this.statusUrl,type:'POST',dataType:'json',data:postData,success:function(data){if(data.error!==undefined){return;}
$.each(data.items,function(uid,status){if(status.upload_state==='done'&&manager.completed.get(uid)===undefined){var upload=manager.processing.get(uid);manager.processing.unset(uid);manager.completed.set(uid,upload);$(document).trigger('complete.js.processing.uploader',[uid,status]);}});delayedRecurse();}});},flashCanContinue:function(){return(UploadManager.processing.length()<10);}};function Uploader($container){var $input=$container.find('input[type=file]');var uploader={data:{file:$input,flash:!!($input.data('flash')),relation:$input.data('relation'),sizes:$input.data('sizes'),desired_size:$input.data('desired-size'),page_id:$input.data('page-id'),replace:$input.data('replace'),replace_id:$input.data('id'),extras:$input.data('extras'),importing:false,},bindFileEvent:function(){var uploader=this;this.data.file.off('change').change(function(){var $file=$(this),uid=$.getUID(),mediaType=uploader.getMediaType($file);$file.data('uid',uid);uploader.data.uid=uid;if(mediaType){uploader.data.media_type=mediaType;UploadManager.queue.push(uploader.data);}else if($file.val()!==''){$.alert({title:"Whoops! That's not an accepted file format."});}});},addFlashUploader:function(){var href="/_assets/_swf/virb_upload.swf";var params={allowScriptAccess:'always',id:'flash-upload',name:'flash-upload',wmode:'transparent'};var attributes={id:'flash-upload',wmode:'transparent'};var flashVars={};if(this.data.file.data('flash-vars')){flashVars=this.data.file.data('flash-vars');}
this.data.file.after('<span id="flash-upload-wrap"></span>');swfobject.embedSWF(href,'flash-upload-wrap','200%','200%',"9.0.0",false,flashVars,params,attributes);},getMediaType:function($fileInput){var fileType=$fileInput.data('type'),fileName=$fileInput.val(),fileTypes=fileType.split(',');var result=false;$.each(fileTypes,function(i,type){$.each(UploadManager.extensions[type],function(j,extension){var fileExtension=fileName.substr((fileName.length-extension.length),extension.length);if(fileExtension.toLowerCase()===extension){result=type;}});});return result;}};uploader.bindFileEvent();if($input.data('flash')&&swfobject.getFlashPlayerVersion()){uploader.addFlashUploader();}};function Queue(namespace){var obj={items:[],eventName:function(name){return name+'.'+namespace;},length:function(){return this.items.length;},push:function(item){this.items.push(item);$(document).trigger(this.eventName('push'),[item]);},pop:function(){var item=this.items.shift();$(document).trigger(this.eventName('pop'),[item]);return item;},next:function(){var popped=this.pop();if(popped===undefined){return false;}
return popped;}};return obj;}
function Table(namespace){return{items:{},eventName:function(name){return name+'.'+namespace;},length:function(){var count=0;$.each(this.items,function(){count++;});return count;},get:function(key){return this.items[key];},set:function(key,val){this.items[key]=val;$(document).trigger(this.eventName('set'),[key]);},all:function(){return this.items;},unset:function(key){delete(this.items[key]);$(document).trigger(this.eventName('unset'),[key]);}};}
$.ajaxSetup({converters:{'iframe json':function(iframe){return iframe&&$.parseJSON($(iframe[0].body).text());}}});$.ajaxTransport('iframe',function(opts,origOpts,jqXHR){if(opts.async&&(opts.type==='POST'||opts.type==='GET')){var form,iframe;var uid=(new Date()).getTime();return{send:function(headers,completeCallback){form=$('<form>').css('display','none');form.prop('enctype','multipart/form-data').prop('encoding','multipart/form-data');iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+uid+'"></iframe>');iframe.on('load',function(){iframe.off('load').on('load',function(){var response;try{response=iframe.contents();if(!response.length||!response[0].firstChild){throw new Error();}}catch(e){response=undefined;}
completeCallback(200,"OK",{'iframe':response});$('<iframe src="javascript:false;"></iframe>').appendTo(form);form.remove();});form.prop('target',iframe.prop('name')).prop('action',opts.url).prop('method',opts.type);if(opts.formData){$.each(opts.formData,function(key,val){form.append($('<input type="hidden"/>').prop('name','file['+key+']').val(val));});}
var fileClone=false;if(opts.file&&opts.file.length&&opts.type==='POST'){fileClone=opts.file.clone();opts.file.after(fileClone);form.append(opts.file.prop('name','file'));}
form.submit();if(fileClone&&fileClone.length){opts.file.prop('name',fileClone.prop('name'));fileClone.replaceWith(opts.file);}});form.append(iframe).appendTo(document.body);},abort:function(){if(iframe){iframe.off('load').prop('src','javascript:false;');}
if(form){form.remove();}}};}});virb.uploader=UploadManager;if(virb.config.initUploader===undefined||virb.config.initUploader===true){$(function(){virb.uploader.init();});}})();;(function($){$.onboarding={objs:{},init:function(){this.objs.progressBar=$('#onboarding-progress');this.objs.currentProgressItem=$('#onboarding-progress').find('li.current');this.attachEvents();},attachEvents:function(){var self=this;$('#close-progress').click(function(){self.endOnboarding();return false;});$('.tour-trigger').click(function(){self.showTip($(this));return false;});$('#reset-help').click(function(){self.resetHelp();return false;});this.objs.progressBar.find('li').hover(function(){self.openProgressItems($(this));},function(){self.closeProgressItems($(this));});this.objs.progressBar.find('ul').mouseleave(function(){self.resetProgressItemState();});},openProgressItems:function($hoverObj){var parentUl=this.objs.progressBar;$hoverObj.addClass('open').removeClass('collapse');parentUl.find('li:not(.open)').addClass('collapse');},closeProgressItems:function($hoverObj){$hoverObj.removeClass('open').addClass('collapse');},resetProgressItemState:function(){this.objs.progressBar.find('li').removeClass('open collapse');},endOnboarding:function(){var self=this;var dataObj={model:'Build/User',params:{action:'clearOnboarding'}};$.submitAjax(dataObj,{ok:function(result){self.objs.progressBar.slideUp();self.hideAllTips();self.hideAllTriggers();},fail:function(result){virb.log('error '+result);}});},showTip:function($trigger){var tip=$trigger.next('.tour-tip'),self=this;this.hideAllTips();if(!tip.is(":visible")){var height=tip.height();if(tip.hasClass('point-left')){tip.fadeIn('fast').css({top:-8,left:35});}else if(tip.hasClass('point-top')){tip.fadeIn('fast').css({top:35,left:-11});}else if(tip.hasClass('point-bottom-corner')){tip.fadeIn('fast').css({top:-height-45,left:-2});}else{tip.fadeIn('fast').css({top:-height-45,left:-143});}
$trigger.addClass('active');}else{this.hideTip($trigger);}
$("body").click(function(){self.hideAllTips();console.log('hello');});},hideTip:function($trigger){$('body').unbind('click');$trigger.next('.tour-tip').fadeOut().removeClass('active');},hideAllTips:function(){$('body').unbind('click');if($(".tour-tip").prev('.tour-trigger').hasClass('active')){$('.tour-tip').fadeOut().prev('.tour-trigger').removeClass('active');}},hideAllTriggers:function(){$('#tour-popup-collection').fadeOut();},resetHelp:function(){var self=this;var dataObj={model:'Build/User',params:{action:'startOnboarding'}};$.submitAjax(dataObj,{ok:function(result){$('#tour-popup-collection').fadeIn();self.objs.progressBar.slideDown();},fail:function(result){virb.log('error '+result);}});},setOnboardingModalViewed:function(){var dataObj={model:'Build/User',params:{action:'setOnboardingModalViewed'}};$.submitAjax(dataObj,{ok:function(result){virb.log('success'+result);},fail:function(result){virb.log('error '+result);}});},showOnboardingModal:function(){var expireTime=1000*60*60*24*7,expireDate=new Date(new Date().getTime()+expireTime),onboardingModalHTML=$("#onboarding-modal").html();virb.$.overlay.show({type:'custom',"html":onboardingModalHTML,customClass:'overlay-onboarding'});document.cookie='onboardingModalViewed=true;expires='+expireDate.toGMTString()+'; path=/';},showFinishedNotice:function(){var expireTime=1000*60*60*24*7,expireDate=new Date(new Date().getTime()+expireTime),notice=$('.complete-notice');notice.fadeIn(function(){notice.delay(6000).fadeOut();});document.cookie='onboardingCompletionNoticeViewed=true;expires='+expireDate.toGMTString()+'; path=/';}}
virb.$.onboarding=$.onboarding;$(function(){virb.$.onboarding.init();});})(virb.$);;(function($)
{$.fileModal={withEditor:false,fileStorageHtml:'',sortType:'mimetype',files:[],init:function(args)
{var self=this;$.each(args,function(key,value){self[key]=value;});this.attachEvents();},attachEvents:function()
{var self=this;var rows=virb.$('ul.files li').die();rows.find('span.insert').die();var rows=virb.$('ul.files li').live('mouseover',function(){if(false===self.withEditor)
virb.$.fileModal.addCopy($(this));});rows.find('span.insert').live('mousedown',function(){var name=$(this).siblings('span.filename').text(),link=$(this).siblings('textarea.fileurl').val();$(this).addClass('on').removeClass('off');tinyMCE.execCommand("mceInsertContent",false,'<a href="'+link+'">'+name+'</a>');});},getFileItemHtml:function(response)
{var UID=virb.$.getUID(),self=this;var html='';html+='<div class="file-listing">';html+='<ul class="settingsnav two">';html+='<li class="first active"><a href="#" class="virb-files">Your Documents &amp; Files</a></li>';html+='<li><a href="#" class="dropbox-files">Your Files on Dropbox</a></li>';html+='</ul><hr class="settingsnav" />';var hideLegend='style="display: none"';var hideNoFiles='';var noFilesClass='no_files';if(response.response.files&&response.response.files.length>0)
{hideLegend='';hideNoFiles='style="display: none"';noFilesClass='';}
html+='<span id="legend" '+hideLegend+'><div class="type"><a href="#type" class="legend asc" onclick="virb.$.fileModal.sortFiles(\'mimetype\')">type &darr;</a></div><div class="name"><a href="#name" class="legend" onclick="virb.$.fileModal.sortFiles(\'filename\')">name</a></div><div class="size"><a href="#size" class="legend" onclick="virb.$.fileModal.sortFiles(\'filesize\')">size</a></div></span>';html+='<ul class="files '+noFilesClass+'">';html+='<li class="no_files" '+hideNoFiles+'>';html+='You have not uploaded any files yet. Please add files through the <a href="/files">Files</a> page';html+='</li>';if(response.response.files&&response.response.files.length>0)
{self.files=response.response.files;for(var i=0;i<response.response.files.length;i++)
{var file=response.response.files[i];html+=self.getFileHtml(i,file,'fileitem');}}
html+='</ul>';html+='</div>';return html;},getDropboxHtml:function(response)
{var UID=virb.$.getUID(),self=this;var html='';html+='<div class="file-listing">';html+='<ul class="settingsnav two">';html+='<li class="first"><a href="#" class="virb-files">Your Documents &amp; Files</a></li>';html+='<li class="active"><a href="#" class="dropbox-files">Your Files on Dropbox</a></li>';html+='</ul><hr class="settingsnav" />';var hideLegend='style="display: none"';var hideNoFiles='';var noFilesClass='no_files';if(response.response.files&&response.response.files.length>0)
{hideLegend='';hideNoFiles='style="display: none"';noFilesClass='';}
html+='<span id="legend" '+hideLegend+'>';html+='<div class="type"><a href="#type" class="legend asc" onclick="virb.$.fileModal.sortFiles(\'mimetype\')">&darr; type</a></div>';html+='<div class="name"><a href="#name" class="legend" onclick="virb.$.fileModal.sortFiles(\'filename\')">name</a></div>';html+='<div class="size"><a href="#size" class="legend" onclick="virb.$.fileModal.sortFiles(\'filesize\')">size</a></div>';html+='</span>';if(response.code===200)
{html+='<ul class="files '+noFilesClass+'">';html+='<li class="no_files" '+hideNoFiles+'>You have not uploaded any files yet.</li>';if(response.response.files&&response.response.files.length>0)
{self.files=response.response.files;for(var i=0;i<response.response.files.length;i++)
{var file=response.response.files[i];html+=self.getFileHtml(i,file,'dropbox');}}
html+='</ul>';html+='<p>';html+='<span class="note">';html+='Place your files in <code>Dropbox &gt; Apps &gt; Virb</code> to get them to display here. <em>(subfolders not currently supported)</em>';html+='</span>';html+='<a href="#" class="refresh">Refresh</a>';html+='</p>';}
else if(response.code===404)
{html+='<ul class="files '+noFilesClass+'">';html+='<li class="no_files" '+hideNoFiles+'>Please create the following directory in your Dropbox: <code>Public &gt; Virb</code>.</li>';html+='</ul>';}
else
{html+='<ul class="files '+noFilesClass+'">';html+='<li class="no_files" '+hideNoFiles+'>Access files for use on your pages by connecting a Dropbox Account. Connect your Dropbox Account from the <a href="/files">Files</a> page.</li>';html+='</ul>';}
html+='</div>';return html;},showFileManager:function()
{var self=this;virb.$.submitAjax('data[FileItem][action]=getFiles',{ok:function(response){var html=self.getFileItemHtml(response);$('.file-listing a.virb-files').live('click',function(){self.currentContext='virb';virb.$.overlay.ajaxMessage('processing','Loading files...');virb.$.submitAjax('data[FileItem][action]=getFiles',{ok:function(response){$('#overlay-content').html(self.getFileItemHtml(response));virb.$.overlay.hideAjaxMessages();virb.uploader.bindFileEvent($('.overlay-storage .uploader'));}});return false;});$('.file-listing a.dropbox-files').live('click',function(){self.selectDropbox();return false;});$('.file-listing a.refresh').live('click',function(){virb.$.overlay.ajaxMessage('processing','Reloading Dropbox files...');self.getDropboxFiles();return false;});virb.$.overlay.hideAjaxMessages();virb.$.overlay.show({type:'custom','html':html,customClass:'overlay-storage'});virb.uploader.bindFileEvent($('.overlay-storage .uploader'));}});},selectDropbox:function(){this.currentContext='dropbox';virb.$.overlay.ajaxMessage('processing','Loading Dropbox files...');this.getDropboxFiles();},getDropboxFiles:function()
{var self=this;virb.$.submitAjax('data[Build/DropboxAuth][action]=getFiles',{ok:function(response){$('#overlay-content').html(self.getDropboxHtml(response));virb.$.overlay.hideAjaxMessages();},fail:function(response){$('#overlay-content').html(self.getDropboxHtml(response));$('a.connect').live('click',function(){window.open('/services/auth/dropbox',"FeedAuth",'width=790,height=580,scrollbars=yes');return false;});if(response.code===600)
{virb.$.overlay.ajaxMessage('error',response.message);}
else
{virb.$.overlay.hideAjaxMessages();}}});},getFileHtml:function(index,file,context)
{var mimetype=file.mimetype.replace('/',' ');if(index==0)
{mimetype+=' top';}
var extension=file.url.split('.');mimetype+=' '+extension[(extension.length-1)];var item='<li id="FileItem_'+file.id+'" class="'+mimetype+'">';item+='<span class="fileicon"></span>';item+='<span class="filename">'+file.title+'</span> ';item+='<textarea class="fileurl" onclick="virb.$(this).focus().select()">'+file.url+'</textarea> ';if(this.withEditor)
item+='<span class="modify toggle off insert"><a href="#insert"><span class="off">Insert Link</span><span class="on">Inserted</span></a></span>';else
item+='<span class="modify toggle off copy"><a href="#copy"><span class="off">Copy Link</span><span class="on">Copied</span></a></span>';item+='<span class="filesize">'+file.filesize+'</span>';item+='</li>';return item;},addCopy:function($clickObj)
{$span=$clickObj.find('span.copy');var link=$clickObj.find('textarea.fileurl').val();if(false==$clickObj.find('object').length)
{var html='';html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="183" height="35" id="'+this.cdnDomain+'/_assets/_swf/clipboard" align="middle">';html+='<param name="allowScriptAccess" value="sameDomain" />';html+='<param name="allowFullScreen" value="false" /><param name="wmode" value="transparent" />';html+='<param name="movie" value="http://'+this.cdnDomain+'/_assets/_swf/clipboard.swf?clipText='+link+'" /><param name="quality" value="high" /><param name="bgcolor" value="#ff0099" /> <embed src="http://'+this.cdnDomain+'/_assets/_swf/clipboard.swf?clipText='+link+'" quality="high" bgcolor="#ff0099" width="183" height="35" wmode="transparent" name="virb.com/_assets/_swf/clipboard" align="middle" allowScriptAccess="sameDomain" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />';html+='</object>';$span.prepend(html);}},showFiles:function()
{virb.$('#overlay-content #copy_html').remove();virb.$('#overlay-wrapper.overlay-storage #overlay-content .file-listing').fadeIn();},sortFiles:function(sortType,update)
{if(sortType)
{this.sortType=sortType;}
switch(this.sortType)
{case"mimetype":this.files.sort(this.sortByMimetype);$sortObj=virb.$('.overlay-storage .type a').html('type');virb.$('.overlay-storage .name a').html('name').removeClass('desc').removeClass('asc');virb.$('.overlay-storage .size a').html('size').removeClass('desc').removeClass('asc');break;case"filename":this.files.sort(this.sortByFilename);virb.$('.overlay-storage .type a').html('type').removeClass('desc').removeClass('asc');$sortObj=virb.$('.overlay-storage .name a').html('name');virb.$('.overlay-storage .size a').html('size').removeClass('desc').removeClass('asc');break;case"filesize":this.files.sort(this.sortByFilesize);virb.$('.overlay-storage .type a').html('type').removeClass('desc').removeClass('asc');virb.$('.overlay-storage .name a').html('name').removeClass('desc').removeClass('asc');$sortObj=virb.$('.overlay-storage .size a').html('size');break;}
if($sortObj.hasClass('asc')&&!update)
{var theText=$sortObj.html();$sortObj.html(theText+' &uarr;');$sortObj.removeClass('asc').addClass('desc');this.files.reverse();}
else
{var theText=$sortObj.html();$sortObj.html(theText+' &darr;');$sortObj.removeClass('desc').addClass('asc');}
var html='';var hideNoFiles='';if(this.files.length>0)
{hideNoFiles='style="display: none"';}
html+='<li class="no_files" '+hideNoFiles+'>You have not uploaded any files yet.</li>';for(var i=0;i<this.files.length;i++)
{var file=this.files[i];html+=this.getFileHtml(i,file,this.currentContext);}
virb.$('.overlay-storage ul.files').html(html);},sortByFilename:function(a,b)
{var x=a.title.toLowerCase();var y=b.title.toLowerCase();return((x<y)?-1:((x>y)?1:0));},sortByFilesize:function(a,b)
{var x=a.bytes;var y=b.bytes;return x-y;},sortByMimetype:function(a,b)
{var x=a.mimetype.toLowerCase();var y=b.mimetype.toLowerCase();return((x<y)?-1:((x>y)?1:0));},processFileManager:function(results)
{$('#file-manager-form #legend').show();$('#file-manager-form ul').removeClass('no_files').find('.no_files').hide();this.files.push(results);this.sortFiles(false,true);var percent=Math.round(results.storageUsed/results.storageLimit*100);$('#fileManagerUsed').html(results.storageUsed);$('#fileManagerLimit').html(results.storageLimit);$('#storage_left').css({width:percent+'%'});$.preventNav(false);}};finishDropboxAuth=function()
{virb.$.fileModal.getDropboxFiles();};virb.$.fileModal=$.fileModal;})(virb.$);;
/* Video.js v4.6.3 Copyright 2014 Brightcove, Inc. https://github.com/videojs/video.js/blob/master/LICENSE */
(function(){var b=void 0,f=!0,j=null,l=!1;function m(){return function(){}}function q(a){return function(){return this[a]}}function r(a){return function(){return a}}var t;document.createElement("video");document.createElement("audio");document.createElement("track");function u(a,c,d){if("string"===typeof a){0===a.indexOf("#")&&(a=a.slice(1));if(u.Aa[a])return u.Aa[a];a=u.w(a)}if(!a||!a.nodeName)throw new TypeError("The element or ID supplied is not valid. (videojs)");return a.player||new u.Player(a,c,d)}
var videojs=u;window.ke=window.le=u;u.Vb="4.6";u.Qc="https:"==document.location.protocol?"https://":"http://";u.options={techOrder:["html5","flash"],html5:{},flash:{},width:300,height:150,defaultVolume:0,playbackRates:[],children:{mediaLoader:{},posterImage:{},textTrackDisplay:{},loadingSpinner:{},bigPlayButton:{},controlBar:{},errorDisplay:{}},notSupportedMessage:"No compatible source was found for this video."};"GENERATED_CDN_VSN"!==u.Vb&&(videojs.options.flash.swf=u.Qc+"vjs.zencdn.net/"+u.Vb+"/video-js.swf");u.Aa={};"function"===typeof define&&define.amd?define([],function(){return videojs}):"object"===typeof exports&&"object"===typeof module&&(module.exports=videojs);u.pa=u.CoreObject=m();u.pa.extend=function(a){var c,d;a=a||{};c=a.init||a.h||this.prototype.init||this.prototype.h||m();d=function(){c.apply(this,arguments)};d.prototype=u.l.create(this.prototype);d.prototype.constructor=d;d.extend=u.pa.extend;d.create=u.pa.create;for(var e in a)a.hasOwnProperty(e)&&(d.prototype[e]=a[e]);return d};u.pa.create=function(){var a=u.l.create(this.prototype);this.apply(a,arguments);return a};u.d=function(a,c,d){var e=u.getData(a);e.D||(e.D={});e.D[c]||(e.D[c]=[]);d.v||(d.v=u.v++);e.D[c].push(d);e.X||(e.disabled=l,e.X=function(c){if(!e.disabled){c=u.pc(c);var d=e.D[c.type];if(d)for(var d=d.slice(0),k=0,p=d.length;k<p&&!c.xc();k++)d[k].call(a,c)}});1==e.D[c].length&&(document.addEventListener?a.addEventListener(c,e.X,l):document.attachEvent&&a.attachEvent("on"+c,e.X))};u.p=function(a,c,d){if(u.tc(a)){var e=u.getData(a);if(e.D)if(c){var g=e.D[c];if(g){if(d){if(d.v)for(e=0;e<g.length;e++)g[e].v===d.v&&g.splice(e--,1)}else e.D[c]=[];u.kc(a,c)}}else for(g in e.D)c=g,e.D[c]=[],u.kc(a,c)}};u.kc=function(a,c){var d=u.getData(a);0===d.D[c].length&&(delete d.D[c],document.removeEventListener?a.removeEventListener(c,d.X,l):document.detachEvent&&a.detachEvent("on"+c,d.X));u.Fb(d.D)&&(delete d.D,delete d.X,delete d.disabled);u.Fb(d)&&u.Ec(a)};u.pc=function(a){function c(){return f}function d(){return l}if(!a||!a.Gb){var e=a||window.event;a={};for(var g in e)"layerX"!==g&&("layerY"!==g&&"keyboardEvent.keyLocation"!==g)&&("returnValue"==g&&e.preventDefault||(a[g]=e[g]));a.target||(a.target=a.srcElement||document);a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;a.preventDefault=function(){e.preventDefault&&e.preventDefault();a.returnValue=l;a.sd=c;a.defaultPrevented=f};a.sd=d;a.defaultPrevented=l;a.stopPropagation=function(){e.stopPropagation&&e.stopPropagation();a.cancelBubble=f;a.Gb=c};a.Gb=d;a.stopImmediatePropagation=function(){e.stopImmediatePropagation&&e.stopImmediatePropagation();a.xc=c;a.stopPropagation()};a.xc=d;if(a.clientX!=j){g=document.documentElement;var h=document.body;a.pageX=a.clientX+(g&&g.scrollLeft||h&&h.scrollLeft||0)-(g&&g.clientLeft||h&&h.clientLeft||0);a.pageY=a.clientY+(g&&g.scrollTop||h&&h.scrollTop||0)-(g&&g.clientTop||h&&h.clientTop||0)}a.which=a.charCode||a.keyCode;a.button!=j&&(a.button=a.button&1?0:a.button&4?1:a.button&2?2:0)}return a};u.k=function(a,c){var d=u.tc(a)?u.getData(a):{},e=a.parentNode||a.ownerDocument;"string"===typeof c&&(c={type:c,target:a});c=u.pc(c);d.X&&d.X.call(a,c);if(e&&!c.Gb()&&c.bubbles!==l)u.k(e,c);else if(!e&&!c.defaultPrevented&&(d=u.getData(c.target),c.target[c.type])){d.disabled=f;if("function"===typeof c.target[c.type])c.target[c.type]();d.disabled=l}return!c.defaultPrevented};u.W=function(a,c,d){function e(){u.p(a,c,e);d.apply(this,arguments)}e.v=d.v=d.v||u.v++;u.d(a,c,e)};var v=Object.prototype.hasOwnProperty;u.e=function(a,c){var d,e;d=document.createElement(a||"div");for(e in c)v.call(c,e)&&(-1!==e.indexOf("aria-")||"role"==e?d.setAttribute(e,c[e]):d[e]=c[e]);return d};u.$=function(a){return a.charAt(0).toUpperCase()+a.slice(1)};u.l={};u.l.create=Object.create||function(a){function c(){}c.prototype=a;return new c};u.l.wa=function(a,c,d){for(var e in a)v.call(a,e)&&c.call(d||this,e,a[e])};u.l.B=function(a,c){if(!c)return a;for(var d in c)v.call(c,d)&&(a[d]=c[d]);return a};u.l.gd=function(a,c){var d,e,g;a=u.l.copy(a);for(d in c)v.call(c,d)&&(e=a[d],g=c[d],a[d]=u.l.Sa(e)&&u.l.Sa(g)?u.l.gd(e,g):c[d]);return a};u.l.copy=function(a){return u.l.B({},a)};u.l.Sa=function(a){return!!a&&"object"===typeof a&&"[object Object]"===a.toString()&&a.constructor===Object};u.bind=function(a,c,d){function e(){return c.apply(a,arguments)}c.v||(c.v=u.v++);e.v=d?d+"_"+c.v:c.v;return e};u.ta={};u.v=1;u.expando="vdata"+(new Date).getTime();u.getData=function(a){var c=a[u.expando];c||(c=a[u.expando]=u.v++,u.ta[c]={});return u.ta[c]};u.tc=function(a){a=a[u.expando];return!(!a||u.Fb(u.ta[a]))};u.Ec=function(a){var c=a[u.expando];if(c){delete u.ta[c];try{delete a[u.expando]}catch(d){a.removeAttribute?a.removeAttribute(u.expando):a[u.expando]=j}}};u.Fb=function(a){for(var c in a)if(a[c]!==j)return l;return f};u.o=function(a,c){-1==(" "+a.className+" ").indexOf(" "+c+" ")&&(a.className=""===a.className?c:a.className+" "+c)};u.r=function(a,c){var d,e;if(-1!=a.className.indexOf(c)){d=a.className.split(" ");for(e=d.length-1;0<=e;e--)d[e]===c&&d.splice(e,1);a.className=d.join(" ")}};u.A=u.e("video");u.M=navigator.userAgent;u.Vc=/iPhone/i.test(u.M);u.Uc=/iPad/i.test(u.M);u.Wc=/iPod/i.test(u.M);u.Tc=u.Vc||u.Uc||u.Wc;var aa=u,w;var x=u.M.match(/OS (\d+)_/i);w=x&&x[1]?x[1]:b;aa.$d=w;u.Sc=/Android/i.test(u.M);var ba=u,y;var z=u.M.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i),A,B;z?(A=z[1]&&parseFloat(z[1]),B=z[2]&&parseFloat(z[2]),y=A&&B?parseFloat(z[1]+"."+z[2]):A?A:j):y=j;ba.Ub=y;u.Xc=u.Sc&&/webkit/i.test(u.M)&&2.3>u.Ub;u.Yb=/Firefox/i.test(u.M);u.ae=/Chrome/i.test(u.M);u.fc=!!("ontouchstart"in window||window.Rc&&document instanceof window.Rc);u.Cb=function(a){var c,d,e,g;c={};if(a&&a.attributes&&0<a.attributes.length){d=a.attributes;for(var h=d.length-1;0<=h;h--){e=d[h].name;g=d[h].value;if("boolean"===typeof a[e]||-1!==",autoplay,controls,loop,muted,default,".indexOf(","+e+","))g=g!==j?f:l;c[e]=g}}return c};u.de=function(a,c){var d="";document.defaultView&&document.defaultView.getComputedStyle?d=document.defaultView.getComputedStyle(a,"").getPropertyValue(c):a.currentStyle&&(d=a["client"+c.substr(0,1).toUpperCase()+c.substr(1)]+"px");return d};u.Eb=function(a,c){c.firstChild?c.insertBefore(a,c.firstChild):c.appendChild(a)};u.Na={};u.w=function(a){0===a.indexOf("#")&&(a=a.slice(1));return document.getElementById(a)};u.ya=function(a,c){c=c||a;var d=Math.floor(a%60),e=Math.floor(a/60%60),g=Math.floor(a/3600),h=Math.floor(c/60%60),k=Math.floor(c/3600);if(isNaN(a)||Infinity===a)g=e=d="-";g=0<g||0<k?g+":":"";return g+(((g||10<=h)&&10>e?"0"+e:e)+":")+(10>d?"0"+d:d)};u.cd=function(){document.body.focus();document.onselectstart=r(l)};u.Ud=function(){document.onselectstart=r(f)};u.trim=function(a){return(a+"").replace(/^\s+|\s+$/g,"")};u.round=function(a,c){c||(c=0);return Math.round(a*Math.pow(10,c))/Math.pow(10,c)};u.zb=function(a,c){return{length:1,start:function(){return a},end:function(){return c}}};u.get=function(a,c,d,e){var g,h,k,p;d=d||m();"undefined"===typeof XMLHttpRequest&&(window.XMLHttpRequest=function(){try{return new window.ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new window.ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(d){}throw Error("This browser does not support XMLHttpRequest.");});h=new XMLHttpRequest;k=u.Gd(a);p=window.location;k.protocol+k.host!==p.protocol+p.host&&window.XDomainRequest&&!("withCredentials"in
h)?(h=new window.XDomainRequest,h.onload=function(){c(h.responseText)},h.onerror=d,h.onprogress=m(),h.ontimeout=d):(g="file:"==k.protocol||"file:"==p.protocol,h.onreadystatechange=function(){4===h.readyState&&(200===h.status||g&&0===h.status?c(h.responseText):d(h.responseText))});try{h.open("GET",a,f),e&&(h.withCredentials=f)}catch(n){d(n);return}try{h.send()}catch(s){d(s)}};u.Ld=function(a){try{var c=window.localStorage||l;c&&(c.volume=a)}catch(d){22==d.code||1014==d.code?u.log("LocalStorage Full (VideoJS)",d):18==d.code?u.log("LocalStorage not allowed (VideoJS)",d):u.log("LocalStorage Error (VideoJS)",d)}};u.rc=function(a){a.match(/^https?:\/\//)||(a=u.e("div",{innerHTML:'<a href="'+a+'">x</a>'}).firstChild.href);return a};u.Gd=function(a){var c,d,e,g;g="protocol hostname port pathname search hash host".split(" ");d=u.e("a",{href:a});if(e=""===d.host&&"file:"!==d.protocol)c=u.e("div"),c.innerHTML='<a href="'+a+'"></a>',d=c.firstChild,c.setAttribute("style","display:none; position:absolute;"),document.body.appendChild(c);a={};for(var h=0;h<g.length;h++)a[g[h]]=d[g[h]];e&&document.body.removeChild(c);return a};function D(){}var E=window.console||{log:D,warn:D,error:D};function F(a,c){var d=Array.prototype.slice.call(c);a?d.unshift(a.toUpperCase()+":"):a="log";u.log.history.push(d);d.unshift("VIDEOJS:");if(E[a].apply)E[a].apply(E,d);else E[a](d.join(" "))}u.log=function(){F(j,arguments)};u.log.history=[];u.log.error=function(){F("error",arguments)};u.log.warn=function(){F("warn",arguments)};u.pd=function(a){var c,d;a.getBoundingClientRect&&a.parentNode&&(c=a.getBoundingClientRect());if(!c)return{left:0,top:0};a=document.documentElement;d=document.body;return{left:u.round(c.left+(window.pageXOffset||d.scrollLeft)-(a.clientLeft||d.clientLeft||0)),top:u.round(c.top+(window.pageYOffset||d.scrollTop)-(a.clientTop||d.clientTop||0))}};u.oa={};u.oa.Kb=function(a,c){var d,e,g;a=u.l.copy(a);for(d in c)c.hasOwnProperty(d)&&(e=a[d],g=c[d],a[d]=u.l.Sa(e)&&u.l.Sa(g)?u.oa.Kb(e,g):c[d]);return a};u.a=u.pa.extend({h:function(a,c,d){this.c=a;this.j=u.l.copy(this.j);c=this.options(c);this.T=c.id||(c.el&&c.el.id?c.el.id:a.id()+"_component_"+u.v++);this.xd=c.name||j;this.b=c.el||this.e();this.N=[];this.Oa={};this.Pa={};this.vc();this.K(d);if(c.Fc!==l){var e,g;e=u.bind(this.m(),this.m().reportUserActivity);this.d("touchstart",function(){e();clearInterval(g);g=setInterval(e,250)});a=function(){e();clearInterval(g)};this.d("touchmove",e);this.d("touchend",a);this.d("touchcancel",a)}}});t=u.a.prototype;t.dispose=function(){this.k({type:"dispose",bubbles:l});if(this.N)for(var a=this.N.length-1;0<=a;a--)this.N[a].dispose&&this.N[a].dispose();this.Pa=this.Oa=this.N=j;this.p();this.b.parentNode&&this.b.parentNode.removeChild(this.b);u.Ec(this.b);this.b=j};t.c=f;t.m=q("c");t.options=function(a){return a===b?this.j:this.j=u.oa.Kb(this.j,a)};t.e=function(a,c){return u.e(a,c)};t.w=q("b");t.ia=function(){return this.u||this.b};t.id=q("T");t.name=q("xd");t.children=q("N");t.rd=function(a){return this.Oa[a]};t.ja=function(a){return this.Pa[a]};t.V=function(a,c){var d,e;"string"===typeof a?(e=a,c=c||{},d=c.componentClass||u.$(e),c.name=e,d=new window.videojs[d](this.c||this,c)):d=a;this.N.push(d);"function"===typeof d.id&&(this.Oa[d.id()]=d);(e=e||d.name&&d.name())&&(this.Pa[e]=d);"function"===typeof d.el&&d.el()&&this.ia().appendChild(d.el());return d};t.removeChild=function(a){"string"===typeof a&&(a=this.ja(a));if(a&&this.N){for(var c=l,d=this.N.length-1;0<=d;d--)if(this.N[d]===a){c=f;this.N.splice(d,1);break}c&&(this.Oa[a.id]=j,this.Pa[a.name]=j,(c=a.w())&&c.parentNode===this.ia()&&this.ia().removeChild(a.w()))}};t.vc=function(){var a,c,d,e;a=this;if(c=this.options().children)if(c instanceof Array)for(var g=0;g<c.length;g++)d=c[g],"string"==typeof d?(e=d,d={}):e=d.name,a[e]=a.V(e,d);else u.l.wa(c,function(c,d){d!==l&&(a[c]=a.V(c,d))})};t.S=r("");t.d=function(a,c){u.d(this.b,a,u.bind(this,c));return this};t.p=function(a,c){u.p(this.b,a,c);return this};t.W=function(a,c){u.W(this.b,a,u.bind(this,c));return this};t.k=function(a,c){u.k(this.b,a,c);return this};t.K=function(a){a&&(this.ca?a.call(this):(this.Za===b&&(this.Za=[]),this.Za.push(a)));return this};t.Ea=function(){this.ca=f;var a=this.Za;if(a&&0<a.length){for(var c=0,d=a.length;c<d;c++)a[c].call(this);this.Za=[];this.k("ready")}};t.o=function(a){u.o(this.b,a);return this};t.r=function(a){u.r(this.b,a);return this};t.show=function(){this.b.style.display="block";return this};t.G=function(){this.b.style.display="none";return this};function G(a){a.r("vjs-lock-showing")}t.disable=function(){this.G();this.show=m()};t.width=function(a,c){return H(this,"width",a,c)};t.height=function(a,c){return H(this,"height",a,c)};t.kd=function(a,c){return this.width(a,f).height(c)};function H(a,c,d,e){if(d!==b)return a.b.style[c]=-1!==(""+d).indexOf("%")||-1!==(""+d).indexOf("px")?d:"auto"===d?"":d+"px",e||a.k("resize"),a;if(!a.b)return 0;d=a.b.style[c];e=d.indexOf("px");return-1!==e?parseInt(d.slice(0,e),10):parseInt(a.b["offset"+u.$(c)],10)}
function I(a){var c,d,e,g,h,k,p,n;c=0;d=j;a.d("touchstart",function(a){1===a.touches.length&&(d=a.touches[0],c=(new Date).getTime(),g=f)});a.d("touchmove",function(a){1<a.touches.length?g=l:d&&(k=a.touches[0].pageX-d.pageX,p=a.touches[0].pageY-d.pageY,n=Math.sqrt(k*k+p*p),22<n&&(g=l))});h=function(){g=l};a.d("touchleave",h);a.d("touchcancel",h);a.d("touchend",function(a){d=j;g===f&&(e=(new Date).getTime()-c,250>e&&(a.preventDefault(),this.k("tap")))})}
u.s=u.a.extend({h:function(a,c){u.a.call(this,a,c);I(this);this.d("tap",this.q);this.d("click",this.q);this.d("focus",this.Va);this.d("blur",this.Ua)}});t=u.s.prototype;t.e=function(a,c){var d;c=u.l.B({className:this.S(),role:"button","aria-live":"polite",tabIndex:0},c);d=u.a.prototype.e.call(this,a,c);c.innerHTML||(this.u=u.e("div",{className:"vjs-control-content"}),this.xb=u.e("span",{className:"vjs-control-text",innerHTML:this.sa||"Need Text"}),this.u.appendChild(this.xb),d.appendChild(this.u));return d};t.S=function(){return"vjs-control "+u.a.prototype.S.call(this)};t.q=m();t.Va=function(){u.d(document,"keyup",u.bind(this,this.da))};t.da=function(a){if(32==a.which||13==a.which)a.preventDefault(),this.q()};t.Ua=function(){u.p(document,"keyup",u.bind(this,this.da))};u.Q=u.a.extend({h:function(a,c){u.a.call(this,a,c);this.bd=this.ja(this.j.barName);this.handle=this.ja(this.j.handleName);this.d("mousedown",this.Wa);this.d("touchstart",this.Wa);this.d("focus",this.Va);this.d("blur",this.Ua);this.d("click",this.q);this.c.d("controlsvisible",u.bind(this,this.update));a.d(this.Bc,u.bind(this,this.update));this.R={}}});t=u.Q.prototype;t.e=function(a,c){c=c||{};c.className+=" vjs-slider";c=u.l.B({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},c);return u.a.prototype.e.call(this,a,c)};t.Wa=function(a){a.preventDefault();u.cd();this.R.move=u.bind(this,this.Lb);this.R.end=u.bind(this,this.Mb);u.d(document,"mousemove",this.R.move);u.d(document,"mouseup",this.R.end);u.d(document,"touchmove",this.R.move);u.d(document,"touchend",this.R.end);this.Lb(a)};t.Mb=function(){u.Ud();u.p(document,"mousemove",this.R.move,l);u.p(document,"mouseup",this.R.end,l);u.p(document,"touchmove",this.R.move,l);u.p(document,"touchend",this.R.end,l);this.update()};t.update=function(){if(this.b){var a,c=this.Db(),d=this.handle,e=this.bd;isNaN(c)&&(c=0);a=c;if(d){a=this.b.offsetWidth;var g=d.w().offsetWidth;a=g?g/a:0;c*=1-a;a=c+a/2;d.w().style.left=u.round(100*c,2)+"%"}e.w().style.width=u.round(100*a,2)+"%"}};function J(a,c){var d,e,g,h;d=a.b;e=u.pd(d);h=g=d.offsetWidth;d=a.handle;if(a.j.Wd)return h=e.top,e=c.changedTouches?c.changedTouches[0].pageY:c.pageY,d&&(d=d.w().offsetHeight,h+=d/2,g-=d),Math.max(0,Math.min(1,(h-e+g)/g));g=e.left;e=c.changedTouches?c.changedTouches[0].pageX:c.pageX;d&&(d=d.w().offsetWidth,g+=d/2,h-=d);return Math.max(0,Math.min(1,(e-g)/h))}t.Va=function(){u.d(document,"keyup",u.bind(this,this.da))};t.da=function(a){37==a.which?(a.preventDefault(),this.Hc()):39==a.which&&(a.preventDefault(),this.Ic())};t.Ua=function(){u.p(document,"keyup",u.bind(this,this.da))};t.q=function(a){a.stopImmediatePropagation();a.preventDefault()};u.Y=u.a.extend();u.Y.prototype.defaultValue=0;u.Y.prototype.e=function(a,c){c=c||{};c.className+=" vjs-slider-handle";c=u.l.B({innerHTML:'<span class="vjs-control-text">'+this.defaultValue+"</span>"},c);return u.a.prototype.e.call(this,"div",c)};u.ga=u.a.extend();function ca(a,c){a.V(c);c.d("click",u.bind(a,function(){G(this)}))}u.ga.prototype.e=function(){var a=this.options().lc||"ul";this.u=u.e(a,{className:"vjs-menu-content"});a=u.a.prototype.e.call(this,"div",{append:this.u,className:"vjs-menu"});a.appendChild(this.u);u.d(a,"click",function(a){a.preventDefault();a.stopImmediatePropagation()});return a};u.I=u.s.extend({h:function(a,c){u.s.call(this,a,c);this.selected(c.selected)}});u.I.prototype.e=function(a,c){return u.s.prototype.e.call(this,"li",u.l.B({className:"vjs-menu-item",innerHTML:this.j.label},c))};u.I.prototype.q=function(){this.selected(f)};u.I.prototype.selected=function(a){a?(this.o("vjs-selected"),this.b.setAttribute("aria-selected",f)):(this.r("vjs-selected"),this.b.setAttribute("aria-selected",l))};u.L=u.s.extend({h:function(a,c){u.s.call(this,a,c);this.za=this.va();this.V(this.za);this.O&&0===this.O.length&&this.G();this.d("keyup",this.da);this.b.setAttribute("aria-haspopup",f);this.b.setAttribute("role","button")}});t=u.L.prototype;t.ra=l;t.va=function(){var a=new u.ga(this.c);this.options().title&&a.ia().appendChild(u.e("li",{className:"vjs-menu-title",innerHTML:u.$(this.options().title),Sd:-1}));if(this.O=this.createItems())for(var c=0;c<this.O.length;c++)ca(a,this.O[c]);return a};t.ua=m();t.S=function(){return this.className+" vjs-menu-button "+u.s.prototype.S.call(this)};t.Va=m();t.Ua=m();t.q=function(){this.W("mouseout",u.bind(this,function(){G(this.za);this.b.blur()}));this.ra?K(this):L(this)};t.da=function(a){a.preventDefault();32==a.which||13==a.which?this.ra?K(this):L(this):27==a.which&&this.ra&&K(this)};function L(a){a.ra=f;a.za.o("vjs-lock-showing");a.b.setAttribute("aria-pressed",f);a.O&&0<a.O.length&&a.O[0].w().focus()}
function K(a){a.ra=l;G(a.za);a.b.setAttribute("aria-pressed",l)}u.F=function(a){"number"===typeof a?this.code=a:"string"===typeof a?this.message=a:"object"===typeof a&&u.l.B(this,a);this.message||(this.message=u.F.hd[this.code]||"")};u.F.prototype.code=0;u.F.prototype.message="";u.F.prototype.status=j;u.F.Ra="MEDIA_ERR_CUSTOM MEDIA_ERR_ABORTED MEDIA_ERR_NETWORK MEDIA_ERR_DECODE MEDIA_ERR_SRC_NOT_SUPPORTED MEDIA_ERR_ENCRYPTED".split(" ");u.F.hd={1:"You aborted the video playback",2:"A network error caused the video download to fail part-way.",3:"The video playback was aborted due to a corruption problem or because the video used features your browser did not support.",4:"The video could not be loaded, either because the server or network failed or because the format is not supported.",5:"The video is encrypted and we do not have the keys to decrypt it."};for(var M=0;M<u.F.Ra.length;M++)u.F[u.F.Ra[M]]=M,u.F.prototype[u.F.Ra[M]]=M;var N,O,P,Q;N=["requestFullscreen exitFullscreen fullscreenElement fullscreenEnabled fullscreenchange fullscreenerror".split(" "),"webkitRequestFullscreen webkitExitFullscreen webkitFullscreenElement webkitFullscreenEnabled webkitfullscreenchange webkitfullscreenerror".split(" "),"webkitRequestFullScreen webkitCancelFullScreen webkitCurrentFullScreenElement webkitCancelFullScreen webkitfullscreenchange webkitfullscreenerror".split(" "),"mozRequestFullScreen mozCancelFullScreen mozFullScreenElement mozFullScreenEnabled mozfullscreenchange mozfullscreenerror".split(" "),"msRequestFullscreen msExitFullscreen msFullscreenElement msFullscreenEnabled MSFullscreenChange MSFullscreenError".split(" ")];O=N[0];for(Q=0;Q<N.length;Q++)if(N[Q][1]in document){P=N[Q];break}if(P){u.Na.Bb={};for(Q=0;Q<P.length;Q++)u.Na.Bb[O[Q]]=P[Q]}
u.Player=u.a.extend({h:function(a,c,d){this.P=a;a.id=a.id||"vjs_video_"+u.v++;c=u.l.B(da(a),c);this.z={};this.Cc=c.poster;this.yb=c.controls;a.controls=l;c.Fc=l;u.a.call(this,this,c,d);this.controls()?this.o("vjs-controls-enabled"):this.o("vjs-controls-disabled");u.Aa[this.T]=this;c.plugins&&u.l.wa(c.plugins,function(a,c){this[a](c)},this);var e,g,h,k,p,n;e=u.bind(this,this.reportUserActivity);this.d("mousedown",function(){e();clearInterval(g);g=setInterval(e,250)});this.d("mousemove",function(a){if(a.screenX!=p||a.screenY!=n)p=a.screenX,n=a.screenY,e()});this.d("mouseup",function(){e();clearInterval(g)});this.d("keydown",e);this.d("keyup",e);h=setInterval(u.bind(this,function(){this.na&&(this.na=l,this.userActive(f),clearTimeout(k),k=setTimeout(u.bind(this,function(){this.na||this.userActive(l)}),2E3))}),250);this.d("dispose",function(){clearInterval(h);clearTimeout(k)})}});t=u.Player.prototype;t.j=u.options;t.dispose=function(){this.k("dispose");this.p("dispose");u.Aa[this.T]=j;this.P&&this.P.player&&(this.P.player=j);this.b&&this.b.player&&(this.b.player=j);clearInterval(this.Ya);this.Ba();this.g&&this.g.dispose();u.a.prototype.dispose.call(this)};function da(a){var c={sources:[],tracks:[]};u.l.B(c,u.Cb(a));if(a.hasChildNodes()){var d,e,g,h;a=a.childNodes;g=0;for(h=a.length;g<h;g++)d=a[g],e=d.nodeName.toLowerCase(),"source"===e?c.sources.push(u.Cb(d)):"track"===e&&c.tracks.push(u.Cb(d))}return c}
t.e=function(){var a=this.b=u.a.prototype.e.call(this,"div"),c=this.P;c.removeAttribute("width");c.removeAttribute("height");if(c.hasChildNodes()){var d,e,g,h,k;d=c.childNodes;e=d.length;for(k=[];e--;)g=d[e],h=g.nodeName.toLowerCase(),"track"===h&&k.push(g);for(d=0;d<k.length;d++)c.removeChild(k[d])}a.id=c.id;a.className=c.className;c.id+="_html5_api";c.className="vjs-tech";c.player=a.player=this;this.o("vjs-paused");this.width(this.j.width,f);this.height(this.j.height,f);c.parentNode&&c.parentNode.insertBefore(a,c);u.Eb(c,a);this.b=a;this.d("loadstart",this.Cd);this.d("ended",this.yd);this.d("play",this.Ob);this.d("firstplay",this.Ad);this.d("pause",this.Nb);this.d("progress",this.Dd);this.d("durationchange",this.zc);this.d("fullscreenchange",this.Bd);return a};function R(a,c,d){a.g&&(a.ca=l,a.g.dispose(),a.Ib&&(a.Ib=l,clearInterval(a.Ya)),a.Jb&&S(a),a.g=l);"Html5"!==c&&a.P&&(u.f.nc(a.P),a.P=j);a.Ca=c;a.ca=l;var e=u.l.B({source:d,parentEl:a.b},a.j[c.toLowerCase()]);d&&(d.src==a.z.src&&0<a.z.currentTime&&(e.startTime=a.z.currentTime),a.z.src=d.src);a.g=new window.videojs[c](a,e);a.g.K(function(){this.c.Ea();if(!this.n.progressEvents){var a=this.c;a.Ib=f;a.Ya=setInterval(u.bind(a,function(){this.z.tb<this.buffered().end(0)?this.k("progress"):1==this.bufferedPercent()&&(clearInterval(this.Ya),this.k("progress"))}),500);a.g&&a.g.W("progress",function(){this.n.progressEvents=f;var a=this.c;a.Ib=l;clearInterval(a.Ya)})}this.n.timeupdateEvents||(a=this.c,a.Jb=f,a.d("play",a.Lc),a.d("pause",a.Ba),a.g&&a.g.W("timeupdate",function(){this.n.timeupdateEvents=f;S(this.c)}))})}function S(a){a.Jb=l;a.Ba();a.p("play",a.Lc);a.p("pause",a.Ba)}t.Lc=function(){this.mc&&this.Ba();this.mc=setInterval(u.bind(this,function(){this.k("timeupdate")}),250)};t.Ba=function(){clearInterval(this.mc);this.k("timeupdate")};t.Cd=function(){this.error(j);this.paused()?(T(this,l),this.W("play",function(){T(this,f)})):this.k("firstplay")};t.uc=l;function T(a,c){c!==b&&a.uc!==c&&((a.uc=c)?(a.o("vjs-has-started"),a.k("firstplay")):a.r("vjs-has-started"))}t.Ob=function(){u.r(this.b,"vjs-paused");u.o(this.b,"vjs-playing")};t.Ad=function(){this.j.starttime&&this.currentTime(this.j.starttime);this.o("vjs-has-started")};t.Nb=function(){u.r(this.b,"vjs-playing");u.o(this.b,"vjs-paused")};t.Dd=function(){1==this.bufferedPercent()&&this.k("loadedalldata")};t.yd=function(){this.j.loop&&(this.currentTime(0),this.play())};t.zc=function(){var a=U(this,"duration");a&&(0>a&&(a=Infinity),this.duration(a),Infinity===a?this.o("vjs-live"):this.r("vjs-live"))};t.Bd=function(){this.isFullscreen()?this.o("vjs-fullscreen"):this.r("vjs-fullscreen")};function V(a,c,d){if(a.g&&!a.g.ca)a.g.K(function(){this[c](d)});else try{a.g[c](d)}catch(e){throw u.log(e),e;}}function U(a,c){if(a.g&&a.g.ca)try{return a.g[c]()}catch(d){throw a.g[c]===b?u.log("Video.js: "+c+" method not defined for "+a.Ca+" playback technology.",d):"TypeError"==d.name?(u.log("Video.js: "+c+" unavailable on "+a.Ca+" playback technology element.",d),a.g.ca=l):u.log(d),d;}}t.play=function(){V(this,"play");return this};t.pause=function(){V(this,"pause");return this};t.paused=function(){return U(this,"paused")===l?l:f};t.currentTime=function(a){return a!==b?(V(this,"setCurrentTime",a),this.Jb&&this.k("timeupdate"),this):this.z.currentTime=U(this,"currentTime")||0};t.duration=function(a){if(a!==b)return this.z.duration=parseFloat(a),this;this.z.duration===b&&this.zc();return this.z.duration||0};t.buffered=function(){var a=U(this,"buffered"),c=a.length-1,d=this.z.tb=this.z.tb||0;a&&(0<=c&&a.end(c)!==d)&&(d=a.end(c),this.z.tb=d);return u.zb(0,d)};t.bufferedPercent=function(){return this.duration()?this.buffered().end(0)/this.duration():0};t.volume=function(a){if(a!==b)return a=Math.max(0,Math.min(1,parseFloat(a))),this.z.volume=a,V(this,"setVolume",a),u.Ld(a),this;a=parseFloat(U(this,"volume"));return isNaN(a)?1:a};t.muted=function(a){return a!==b?(V(this,"setMuted",a),this):U(this,"muted")||l};t.ab=function(){return U(this,"supportsFullScreen")||l};t.wc=l;t.isFullscreen=function(a){return a!==b?(this.wc=!!a,this):this.wc};t.isFullScreen=function(a){u.log.warn('player.isFullScreen() has been deprecated, use player.isFullscreen() with a lowercase "s")');return this.isFullscreen(a)};t.requestFullscreen=function(){var a=u.Na.Bb;this.isFullscreen(f);a?(u.d(document,a.fullscreenchange,u.bind(this,function(c){this.isFullscreen(document[a.fullscreenElement]);this.isFullscreen()===l&&u.p(document,a.fullscreenchange,arguments.callee);this.k("fullscreenchange")})),this.b[a.requestFullscreen]()):this.g.ab()?V(this,"enterFullScreen"):(this.td=f,this.ld=document.documentElement.style.overflow,u.d(document,"keydown",u.bind(this,this.qc)),document.documentElement.style.overflow="hidden",u.o(document.body,"vjs-full-window"),this.k("enterFullWindow"),this.k("fullscreenchange"));return this};t.exitFullscreen=function(){var a=u.Na.Bb;this.isFullscreen(l);if(a)document[a.exitFullscreen]();else this.g.ab()?V(this,"exitFullScreen"):(ea(this),this.k("fullscreenchange"));return this};t.qc=function(a){27===a.keyCode&&(this.isFullscreen()===f?this.exitFullscreen():ea(this))};function ea(a){a.td=l;u.p(document,"keydown",a.qc);document.documentElement.style.overflow=a.ld;u.r(document.body,"vjs-full-window");a.k("exitFullWindow")}
t.src=function(a){if(a===b)return U(this,"src");if(a instanceof Array){var c;a:{c=a;for(var d=0,e=this.j.techOrder;d<e.length;d++){var g=u.$(e[d]),h=window.videojs[g];if(h){if(h.isSupported())for(var k=0,p=c;k<p.length;k++){var n=p[k];if(h.canPlaySource(n)){c={source:n,g:g};break a}}}else u.log.error('The "'+g+'" tech is undefined. Skipped browser support check for that tech.')}c=l}c?(a=c.source,c=c.g,c==this.Ca?this.src(a):R(this,c,a)):(this.error({code:4,message:this.options().notSupportedMessage}),this.Ea())}else a instanceof Object?window.videojs[this.Ca].canPlaySource(a)?this.src(a.src):this.src([a]):(this.z.src=a,this.ca?(V(this,"src",a),"auto"==this.j.preload&&this.load(),this.j.autoplay&&this.play()):this.K(function(){this.src(a)}));return this};t.load=function(){V(this,"load");return this};t.currentSrc=function(){return U(this,"currentSrc")||this.z.src||""};t.Xa=function(a){return a!==b?(V(this,"setPreload",a),this.j.preload=a,this):U(this,"preload")};t.autoplay=function(a){return a!==b?(V(this,"setAutoplay",a),this.j.autoplay=a,this):U(this,"autoplay")};t.loop=function(a){return a!==b?(V(this,"setLoop",a),this.j.loop=a,this):U(this,"loop")};t.poster=function(a){if(a===b)return this.Cc;this.Cc=a;V(this,"setPoster",a);this.k("posterchange")};t.controls=function(a){return a!==b?(a=!!a,this.yb!==a&&((this.yb=a)?(this.r("vjs-controls-disabled"),this.o("vjs-controls-enabled"),this.k("controlsenabled")):(this.r("vjs-controls-enabled"),this.o("vjs-controls-disabled"),this.k("controlsdisabled"))),this):this.yb};u.Player.prototype.Tb;t=u.Player.prototype;t.usingNativeControls=function(a){return a!==b?(a=!!a,this.Tb!==a&&((this.Tb=a)?(this.o("vjs-using-native-controls"),this.k("usingnativecontrols")):(this.r("vjs-using-native-controls"),this.k("usingcustomcontrols"))),this):this.Tb};t.ba=j;t.error=function(a){if(a===b)return this.ba;if(a===j)return this.ba=a,this.r("vjs-error"),this;this.ba=a instanceof u.F?a:new u.F(a);this.k("error");this.o("vjs-error");u.log.error("(CODE:"+this.ba.code+" "+u.F.Ra[this.ba.code]+")",this.ba.message,this.ba);return this};t.ended=function(){return U(this,"ended")};t.seeking=function(){return U(this,"seeking")};t.na=f;t.reportUserActivity=function(){this.na=f};t.Sb=f;t.userActive=function(a){return a!==b?(a=!!a,a!==this.Sb&&((this.Sb=a)?(this.na=f,this.r("vjs-user-inactive"),this.o("vjs-user-active"),this.k("useractive")):(this.na=l,this.g&&this.g.W("mousemove",function(a){a.stopPropagation();a.preventDefault()}),this.r("vjs-user-active"),this.o("vjs-user-inactive"),this.k("userinactive"))),this):this.Sb};t.playbackRate=function(a){return a!==b?(V(this,"setPlaybackRate",a),this):this.g&&this.g.n&&this.g.n.playbackRate?U(this,"playbackRate"):1};u.Ha=u.a.extend();u.Ha.prototype.j={fe:"play",children:{playToggle:{},currentTimeDisplay:{},timeDivider:{},durationDisplay:{},remainingTimeDisplay:{},liveDisplay:{},progressControl:{},fullscreenToggle:{},volumeControl:{},muteToggle:{},playbackRateMenuButton:{}}};u.Ha.prototype.e=function(){return u.e("div",{className:"vjs-control-bar"})};u.Zb=u.a.extend({h:function(a,c){u.a.call(this,a,c)}});u.Zb.prototype.e=function(){var a=u.a.prototype.e.call(this,"div",{className:"vjs-live-controls vjs-control"});this.u=u.e("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">Stream Type </span>LIVE',"aria-live":"off"});a.appendChild(this.u);return a};u.bc=u.s.extend({h:function(a,c){u.s.call(this,a,c);a.d("play",u.bind(this,this.Ob));a.d("pause",u.bind(this,this.Nb))}});t=u.bc.prototype;t.sa="Play";t.S=function(){return"vjs-play-control "+u.s.prototype.S.call(this)};t.q=function(){this.c.paused()?this.c.play():this.c.pause()};t.Ob=function(){u.r(this.b,"vjs-paused");u.o(this.b,"vjs-playing");this.b.children[0].children[0].innerHTML="Pause"};t.Nb=function(){u.r(this.b,"vjs-playing");u.o(this.b,"vjs-paused");this.b.children[0].children[0].innerHTML="Play"};u.fb=u.a.extend({h:function(a,c){u.a.call(this,a,c);a.d("timeupdate",u.bind(this,this.fa))}});u.fb.prototype.e=function(){var a=u.a.prototype.e.call(this,"div",{className:"vjs-current-time vjs-time-controls vjs-control"});this.u=u.e("div",{className:"vjs-current-time-display",innerHTML:'<span class="vjs-control-text">Current Time </span>0:00',"aria-live":"off"});a.appendChild(this.u);return a};u.fb.prototype.fa=function(){var a=this.c.$a?this.c.z.currentTime:this.c.currentTime();this.u.innerHTML='<span class="vjs-control-text">Current Time </span>'+u.ya(a,this.c.duration())};u.gb=u.a.extend({h:function(a,c){u.a.call(this,a,c);a.d("timeupdate",u.bind(this,this.fa))}});u.gb.prototype.e=function(){var a=u.a.prototype.e.call(this,"div",{className:"vjs-duration vjs-time-controls vjs-control"});this.u=u.e("div",{className:"vjs-duration-display",innerHTML:'<span class="vjs-control-text">Duration Time </span>0:00',"aria-live":"off"});a.appendChild(this.u);return a};u.gb.prototype.fa=function(){var a=this.c.duration();a&&(this.u.innerHTML='<span class="vjs-control-text">Duration Time </span>'+u.ya(a))};u.hc=u.a.extend({h:function(a,c){u.a.call(this,a,c)}});u.hc.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-time-divider",innerHTML:"<div><span>/</span></div>"})};u.nb=u.a.extend({h:function(a,c){u.a.call(this,a,c);a.d("timeupdate",u.bind(this,this.fa))}});u.nb.prototype.e=function(){var a=u.a.prototype.e.call(this,"div",{className:"vjs-remaining-time vjs-time-controls vjs-control"});this.u=u.e("div",{className:"vjs-remaining-time-display",innerHTML:'<span class="vjs-control-text">Remaining Time </span>-0:00',"aria-live":"off"});a.appendChild(this.u);return a};u.nb.prototype.fa=function(){this.c.duration()&&(this.u.innerHTML='<span class="vjs-control-text">Remaining Time </span>-'+u.ya(this.c.duration()-this.c.currentTime()))};u.Ia=u.s.extend({h:function(a,c){u.s.call(this,a,c)}});u.Ia.prototype.sa="Fullscreen";u.Ia.prototype.S=function(){return"vjs-fullscreen-control "+u.s.prototype.S.call(this)};u.Ia.prototype.q=function(){this.c.isFullscreen()?(this.c.exitFullscreen(),this.xb.innerHTML="Fullscreen"):(this.c.requestFullscreen(),this.xb.innerHTML="Non-Fullscreen")};u.mb=u.a.extend({h:function(a,c){u.a.call(this,a,c)}});u.mb.prototype.j={children:{seekBar:{}}};u.mb.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-progress-control vjs-control"})};u.dc=u.Q.extend({h:function(a,c){u.Q.call(this,a,c);a.d("timeupdate",u.bind(this,this.ma));a.K(u.bind(this,this.ma))}});t=u.dc.prototype;t.j={children:{loadProgressBar:{},playProgressBar:{},seekHandle:{}},barName:"playProgressBar",handleName:"seekHandle"};t.Bc="timeupdate";t.e=function(){return u.Q.prototype.e.call(this,"div",{className:"vjs-progress-holder","aria-label":"video progress bar"})};t.ma=function(){var a=this.c.$a?this.c.z.currentTime:this.c.currentTime();this.b.setAttribute("aria-valuenow",u.round(100*this.Db(),2));this.b.setAttribute("aria-valuetext",u.ya(a,this.c.duration()))};t.Db=function(){return this.c.currentTime()/this.c.duration()};t.Wa=function(a){u.Q.prototype.Wa.call(this,a);this.c.$a=f;this.Xd=!this.c.paused();this.c.pause()};t.Lb=function(a){a=J(this,a)*this.c.duration();a==this.c.duration()&&(a-=0.1);this.c.currentTime(a)};t.Mb=function(a){u.Q.prototype.Mb.call(this,a);this.c.$a=l;this.Xd&&this.c.play()};t.Ic=function(){this.c.currentTime(this.c.currentTime()+5)};t.Hc=function(){this.c.currentTime(this.c.currentTime()-5)};u.jb=u.a.extend({h:function(a,c){u.a.call(this,a,c);a.d("progress",u.bind(this,this.update))}});u.jb.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-load-progress",innerHTML:'<span class="vjs-control-text">Loaded: 0%</span>'})};u.jb.prototype.update=function(){this.b.style&&(this.b.style.width=u.round(100*this.c.bufferedPercent(),2)+"%")};u.ac=u.a.extend({h:function(a,c){u.a.call(this,a,c)}});u.ac.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-play-progress",innerHTML:'<span class="vjs-control-text">Progress: 0%</span>'})};u.Ka=u.Y.extend({h:function(a,c){u.Y.call(this,a,c);a.d("timeupdate",u.bind(this,this.fa))}});u.Ka.prototype.defaultValue="00:00";u.Ka.prototype.e=function(){return u.Y.prototype.e.call(this,"div",{className:"vjs-seek-handle","aria-live":"off"})};u.Ka.prototype.fa=function(){var a=this.c.$a?this.c.z.currentTime:this.c.currentTime();this.b.innerHTML='<span class="vjs-control-text">'+u.ya(a,this.c.duration())+"</span>"};u.pb=u.a.extend({h:function(a,c){u.a.call(this,a,c);a.g&&(a.g.n&&a.g.n.volumeControl===l)&&this.o("vjs-hidden");a.d("loadstart",u.bind(this,function(){a.g.n&&a.g.n.volumeControl===l?this.o("vjs-hidden"):this.r("vjs-hidden")}))}});u.pb.prototype.j={children:{volumeBar:{}}};u.pb.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-volume-control vjs-control"})};u.ob=u.Q.extend({h:function(a,c){u.Q.call(this,a,c);a.d("volumechange",u.bind(this,this.ma));a.K(u.bind(this,this.ma))}});t=u.ob.prototype;t.ma=function(){this.b.setAttribute("aria-valuenow",u.round(100*this.c.volume(),2));this.b.setAttribute("aria-valuetext",u.round(100*this.c.volume(),2)+"%")};t.j={children:{volumeLevel:{},volumeHandle:{}},barName:"volumeLevel",handleName:"volumeHandle"};t.Bc="volumechange";t.e=function(){return u.Q.prototype.e.call(this,"div",{className:"vjs-volume-bar","aria-label":"volume level"})};t.Lb=function(a){this.c.muted()&&this.c.muted(l);this.c.volume(J(this,a))};t.Db=function(){return this.c.muted()?0:this.c.volume()};t.Ic=function(){this.c.volume(this.c.volume()+0.1)};t.Hc=function(){this.c.volume(this.c.volume()-0.1)};u.ic=u.a.extend({h:function(a,c){u.a.call(this,a,c)}});u.ic.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})};u.qb=u.Y.extend();u.qb.prototype.defaultValue="00:00";u.qb.prototype.e=function(){return u.Y.prototype.e.call(this,"div",{className:"vjs-volume-handle"})};u.ha=u.s.extend({h:function(a,c){u.s.call(this,a,c);a.d("volumechange",u.bind(this,this.update));a.g&&(a.g.n&&a.g.n.volumeControl===l)&&this.o("vjs-hidden");a.d("loadstart",u.bind(this,function(){a.g.n&&a.g.n.volumeControl===l?this.o("vjs-hidden"):this.r("vjs-hidden")}))}});u.ha.prototype.e=function(){return u.s.prototype.e.call(this,"div",{className:"vjs-mute-control vjs-control",innerHTML:'<div><span class="vjs-control-text">Mute</span></div>'})};u.ha.prototype.q=function(){this.c.muted(this.c.muted()?l:f)};u.ha.prototype.update=function(){var a=this.c.volume(),c=3;0===a||this.c.muted()?c=0:0.33>a?c=1:0.67>a&&(c=2);this.c.muted()?"Unmute"!=this.b.children[0].children[0].innerHTML&&(this.b.children[0].children[0].innerHTML="Unmute"):"Mute"!=this.b.children[0].children[0].innerHTML&&(this.b.children[0].children[0].innerHTML="Mute");for(a=0;4>a;a++)u.r(this.b,"vjs-vol-"+a);u.o(this.b,"vjs-vol-"+c)};u.qa=u.L.extend({h:function(a,c){u.L.call(this,a,c);a.d("volumechange",u.bind(this,this.update));a.g&&(a.g.n&&a.g.n.Oc===l)&&this.o("vjs-hidden");a.d("loadstart",u.bind(this,function(){a.g.n&&a.g.n.Oc===l?this.o("vjs-hidden"):this.r("vjs-hidden")}));this.o("vjs-menu-button")}});u.qa.prototype.va=function(){var a=new u.ga(this.c,{lc:"div"}),c=new u.ob(this.c,u.l.B({Wd:f},this.j.me));a.V(c);return a};u.qa.prototype.q=function(){u.ha.prototype.q.call(this);u.L.prototype.q.call(this)};u.qa.prototype.e=function(){return u.s.prototype.e.call(this,"div",{className:"vjs-volume-menu-button vjs-menu-button vjs-control",innerHTML:'<div><span class="vjs-control-text">Mute</span></div>'})};u.qa.prototype.update=u.ha.prototype.update;u.cc=u.L.extend({h:function(a,c){u.L.call(this,a,c);this.Nc();this.Mc();a.d("loadstart",u.bind(this,this.Nc));a.d("ratechange",u.bind(this,this.Mc))}});t=u.cc.prototype;t.e=function(){var a=u.a.prototype.e.call(this,"div",{className:"vjs-playback-rate vjs-menu-button vjs-control",innerHTML:'<div class="vjs-control-content"><span class="vjs-control-text">Playback Rate</span></div>'});this.yc=u.e("div",{className:"vjs-playback-rate-value",innerHTML:1});a.appendChild(this.yc);return a};t.va=function(){var a=new u.ga(this.m()),c=this.m().options().playbackRates;if(c)for(var d=c.length-1;0<=d;d--)a.V(new u.lb(this.m(),{rate:c[d]+"x"}));return a};t.ma=function(){this.w().setAttribute("aria-valuenow",this.m().playbackRate())};t.q=function(){for(var a=this.m().playbackRate(),c=this.m().options().playbackRates,d=c[0],e=0;e<c.length;e++)if(c[e]>a){d=c[e];break}this.m().playbackRate(d)};function fa(a){return a.m().g&&a.m().g.n.playbackRate&&a.m().options().playbackRates&&0<a.m().options().playbackRates.length}t.Nc=function(){fa(this)?this.r("vjs-hidden"):this.o("vjs-hidden")};t.Mc=function(){fa(this)&&(this.yc.innerHTML=this.m().playbackRate()+"x")};u.lb=u.I.extend({lc:"button",h:function(a,c){var d=this.label=c.rate,e=this.Dc=parseFloat(d,10);c.label=d;c.selected=1===e;u.I.call(this,a,c);this.m().d("ratechange",u.bind(this,this.update))}});u.lb.prototype.q=function(){u.I.prototype.q.call(this);this.m().playbackRate(this.Dc)};u.lb.prototype.update=function(){this.selected(this.m().playbackRate()==this.Dc)};u.Ja=u.s.extend({h:function(a,c){u.s.call(this,a,c);a.poster()&&this.src(a.poster());(!a.poster()||!a.controls())&&this.G();a.d("posterchange",u.bind(this,function(){this.src(a.poster())}));a.d("play",u.bind(this,this.G))}});var ga="backgroundSize"in u.A.style;u.Ja.prototype.e=function(){var a=u.e("div",{className:"vjs-poster",tabIndex:-1});ga||a.appendChild(u.e("img"));return a};u.Ja.prototype.src=function(a){var c=this.w();a!==b&&(ga?c.style.backgroundImage='url("'+a+'")':c.firstChild.src=a)};u.Ja.prototype.q=function(){this.m().controls()&&this.c.play()};u.$b=u.a.extend({h:function(a,c){u.a.call(this,a,c);a.d("canplay",u.bind(this,this.G));a.d("canplaythrough",u.bind(this,this.G));a.d("playing",u.bind(this,this.G));a.d("seeking",u.bind(this,this.show));a.d("seeked",u.bind(this,this.G));a.d("ended",u.bind(this,this.G));a.d("waiting",u.bind(this,this.show))}});u.$b.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-loading-spinner"})};u.cb=u.s.extend();u.cb.prototype.e=function(){return u.s.prototype.e.call(this,"div",{className:"vjs-big-play-button",innerHTML:'<span aria-hidden="true"></span>',"aria-label":"play video"})};u.cb.prototype.q=function(){this.c.play()};u.hb=u.a.extend({h:function(a,c){u.a.call(this,a,c);this.update();a.d("error",u.bind(this,this.update))}});u.hb.prototype.e=function(){var a=u.a.prototype.e.call(this,"div",{className:"vjs-error-display"});this.u=u.e("div");a.appendChild(this.u);return a};u.hb.prototype.update=function(){this.m().error()&&(this.u.innerHTML=this.m().error().message)};u.t=u.a.extend({h:function(a,c,d){c=c||{};c.Fc=l;u.a.call(this,a,c,d);var e,g;g=this;e=this.m();a=function(){if(e.controls()&&!e.usingNativeControls()){var a;g.d("mousedown",g.q);g.d("touchstart",function(c){c.preventDefault();a=this.c.userActive()});g.d("touchmove",function(){a&&this.m().reportUserActivity()});I(g);g.d("tap",g.Ed)}};c=u.bind(g,g.Id);this.K(a);e.d("controlsenabled",a);e.d("controlsdisabled",c)}});t=u.t.prototype;t.Id=function(){this.p("tap");this.p("touchstart");this.p("touchmove");this.p("touchleave");this.p("touchcancel");this.p("touchend");this.p("click");this.p("mousedown")};t.q=function(a){0===a.button&&this.m().controls()&&(this.m().paused()?this.m().play():this.m().pause())};t.Ed=function(){this.m().userActive(!this.m().userActive())};t.Qb=m();t.n={volumeControl:f,fullscreenResize:l,playbackRate:l,progressEvents:l,timeupdateEvents:l};u.media={};u.media.bb="play pause paused currentTime setCurrentTime duration buffered volume setVolume muted setMuted width height supportsFullScreen enterFullScreen src load currentSrc preload setPreload autoplay setAutoplay loop setLoop error networkState readyState seeking initialTime startOffsetTime played seekable ended videoTracks audioTracks videoWidth videoHeight textTracks defaultPlaybackRate playbackRate mediaGroup controller controls defaultMuted".split(" ");function ha(){var a=u.media.bb[i];return function(){throw Error('The "'+a+"\" method is not available on the playback technology's API");}}for(var i=u.media.bb.length-1;0<=i;i--)u.t.prototype[u.media.bb[i]]=ha();u.f=u.t.extend({h:function(a,c,d){this.n.volumeControl=u.f.ed();this.n.playbackRate=u.f.dd();this.n.movingMediaElementInDOM=!u.Tc;this.n.fullscreenResize=f;u.t.call(this,a,c,d);for(d=u.f.ib.length-1;0<=d;d--)u.d(this.b,u.f.ib[d],u.bind(this,this.nd));(c=c.source)&&this.b.currentSrc===c.src&&0<this.b.networkState?a.k("loadstart"):c&&(this.b.src=c.src);if(u.fc&&a.options().nativeControlsForTouch!==l){var e,g,h,k;e=this;g=this.m();c=g.controls();e.b.controls=!!c;h=function(){e.b.controls=f};k=function(){e.b.controls=l};g.d("controlsenabled",h);g.d("controlsdisabled",k);c=function(){g.p("controlsenabled",h);g.p("controlsdisabled",k)};e.d("dispose",c);g.d("usingcustomcontrols",c);g.usingNativeControls(f)}a.K(function(){this.P&&(this.j.autoplay&&this.paused())&&(delete this.P.poster,this.play())});this.Ea()}});t=u.f.prototype;t.dispose=function(){u.t.prototype.dispose.call(this)};t.e=function(){var a=this.c,c=a.P,d;if(!c||this.n.movingMediaElementInDOM===l)c?(d=c.cloneNode(l),u.f.nc(c),c=d,a.P=j):c=u.e("video",{id:a.id()+"_html5_api",className:"vjs-tech"}),c.player=a,u.Eb(c,a.w());d=["autoplay","preload","loop","muted"];for(var e=d.length-1;0<=e;e--){var g=d[e];a.j[g]!==j&&(c[g]=a.j[g])}return c};t.nd=function(a){"error"==a.type?this.m().error(this.error().code):(a.bubbles=l,this.m().k(a))};t.play=function(){this.b.play()};t.pause=function(){this.b.pause()};t.paused=function(){return this.b.paused};t.currentTime=function(){return this.b.currentTime};t.Kd=function(a){try{this.b.currentTime=a}catch(c){u.log(c,"Video is not ready. (Video.js)")}};t.duration=function(){return this.b.duration||0};t.buffered=function(){return this.b.buffered};t.volume=function(){return this.b.volume};t.Qd=function(a){this.b.volume=a};t.muted=function(){return this.b.muted};t.Nd=function(a){this.b.muted=a};t.width=function(){return this.b.offsetWidth};t.height=function(){return this.b.offsetHeight};t.ab=function(){return"function"==typeof this.b.webkitEnterFullScreen&&(/Android/.test(u.M)||!/Chrome|Mac OS X 10.5/.test(u.M))?f:l};t.oc=function(){var a=this.b;a.paused&&a.networkState<=a.Zd?(this.b.play(),setTimeout(function(){a.pause();a.webkitEnterFullScreen()},0)):a.webkitEnterFullScreen()};t.od=function(){this.b.webkitExitFullScreen()};t.src=function(a){this.b.src=a};t.load=function(){this.b.load()};t.currentSrc=function(){return this.b.currentSrc};t.poster=function(){return this.b.poster};t.Qb=function(a){this.b.poster=a};t.Xa=function(){return this.b.Xa};t.Pd=function(a){this.b.Xa=a};t.autoplay=function(){return this.b.autoplay};t.Jd=function(a){this.b.autoplay=a};t.controls=function(){return this.b.controls};t.loop=function(){return this.b.loop};t.Md=function(a){this.b.loop=a};t.error=function(){return this.b.error};t.seeking=function(){return this.b.seeking};t.ended=function(){return this.b.ended};t.playbackRate=function(){return this.b.playbackRate};t.Od=function(a){this.b.playbackRate=a};u.f.isSupported=function(){try{u.A.volume=0.5}catch(a){return l}return!!u.A.canPlayType};u.f.ub=function(a){try{return!!u.A.canPlayType(a.type)}catch(c){return""}};u.f.ed=function(){var a=u.A.volume;u.A.volume=a/2+0.1;return a!==u.A.volume};u.f.dd=function(){var a=u.A.playbackRate;u.A.playbackRate=a/2+0.1;return a!==u.A.playbackRate};var W,ia=/^application\/(?:x-|vnd\.apple\.)mpegurl/i,ja=/^video\/mp4/i;u.f.Ac=function(){4<=u.Ub&&(W||(W=u.A.constructor.prototype.canPlayType),u.A.constructor.prototype.canPlayType=function(a){return a&&ia.test(a)?"maybe":W.call(this,a)});u.Xc&&(W||(W=u.A.constructor.prototype.canPlayType),u.A.constructor.prototype.canPlayType=function(a){return a&&ja.test(a)?"maybe":W.call(this,a)})};u.f.Vd=function(){var a=u.A.constructor.prototype.canPlayType;u.A.constructor.prototype.canPlayType=W;W=j;return a};u.f.Ac();u.f.ib="loadstart suspend abort error emptied stalled loadedmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate progress play pause ratechange volumechange".split(" ");u.f.nc=function(a){if(a){a.player=j;for(a.parentNode&&a.parentNode.removeChild(a);a.hasChildNodes();)a.removeChild(a.firstChild);a.removeAttribute("src");if("function"===typeof a.load)try{a.load()}catch(c){}}};u.i=u.t.extend({h:function(a,c,d){u.t.call(this,a,c,d);var e=c.source;d=c.parentEl;var g=this.b=u.e("div",{id:a.id()+"_temp_flash"}),h=a.id()+"_flash_api";a=a.j;var k=u.l.B({readyFunction:"videojs.Flash.onReady",eventProxyFunction:"videojs.Flash.onEvent",errorEventProxyFunction:"videojs.Flash.onError",autoplay:a.autoplay,preload:a.Xa,loop:a.loop,muted:a.muted},c.flashVars),p=u.l.B({wmode:"opaque",bgcolor:"#000000"},c.params),n=u.l.B({id:h,name:h,"class":"vjs-tech"},c.attributes),s;e&&(e.type&&u.i.vd(e.type)?(a=u.i.Jc(e.src),k.rtmpConnection=encodeURIComponent(a.wb),k.rtmpStream=encodeURIComponent(a.Rb)):k.src=encodeURIComponent(u.rc(e.src)));this.setCurrentTime=function(a){s=a;this.b.vjs_setProperty("currentTime",a)};this.currentTime=function(){return this.seeking()?s:this.b.vjs_getProperty("currentTime")};u.Eb(g,d);c.startTime&&this.K(function(){this.load();this.play();this.currentTime(c.startTime)});u.Yb&&this.K(function(){u.d(this.w(),"mousemove",u.bind(this,function(){this.m().k({type:"mousemove",bubbles:l})}))});if(c.iFrameMode===f&&!u.Yb){var C=u.e("iframe",{id:h+"_iframe",name:h+"_iframe",className:"vjs-tech",scrolling:"no",marginWidth:0,marginHeight:0,frameBorder:0});k.readyFunction="ready";k.eventProxyFunction="events";k.errorEventProxyFunction="errors";u.d(C,"load",u.bind(this,function(){var a,d=C.contentWindow;a=C.contentDocument?C.contentDocument:C.contentWindow.document;a.write(u.i.sc(c.swf,k,p,n));d.player=this.c;d.ready=u.bind(this.c,function(c){var d=this.g;d.b=a.getElementById(c);u.i.vb(d)});d.events=u.bind(this.c,function(a,c){this&&"flash"===this.Ca&&this.k(c)});d.errors=u.bind(this.c,function(a,c){u.log("Flash Error",c)})}));g.parentNode.replaceChild(C,g)}else u.i.md(c.swf,g,k,p,n)}});t=u.i.prototype;t.dispose=function(){u.t.prototype.dispose.call(this)};t.play=function(){this.b.vjs_play()};t.pause=function(){this.b.vjs_pause()};t.src=function(a){if(a===b)return this.currentSrc();u.i.ud(a)?(a=u.i.Jc(a),this.he(a.wb),this.ie(a.Rb)):(a=u.rc(a),this.b.vjs_src(a));if(this.c.autoplay()){var c=this;setTimeout(function(){c.play()},0)}};t.currentSrc=function(){var a=this.b.vjs_getProperty("currentSrc");if(a==j){var c=this.rtmpConnection(),d=this.rtmpStream();c&&d&&(a=u.i.Rd(c,d))}return a};t.load=function(){this.b.vjs_load()};t.poster=function(){this.b.vjs_getProperty("poster")};t.Qb=m();t.buffered=function(){return u.zb(0,this.b.vjs_getProperty("buffered"))};t.ab=r(l);t.oc=r(l);var ka=u.i.prototype,X="rtmpConnection rtmpStream preload defaultPlaybackRate playbackRate autoplay loop mediaGroup controller controls volume muted defaultMuted".split(" "),la="error networkState readyState seeking initialTime duration startOffsetTime paused played seekable ended videoTracks audioTracks videoWidth videoHeight textTracks".split(" ");function ma(){var a=X[Y],c=a.charAt(0).toUpperCase()+a.slice(1);ka["set"+c]=function(c){return this.b.vjs_setProperty(a,c)}}
function na(a){ka[a]=function(){return this.b.vjs_getProperty(a)}}var Y;for(Y=0;Y<X.length;Y++)na(X[Y]),ma();for(Y=0;Y<la.length;Y++)na(la[Y]);u.i.isSupported=function(){return 10<=u.i.version()[0]};u.i.ub=function(a){if(!a.type)return"";a=a.type.replace(/;.*/,"").toLowerCase();if(a in u.i.qd||a in u.i.Kc)return"maybe"};u.i.qd={"video/flv":"FLV","video/x-flv":"FLV","video/mp4":"MP4","video/m4v":"MP4"};u.i.Kc={"rtmp/mp4":"MP4","rtmp/flv":"FLV"};u.i.onReady=function(a){a=u.w(a);var c=a.player||a.parentNode.player,d=c.g;a.player=c;d.b=a;u.i.vb(d)};u.i.vb=function(a){a.w().vjs_getProperty?a.Ea():setTimeout(function(){u.i.vb(a)},50)};u.i.onEvent=function(a,c){u.w(a).player.k(c)};u.i.onError=function(a,c){var d=u.w(a).player,e="FLASH: "+c;"srcnotfound"==c?d.error({code:4,message:e}):d.error(e)};u.i.version=function(){var a="0,0,0";try{a=(new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(c){try{navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(a=(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1])}catch(d){}}return a.split(",")};u.i.md=function(a,c,d,e,g){a=u.i.sc(a,d,e,g);a=u.e("div",{innerHTML:a}).childNodes[0];d=c.parentNode;c.parentNode.replaceChild(a,c);var h=d.childNodes[0];setTimeout(function(){h.style.display="block"},1E3)};u.i.sc=function(a,c,d,e){var g="",h="",k="";c&&u.l.wa(c,function(a,c){g+=a+"="+c+"&amp;"});d=u.l.B({movie:a,flashvars:g,allowScriptAccess:"always",allowNetworking:"all"},d);u.l.wa(d,function(a,c){h+='<param name="'+a+'" value="'+c+'" />'});e=u.l.B({data:a,width:"100%",height:"100%"},e);u.l.wa(e,function(a,c){k+=a+'="'+c+'" '});return'<object type="application/x-shockwave-flash"'+k+">"+h+"</object>"};u.i.Rd=function(a,c){return a+"&"+c};u.i.Jc=function(a){var c={wb:"",Rb:""};if(!a)return c;var d=a.indexOf("&"),e;-1!==d?e=d+1:(d=e=a.lastIndexOf("/")+1,0===d&&(d=e=a.length));c.wb=a.substring(0,d);c.Rb=a.substring(e,a.length);return c};u.i.vd=function(a){return a in u.i.Kc};u.i.Zc=/^rtmp[set]?:\/\//i;u.i.ud=function(a){return u.i.Zc.test(a)};u.Yc=u.a.extend({h:function(a,c,d){u.a.call(this,a,c,d);if(!a.j.sources||0===a.j.sources.length){c=0;for(d=a.j.techOrder;c<d.length;c++){var e=u.$(d[c]),g=window.videojs[e];if(g&&g.isSupported()){R(a,e);break}}}else a.src(a.j.sources)}});u.Player.prototype.textTracks=function(){return this.Da=this.Da||[]};function oa(a,c,d,e,g){var h=a.Da=a.Da||[];g=g||{};g.kind=c;g.label=d;g.language=e;c=u.$(c||"subtitles");var k=new window.videojs[c+"Track"](a,g);h.push(k);k.Qa()&&a.K(function(){setTimeout(function(){k.show()},0)})}function pa(a,c,d){for(var e=a.Da,g=0,h=e.length,k,p;g<h;g++)k=e[g],k.id()===c?(k.show(),p=k):d&&(k.J()==d&&0<k.mode())&&k.disable();(c=p?p.J():d?d:l)&&a.k(c+"trackchange")}
u.C=u.a.extend({h:function(a,c){u.a.call(this,a,c);this.T=c.id||"vjs_"+c.kind+"_"+c.language+"_"+u.v++;this.Gc=c.src;this.jd=c["default"]||c.dflt;this.Td=c.title;this.ee=c.srclang;this.wd=c.label;this.aa=[];this.rb=[];this.ka=this.la=0;this.c.d("fullscreenchange",u.bind(this,this.ad))}});t=u.C.prototype;t.J=q("H");t.src=q("Gc");t.Qa=q("jd");t.title=q("Td");t.label=q("wd");t.fd=q("aa");t.$c=q("rb");t.readyState=q("la");t.mode=q("ka");t.ad=function(){this.b.style.fontSize=this.c.isFullScreen()?140*(screen.width/this.c.width())+"%":""};t.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-"+this.H+" vjs-text-track"})};t.show=function(){qa(this);this.ka=2;u.a.prototype.show.call(this)};t.G=function(){qa(this);this.ka=1;u.a.prototype.G.call(this)};t.disable=function(){2==this.ka&&this.G();this.c.p("timeupdate",u.bind(this,this.update,this.T));this.c.p("ended",u.bind(this,this.reset,this.T));this.reset();this.c.ja("textTrackDisplay").removeChild(this);this.ka=0};function qa(a){0===a.la&&a.load();0===a.ka&&(a.c.d("timeupdate",u.bind(a,a.update,a.T)),a.c.d("ended",u.bind(a,a.reset,a.T)),("captions"===a.H||"subtitles"===a.H)&&a.c.ja("textTrackDisplay").V(a))}
t.load=function(){0===this.la&&(this.la=1,u.get(this.Gc,u.bind(this,this.Fd),u.bind(this,this.zd)))};t.zd=function(a){this.error=a;this.la=3;this.k("error")};t.Fd=function(a){var c,d;a=a.split("\n");for(var e="",g=1,h=a.length;g<h;g++)if(e=u.trim(a[g])){-1==e.indexOf("--\x3e")?(c=e,e=u.trim(a[++g])):c=this.aa.length;c={id:c,index:this.aa.length};d=e.split(" --\x3e ");c.startTime=ra(d[0]);c.xa=ra(d[1]);for(d=[];a[++g]&&(e=u.trim(a[g]));)d.push(e);c.text=d.join("<br/>");this.aa.push(c)}this.la=2;this.k("loaded")};function ra(a){var c=a.split(":");a=0;var d,e,g;3==c.length?(d=c[0],e=c[1],c=c[2]):(d=0,e=c[0],c=c[1]);c=c.split(/\s+/);c=c.splice(0,1)[0];c=c.split(/\.|,/);g=parseFloat(c[1]);c=c[0];a+=3600*parseFloat(d);a+=60*parseFloat(e);a+=parseFloat(c);g&&(a+=g/1E3);return a}
t.update=function(){if(0<this.aa.length){var a=this.c.options().trackTimeOffset||0,a=this.c.currentTime()+a;if(this.Pb===b||a<this.Pb||this.Ta<=a){var c=this.aa,d=this.c.duration(),e=0,g=l,h=[],k,p,n,s;a>=this.Ta||this.Ta===b?s=this.Ab!==b?this.Ab:0:(g=f,s=this.Hb!==b?this.Hb:c.length-1);for(;;){n=c[s];if(n.xa<=a)e=Math.max(e,n.xa),n.Ma&&(n.Ma=l);else if(a<n.startTime){if(d=Math.min(d,n.startTime),n.Ma&&(n.Ma=l),!g)break}else g?(h.splice(0,0,n),p===b&&(p=s),k=s):(h.push(n),k===b&&(k=s),p=s),d=Math.min(d,n.xa),e=Math.max(e,n.startTime),n.Ma=f;if(g)if(0===s)break;else s--;else if(s===c.length-1)break;else s++}this.rb=h;this.Ta=d;this.Pb=e;this.Ab=k;this.Hb=p;k=this.rb;p="";a=0;for(c=k.length;a<c;a++)p+='<span class="vjs-tt-cue">'+k[a].text+"</span>";this.b.innerHTML=p;this.k("cuechange")}}};t.reset=function(){this.Ta=0;this.Pb=this.c.duration();this.Hb=this.Ab=0};u.Wb=u.C.extend();u.Wb.prototype.H="captions";u.ec=u.C.extend();u.ec.prototype.H="subtitles";u.Xb=u.C.extend();u.Xb.prototype.H="chapters";u.gc=u.a.extend({h:function(a,c,d){u.a.call(this,a,c,d);if(a.j.tracks&&0<a.j.tracks.length){c=this.c;a=a.j.tracks;for(var e=0;e<a.length;e++)d=a[e],oa(c,d.kind,d.label,d.language,d)}}});u.gc.prototype.e=function(){return u.a.prototype.e.call(this,"div",{className:"vjs-text-track-display"})};u.Z=u.I.extend({h:function(a,c){var d=this.ea=c.track;c.label=d.label();c.selected=d.Qa();u.I.call(this,a,c);this.c.d(d.J()+"trackchange",u.bind(this,this.update))}});u.Z.prototype.q=function(){u.I.prototype.q.call(this);pa(this.c,this.ea.T,this.ea.J())};u.Z.prototype.update=function(){this.selected(2==this.ea.mode())};u.kb=u.Z.extend({h:function(a,c){c.track={J:function(){return c.kind},m:a,label:function(){return c.kind+" off"},Qa:r(l),mode:r(l)};u.Z.call(this,a,c);this.selected(f)}});u.kb.prototype.q=function(){u.Z.prototype.q.call(this);pa(this.c,this.ea.T,this.ea.J())};u.kb.prototype.update=function(){for(var a=this.c.textTracks(),c=0,d=a.length,e,g=f;c<d;c++)e=a[c],e.J()==this.ea.J()&&2==e.mode()&&(g=l);this.selected(g)};u.U=u.L.extend({h:function(a,c){u.L.call(this,a,c);1>=this.O.length&&this.G()}});u.U.prototype.ua=function(){var a=[],c;a.push(new u.kb(this.c,{kind:this.H}));for(var d=0;d<this.c.textTracks().length;d++)c=this.c.textTracks()[d],c.J()===this.H&&a.push(new u.Z(this.c,{track:c}));return a};u.Fa=u.U.extend({h:function(a,c,d){u.U.call(this,a,c,d);this.b.setAttribute("aria-label","Captions Menu")}});u.Fa.prototype.H="captions";u.Fa.prototype.sa="Captions";u.Fa.prototype.className="vjs-captions-button";u.La=u.U.extend({h:function(a,c,d){u.U.call(this,a,c,d);this.b.setAttribute("aria-label","Subtitles Menu")}});u.La.prototype.H="subtitles";u.La.prototype.sa="Subtitles";u.La.prototype.className="vjs-subtitles-button";u.Ga=u.U.extend({h:function(a,c,d){u.U.call(this,a,c,d);this.b.setAttribute("aria-label","Chapters Menu")}});t=u.Ga.prototype;t.H="chapters";t.sa="Chapters";t.className="vjs-chapters-button";t.ua=function(){for(var a=[],c,d=0;d<this.c.textTracks().length;d++)c=this.c.textTracks()[d],c.J()===this.H&&a.push(new u.Z(this.c,{track:c}));return a};t.va=function(){for(var a=this.c.textTracks(),c=0,d=a.length,e,g,h=this.O=[];c<d;c++)if(e=a[c],e.J()==this.H&&e.Qa()){if(2>e.readyState()){this.be=e;e.d("loaded",u.bind(this,this.va));return}g=e;break}a=this.za=new u.ga(this.c);a.ia().appendChild(u.e("li",{className:"vjs-menu-title",innerHTML:u.$(this.H),Sd:-1}));if(g){e=g.aa;for(var k,c=0,d=e.length;c<d;c++)k=e[c],k=new u.eb(this.c,{track:g,cue:k}),h.push(k),a.V(k)}0<this.O.length&&this.show();return a};u.eb=u.I.extend({h:function(a,c){var d=this.ea=c.track,e=this.cue=c.cue,g=a.currentTime();c.label=e.text;c.selected=e.startTime<=g&&g<e.xa;u.I.call(this,a,c);d.d("cuechange",u.bind(this,this.update))}});u.eb.prototype.q=function(){u.I.prototype.q.call(this);this.c.currentTime(this.cue.startTime);this.update(this.cue.startTime)};u.eb.prototype.update=function(){var a=this.cue,c=this.c.currentTime();this.selected(a.startTime<=c&&c<a.xa)};u.l.B(u.Ha.prototype.j.children,{subtitlesButton:{},captionsButton:{},chaptersButton:{}});if("undefined"!==typeof window.JSON&&"function"===window.JSON.parse)u.JSON=window.JSON;else{u.JSON={};var Z=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;u.JSON.parse=function(a,c){function d(a,e){var k,p,n=a[e];if(n&&"object"===typeof n)for(k in n)Object.prototype.hasOwnProperty.call(n,k)&&(p=d(n,k),p!==b?n[k]=p:delete n[k]);return c.call(a,e,n)}var e;a=String(a);Z.lastIndex=0;Z.test(a)&&(a=a.replace(Z,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"===typeof c?d({"":e},""):e;throw new SyntaxError("JSON.parse(): invalid or malformed JSON data");}}
u.jc=function(){var a,c,d=document.getElementsByTagName("video");if(d&&0<d.length)for(var e=0,g=d.length;e<g;e++)if((c=d[e])&&c.getAttribute)c.player===b&&(a=c.getAttribute("data-setup"),a!==j&&(a=u.JSON.parse(a||"{}"),videojs(c,a)));else{u.sb();break}else u.Pc||u.sb()};u.sb=function(){setTimeout(u.jc,1)};"complete"===document.readyState?u.Pc=f:u.W(window,"load",function(){u.Pc=f});u.sb();u.Hd=function(a,c){u.Player.prototype[a]=c};var sa=this;sa.Yd=f;function $(a,c){var d=a.split("."),e=sa;!(d[0]in e)&&e.execScript&&e.execScript("var "+d[0]);for(var g;d.length&&(g=d.shift());)!d.length&&c!==b?e[g]=c:e=e[g]?e[g]:e[g]={}};$("videojs",u);$("_V_",u);$("videojs.options",u.options);$("videojs.players",u.Aa);$("videojs.TOUCH_ENABLED",u.fc);$("videojs.cache",u.ta);$("videojs.Component",u.a);u.a.prototype.player=u.a.prototype.m;u.a.prototype.options=u.a.prototype.options;u.a.prototype.init=u.a.prototype.h;u.a.prototype.dispose=u.a.prototype.dispose;u.a.prototype.createEl=u.a.prototype.e;u.a.prototype.contentEl=u.a.prototype.ia;u.a.prototype.el=u.a.prototype.w;u.a.prototype.addChild=u.a.prototype.V;u.a.prototype.getChild=u.a.prototype.ja;u.a.prototype.getChildById=u.a.prototype.rd;u.a.prototype.children=u.a.prototype.children;u.a.prototype.initChildren=u.a.prototype.vc;u.a.prototype.removeChild=u.a.prototype.removeChild;u.a.prototype.on=u.a.prototype.d;u.a.prototype.off=u.a.prototype.p;u.a.prototype.one=u.a.prototype.W;u.a.prototype.trigger=u.a.prototype.k;u.a.prototype.triggerReady=u.a.prototype.Ea;u.a.prototype.show=u.a.prototype.show;u.a.prototype.hide=u.a.prototype.G;u.a.prototype.width=u.a.prototype.width;u.a.prototype.height=u.a.prototype.height;u.a.prototype.dimensions=u.a.prototype.kd;u.a.prototype.ready=u.a.prototype.K;u.a.prototype.addClass=u.a.prototype.o;u.a.prototype.removeClass=u.a.prototype.r;u.a.prototype.buildCSSClass=u.a.prototype.S;u.Player.prototype.ended=u.Player.prototype.ended;$("videojs.MediaLoader",u.Yc);$("videojs.TextTrackDisplay",u.gc);$("videojs.ControlBar",u.Ha);$("videojs.Button",u.s);$("videojs.PlayToggle",u.bc);$("videojs.FullscreenToggle",u.Ia);$("videojs.BigPlayButton",u.cb);$("videojs.LoadingSpinner",u.$b);$("videojs.CurrentTimeDisplay",u.fb);$("videojs.DurationDisplay",u.gb);$("videojs.TimeDivider",u.hc);$("videojs.RemainingTimeDisplay",u.nb);$("videojs.LiveDisplay",u.Zb);$("videojs.ErrorDisplay",u.hb);$("videojs.Slider",u.Q);$("videojs.ProgressControl",u.mb);$("videojs.SeekBar",u.dc);$("videojs.LoadProgressBar",u.jb);$("videojs.PlayProgressBar",u.ac);$("videojs.SeekHandle",u.Ka);$("videojs.VolumeControl",u.pb);$("videojs.VolumeBar",u.ob);$("videojs.VolumeLevel",u.ic);$("videojs.VolumeMenuButton",u.qa);$("videojs.VolumeHandle",u.qb);$("videojs.MuteToggle",u.ha);$("videojs.PosterImage",u.Ja);$("videojs.Menu",u.ga);$("videojs.MenuItem",u.I);$("videojs.MenuButton",u.L);$("videojs.PlaybackRateMenuButton",u.cc);u.L.prototype.createItems=u.L.prototype.ua;u.U.prototype.createItems=u.U.prototype.ua;u.Ga.prototype.createItems=u.Ga.prototype.ua;$("videojs.SubtitlesButton",u.La);$("videojs.CaptionsButton",u.Fa);$("videojs.ChaptersButton",u.Ga);$("videojs.MediaTechController",u.t);u.t.prototype.features=u.t.prototype.n;u.t.prototype.n.volumeControl=u.t.prototype.n.Oc;u.t.prototype.n.fullscreenResize=u.t.prototype.n.ce;u.t.prototype.n.progressEvents=u.t.prototype.n.ge;u.t.prototype.n.timeupdateEvents=u.t.prototype.n.je;u.t.prototype.setPoster=u.t.prototype.Qb;$("videojs.Html5",u.f);u.f.Events=u.f.ib;u.f.isSupported=u.f.isSupported;u.f.canPlaySource=u.f.ub;u.f.patchCanPlayType=u.f.Ac;u.f.unpatchCanPlayType=u.f.Vd;u.f.prototype.setCurrentTime=u.f.prototype.Kd;u.f.prototype.setVolume=u.f.prototype.Qd;u.f.prototype.setMuted=u.f.prototype.Nd;u.f.prototype.setPreload=u.f.prototype.Pd;u.f.prototype.setAutoplay=u.f.prototype.Jd;u.f.prototype.setLoop=u.f.prototype.Md;u.f.prototype.enterFullScreen=u.f.prototype.oc;u.f.prototype.exitFullScreen=u.f.prototype.od;u.f.prototype.playbackRate=u.f.prototype.playbackRate;u.f.prototype.setPlaybackRate=u.f.prototype.Od;$("videojs.Flash",u.i);u.i.isSupported=u.i.isSupported;u.i.canPlaySource=u.i.ub;u.i.onReady=u.i.onReady;$("videojs.TextTrack",u.C);u.C.prototype.label=u.C.prototype.label;u.C.prototype.kind=u.C.prototype.J;u.C.prototype.mode=u.C.prototype.mode;u.C.prototype.cues=u.C.prototype.fd;u.C.prototype.activeCues=u.C.prototype.$c;$("videojs.CaptionsTrack",u.Wb);$("videojs.SubtitlesTrack",u.ec);$("videojs.ChaptersTrack",u.Xb);$("videojs.autoSetup",u.jc);$("videojs.plugin",u.Hd);$("videojs.createTimeRange",u.zb);$("videojs.util",u.oa);u.oa.mergeOptions=u.oa.Kb;})();;(function($)
{$.pageUrl={objs:{},init:function()
{this.objs.pageUrl=$('#pageUrl');this.objs.pageUrlId=$('#pageUrlId');this.objs.form=$('#content form:first');this.objs.metaCount=$('label span.meta_count');$.forms.initializeSubmit();this.attachEvents();},attachEvents:function()
{var self=this;$('a.delete-image').click(function(e){self.markImageForDeletion($(this));e.preventDefault();});$(document).bind('complete.file.uploader',function(event,result){if(result.type==='image'&&result.relation==='page_url'){self.processItem(result);}});$(document).bind('start.js.upload.uploader',function(event,result){if(result.type==='image'&&result.relation==='page_url'){if($('#header-image-uploader').hasClass('replace')){$('#header-image-uploader').removeClass('replace');$('.header-image').removeClass('has-image').find('.upload-image').html('');}}});$('ul.crumbnav').crumbnav();$('#pageTitle').keyup(function(){self.updatePageLink($(this),true);});this.objs.pageUrl.keyup(function(){self.updatePageLink($(this));});this.objs.pageUrl.keydown(function(){self.linkUpdated($(this));});this.objs.form.submit(function(isUploading)
{if($.upload&&($.upload.isUploading||$.upload.startUpload))
return true;$.preventNav(false);var result=self.canSubmit();return result;});$('#privacy-toggle').bind('click',function(){self.setPrivacy($(this))});$('div.section.meta textarea').keyup(function(){self.checkMetaLength($(this));});},checkMetaLength:function($textarea)
{virb.log('pageUrl.checkMetaLength()');var textVal=$textarea.val();var textLength=textVal.length;if(textLength>=150)
{textLength=150;this.objs.metaCount.addClass('limit');$textarea.val(textVal.substr(0,150));}
else
{this.objs.metaCount.removeClass('limit');}
this.objs.metaCount.html(textLength);},updatePageLink:function($inputObj,updateField)
{var currentLink=$inputObj.val();currentLink=$(currentLink).text();var pageLink=$.slugify($inputObj.val());if(!updateField)
{this.objs.pageUrl.removeClass('defaultUrl');}
this.objs.pageUrl.removeClass('valid').removeClass('invalid');if((this.objs.pageUrl.hasClass('defaultUrl')&&updateField)||(!this.objs.pageUrl.hasClass('defaultUrl')&&!updateField))
{if(currentLink!=pageLink||updateField)
{this.objs.pageUrl.val(pageLink);}}},linkUpdated:function($inputObj)
{virb.log('pageUrl.linkUpdated()');$inputObj.removeClass('valid').addClass('invalid');if(typeof this.pageLinkTimeout!='undefined')
{window.clearTimeout(this.pageLinkTimeout);}
this.pageLinkTimeout=window.setTimeout(function()
{$.pageUrl.checkPageLink(false);},500);},checkPageLink:function(submit)
{virb.log('pageUrl.checkPageLink()');this.objs.pageUrl.validationEngine('showPrompt','Checking page link...','load');var dataObj={model:'Build/PageUrl',params:{action:'testLink',pageUrlId:this.objs.pageUrlId.val(),pageLink:this.objs.pageUrl.val()}};$.submitAjax(dataObj,{ok:function(result)
{if(!submit)
submit=false;$.pageUrl.handlePageLinkResult(result,submit);},fail:function(result)
{if(!submit)
submit=false;$.pageUrl.handlePageLinkResult(result,submit);}});},handlePageLinkResult:function(result,submit)
{virb.log('pageUrl.handlePageLinkResult()');if(result.stat=='ok')
{this.objs.pageUrl.removeClass('invalid').addClass('valid');if(submit&&this.objs.form.validationEngine('validate'))
this.objs.form.submit();}
else
{if(submit)
$('html,body').animate({scrollTop:'0px'},'fast');this.objs.pageUrl.removeClass('valid').addClass('invalid').validationEngine('showPrompt',result.message,'error');}},canSubmit:function()
{virb.log('pageUrl.canSubmit()');$('form .titleinside').hideTitleInside();var validationResult=this.objs.form.validationEngine('validate');if(this.objs.pageUrl.length<=0||(this.objs.pageUrl.hasClass('valid')&&validationResult))
return true;if(false!=validationResult)
{this.checkPageLink(true);}
$('form .titleinside').showTitleInside();return false;},updateSelectBox:function($selectObj)
{var addClass='public';var removeClass='password';if($selectObj.val()=='password')
{addClass='password';removeClass='public';$('#password').addClass('validate[required]');}
else
{$('#password').removeClass('validate[required]');}
$selectObj.prev().html('<p>'+$selectObj.find('option:selected').html()+'</p>').closest('dd').addClass(addClass).removeClass(removeClass);},setPrivacy:function($changeObj){var $toggle=$changeObj,$field=$changeObj.parent().parent().find("input#password"),$submit=$changeObj.parent().find("input#privacy-submit");if($toggle.hasClass('on')){$field.addClass('hide');$field.removeClass('validate[required]');$submit.val('public');}else{$field.removeClass('hide');$field.addClass('validate[required]');$submit.val('password');}},processItem:function(result){var $currentFile=result.file;var $setting=$('.header-image');var $uploadImage=$setting.find('.upload-image');$uploadImage.css("display","block");var $newImage=$('<img />',{src:result.url,load:function(){$uploadImage.html('');$setting.addClass('has-image');$setting.find('a.delete-image').data({'id':result.id});$(this).appendTo($uploadImage).fadeIn();$currentFile.closest('#header-image-uploader.uploader').addClass('replace');$setting.find('.image-value').val(result.id);$setting.find('.has-image').val('true');}}).hide();},markImageForDeletion:function($deleteObj){var $setting=$deleteObj.closest('.header-image');$deleteObj.closest('.setting').find('span.upload-image').fadeOut('fast',function(){$deleteObj.closest('.setting').removeClass('has-image').find('span.upload-image').html('').end().find('.uploader').removeClass('replace');});$setting.find('.upload-help').removeClass('hide');$setting.find(".image-value").val('');$setting.find(".has-image").val('');},getController:function($formObj){return $formObj.find('.form_controller').val();}};virb.$.pageUrl=$.pageUrl;$(function()
{virb.$.pageUrl.init();});})(virb.$);;var paginationObjects=[];var refreshPagination=function(id)
{for(var i=0;i<paginationObjects.length;i++)
{paginationObjects[i].refresh();}};function Pagination(args)
{paginationObjects.push(this);var paginationObj=this;this.results=false;this.debug=false;this.currentPage=1;this.lastLoadedPage=1;this.params={};this.refresh=true;this.perPage=20;this.scroll=true;$.each(args,function(index,value){paginationObj[index]=value;});this.totalPages=Math.ceil(this.totalResults/this.perPage);this.dispAmount=4;this.pagePadding=Math.ceil(this.dispAmount/2);this.loadedPages=[];this.loadedPages[this.currentPage]=virb.$(this.container+'Results').html();this.refresh=function()
{var loadedPageLength=this.loadedPages.length;for(var i=this.currentPage;i<=loadedPageLength;i++)
{this.loadedPages[i]='';delete this.loadedPages[i];}};this.cachePage=function()
{this.loadedPages[this.currentPage]=virb.$(this.container+'Results').html();};this.buildHtml=function()
{this.calculateOffsets();var output='';if(this.totalPages>1)
{output+='<ul id="pagination">';output+='<li class="pages"><strong>Pages:</strong></li>';output+='<li class="prev"><a href="#prev" page="'+this.previousPage+'">&lsaquo;</a></li>';if(this.pageStart>2)
{output+='<li><a href="#1" page="1">1</a></li><li>...</li>';}
else if(this.pageStart==2)
{output+='<li><a href="#1" page="1">1</a></li>';}
for(var i=this.pageStart;i<=this.pageEnd;i++)
{var activeClass='';if(i==this.currentPage)
{activeClass=' class="active"';}
output+='<li'+activeClass+'><a href="#'+i+'" page="'+i+'">'+i+'</a></li>';}
if(this.pageEnd!=this.totalPages&&this.pageEnd!=(this.totalPages-1))
{output+='<li>...</li><li><a href="#'+this.totalPages+'" page="'+this.totalPages+'">'+this.totalPages+'</a></li>';}
else if(this.pageEnd==(this.totalPages-1))
{output+='<li><a href="#'+this.totalPages+'" page="'+this.totalPages+'">'+this.totalPages+'</a></li>';}
output+='<li class="next"><a href="#next" page="'+this.nextPage+'">&rsaquo;</a></li>';output+='<li class="total"><em>('+this.totalResults+' total results)</em></li>';output+='</ul>';}
virb.$(this.container).html(output);if(false!=this.results)
this.primePagination();this.attachEvents();};this.calculateOffsets=function()
{this.nextPage=this.currentPage+1;this.previousPage=this.currentPage-1;if(this.nextPage>this.totalPages)
{this.nextPage=this.totalPages;}
if(this.previousPage<1)
{this.previousPage=1;}
this.leftOverflow=this.currentPage-this.pagePadding;this.rightOverflow=(this.leftOverflow<1)?((this.leftOverflow-1)*-1):0;this.pageStart=(this.leftOverflow<1)?1:this.leftOverflow;this.pageEnd=((this.pageStart+(2*this.pagePadding)+this.rightOverflow)>=this.totalPages)?this.totalPages:(this.currentPage+this.pagePadding+this.rightOverflow);var totalDispPages=this.pageEnd-this.pageStart;if(totalDispPages<(this.dispAmount-1))
{this.pageStart=this.pageStart-totalDispPages;if(this.pageStart<1)
{this.pageStart=1;}}};this.attachEvents=function()
{virb.$(this.container+' a').click(function(event)
{$clickedLink=virb.$(this);if(paginationObj.currentPage!=$clickedLink.attr('page'))
{paginationObj.lastPageLoaded=paginationObj.currentPage;paginationObj.currentPage=$clickedLink.attr('page')*1;paginationObj.buildHtml();paginationObj.makeAjaxCall();}
return false;});};this.update=function(){paginationObj.refresh();paginationObj.totalPages=1;paginationObj.lastPageLoaded=paginationObj.currentPage;paginationObj.currentPage=1;paginationObj.buildHtml();paginationObj.makeAjaxCall();}
this.makeAjaxCall=function()
{var self=this;if(this.loadedPages[this.currentPage])
{this.showResults(this.loadedPages[this.currentPage],false);}
else
{virb.$.overlay.ajaxMessage('processing','Loading page...');var dataString='data['+this.model+'][action]='+this.ajaxCall+'&data['+this.model+'][page]='+this.currentPage;$.each(this.params,function(index,value){dataString+='&data['+self.model+']['+index+']='+value;});virb.$.submitAjax(dataString,{ok:function(result){paginationObj.processResults(result);}});}};this.processResults=function(result)
{if(this.debug)
console.log(result);var response=result.response;if(response.totalResults!=this.totalResults)
{this.totalResults=response.totalResults;this.totalPages=Math.ceil(this.totalResults/this.perPage);this.buildHtml();}
if(this.debug)
console.log(response.html);if(response.html!='')
this.showResults(response.html,true);else
virb.$.overlay.ajaxMessage('error','There was a problem loading that page.');};this.showResults=function(html,cache)
{if(this.debug)
console.log(html);if(virb.$.overlay)
virb.$.overlay.hideAjaxMessages();var $container=virb.$(this.container+'Results'),$loadedPage=virb.$(html);$container.css("opacity",0);$loadedPage.appendTo($container.empty());$container.empty().append($loadedPage).animate({opacity:1},function(){virb.$(this).removeAttr('style');});if(true==this.scroll){virb.$('html, body').animate({scrollTop:0},'normal');}
if(cache)
this.cachePage();if(virb.$.forms)
virb.$.forms.init();};this.primePagination=function()
{if(this.debug)
console.log('primePagination');var page=1;var html='';var rowCount=0;var self=this;$.each(this.results,function(index,result){result.end='';result.start='';if(rowCount%self.perRow==0){result.start=' start';}
if(rowCount%self.perRow==self.perRow-1){result.end=' end';}
rowCount++;html+=self.getResultHtml(result,(index*1)+1);if(index%self.perPage==self.perPage-1||index>=self.results.length-1){self.loadedPages[page]=html;html='';page++;rowCount=0;}});this.showResults(this.loadedPages[1],false);};this.buildHtml();};function finishInstagramAuth(){virb.$.gallery.finishInstagramAuth();}
function finishFlickrAuth(){virb.$.gallery.finishFlickrAuth();}
function finishVimeoAuth(){virb.$.gallery.finishVimeoAuth();}
(function($){$.gallery={instagram:{},dribbble:{},flickr:{},vimeo:{},objs:{},init:function(){this.objs.services=$('#media_services_section');this.objs.serviceMedia=$('ul.imported.media');this.objs.virbMedia=$('ul.virb.media');this.attachEvents();},attachEvents:function(){var self=this;$('a.delete-item').bind('delete.collection_item',function(e,result){e.preventDefault();if($(this).data('id')==result&&$(this).data('handler')=='CollectionItem'){self.deleteItem(result);}});$(document).bind('complete.file.uploader',function(event,result){var isReplace=false;if(result.file){isReplace=result.file.data('replace');}
if(result.importing){$.overlay.hideAjaxMessages();}
if(isReplace&&result.type==='image'&&result.relation==='collection'){self.replaceItem(result);}else if((result.type=='image'||result.type=='video')&&result.relation==='collection'){self.processItem(result);}});$(document).bind('add.flash.file.upload',function(event,uid){self.addFileFieldFromFlash(uid);});$('#thumb_large').click(function(){$(this).addClass('selected');$('#thumb_small').removeClass('selected');$('#upload_embed').removeClass('mini');$('#galleryPaginationResults').removeClass('mini');$.gallery.objs.virbMedia.removeClass('mini');$.gallery.objs.serviceMedia.removeClass('mini');$.gallery.order();return false;});$('#thumb_small').click(function(){$(this).addClass('selected');$('#thumb_large').removeClass('selected');$('#upload_embed').addClass('mini');$('#galleryPaginationResults').addClass('mini');$.gallery.objs.virbMedia.addClass('mini');$.gallery.objs.serviceMedia.addClass('mini');$.gallery.order();return false;});$('.regenerate_thumb').live('click',function(){$.gallery.generateThumbnail($(this));return false;});this.attachServiceButtonEvents();$('a.visibility').click(function(e){$.gallery.toggleDribbbleShotVisibility($(this));e.preventDefault();});this.visibilityToggleManager();this.objs.virbMedia.find('a.modify.edit').live('click',function(){$.gallery.objs.virbMedia.find('li').each(function(){$.gallery.saveDetails($(this));});var $li=$(this).closest('li'),pairedId=$li.data('paired-id');$li.find('div.media_edit').show();$changedInput=$('<input>').attr({'name':'data[Build/Gallery][CollectionItem]['+pairedId+'][changed]','class':'changed','type':'hidden','value':'changed'});$changedInput.appendTo($li);return false;});this.objs.virbMedia.find('a.modify.save').live('click',function(){$.gallery.saveDetails($(this).closest('li'));return false;});$('#embed_video a.embed.image').click(function(){$.prompt({title:'Use an image or video from a URL',description:'We support a lot of well-known websites like, Youtube, Vimeo, Flickr.',titleInside:'http://vimeo.com/28388880',callback:function(){$.gallery.getMediaAsset();}});return false;});this.objs.virbMedia.find('a.modify.deleteNew').live('click',function()
{$(this).closest('li').fadeOut(function()
{$(this).find('input.deleted').val('deleted');$.gallery.order();});return false;});this.objs.virbMedia.sortable({items:"li",handle:"span.modify.move",change:function(event,ui){$.gallery.order();},stop:function(event,ui){$.gallery.order();}});$('#refresh_service').click(function(){$.gallery.refreshService($(this));return false;});$('#gallery-format').change(function(){virb.log($('#auto-play-setting input').val());if($(this).val()=='slideshow'){if($('#auto-play-setting input').val()==true||$('#auto-play-setting input').val()==='yes'){$('#lightbox-setting').hide();$('#auto-play-timer-setting').show();}else{$('#lightbox-setting').show();$('#auto-play-timer-setting').hide();}}else{$('#lightbox-setting').show();$('#auto-play-timer-setting').hide();}});},attachServiceButtonEvents:function(){$('a.authorize').unbind();this.objs.services.find('div.vimeo a.authorize').click(function(){window.open('/services/auth/Vimeo',"VimeoAuth",'width=790,height=580,scrollbars=yes');return false;});this.objs.services.find('div.instagram a.authorize').click(function(){window.open('/services/auth/instagram',"InstagramAuth",'width=790,height=580,scrollbars=yes');return false;});this.objs.services.find('div.instagram a.connect').click(function(){$.gallery.loadInstagramPhotos();return false;});this.objs.services.find('div.dribbble a.authorize').click(function(){$.overlay.show({type:'custom',html:$.gallery.getDribbbleHtml(),customClass:'overlay-dribbble'});return false;});this.objs.services.find('div.flickr a.authorize').click(function(){window.open('/services/auth/flickr',"FlickrAuth",'width=790,height=580,scrollbars=yes');return false;});},disableConnectButtons:function(){$('a.authorize').unbind();$('a.authorize').click(function(e){e.preventDefault();});},saveDetails:function($listItem){$listItem.find('div.media_edit').hide();},finishFlickrAuth:function(){this.loadFlickrSets();},loadFlickrSets:function(){$('#media_services_section div.service.flickr').find('p.connected').show().end().find('p.connect_with').hide();var dataObj={model:'Build/FlickrAuth',params:{action:'get','path':'flickr.photosets.getList'}};$.submitAjax(dataObj,{ok:function(result){$.gallery.buildFlickrSets(result);}});},buildFlickrSets:function(result){var html='';var selectedResult='<span>No sets found</span>';this.flickr=result.response;for(var i=0;i<this.flickr.photosets.photoset.length;i++){var set=this.flickr.photosets.photoset[i];html+=this.getSelectOption(i,set.title._content);if(i==0)
selectedResult=set.title._content;}
$('#flickrSetList').html(html).prev().html('<span>'+selectedResult+'</span>');this.objs.services.find('div.flickr a.connect').click(function(){$.gallery.selectFlickrSet();return false;});},selectFlickrSet:function(){$.overlay.ajaxMessage('processing','Connecting set...');var setKey=$('#flickrSetList option:selected').val();var set=this.flickr.photosets.photoset[setKey];tinyMCE.activeEditor.setContent(set.description._content);var dataObj={model:'Build/FlickrAuth',params:{action:'get',path:'flickr.photosets.getPhotos',photoset_id:set.id,extras:'url_o,url_l,url_z,url_m,url_s,url_t,url_sq,media,description'}};$.submitAjax(dataObj,{ok:function(result){$.gallery.displayFlickr(setKey,result);}});},displayFlickr:function(setKey,result){$.overlay.hideAjaxMessages();var photos=result.response.photoset;var set=this.flickr.photosets.photoset[setKey];photos.title=set.title._content;$('#dataImport').val(JSON.stringify(photos));$('#dataPairedType').val('flickr');for(var i=0;i<photos.photo.length;i++){var photo=photos.photo[i];var media={count:i*1+1,type:photo.media,src:photo.url_m,lowsrc:photo.url_t,height:photo.height_m,width:photo.width_m};this.objs.serviceMedia.append(this.getImportHtml(media));}
$('#gallery_format').appendTo('#service_title');$('#pageTitle').addClass('focus').val(set.title._content);$('#pageUrl').addClass('focus').val($.slugify(set.title._content));this.objs.services.find('h3').show().find('.title').html('Your Photos &amp; Videos from "'+set.title._content.truncate(17)+'"');$('#settings_nav').hide();this.objs.services.find('.service').hide();},finishVimeoAuth:function(){this.loadVimeoAlbums();},loadVimeoAlbums:function(){$('#media_services_section div.service.vimeo').find('p.connected').show().end().find('p.connect_with').hide();var dataObj={model:'Build/VimeoAuth',params:{action:'get',format:'json',method:'vimeo.albums.getAll'}};$.submitAjax(dataObj,{ok:function(result){$.gallery.buildVimeoAlbums(result);}});},buildVimeoAlbums:function(result){var html='';var selectedResult='No albums found';this.vimeo=result.response;for(var i=0;i<this.vimeo.albums.album.length;i++){var album=this.vimeo.albums.album[i];html+=this.getSelectOption(i,album.title);if(i==0)
selectedResult=album.title;}
$('#vimeoAlbumList').html(html).prev().html('<span>'+selectedResult+'</span>');this.objs.services.find('div.vimeo a.connect').click(function(){$.gallery.selectVimeoAlbum();return false;});},selectVimeoAlbum:function(){$.overlay.ajaxMessage('processing','Connecting album...');var albumKey=$('#vimeoAlbumList option:selected').val();var album=this.vimeo.albums.album[albumKey];var dataObj={model:'Build/VimeoAuth',params:{action:'get',method:'vimeo.albums.getVideos',album:album.id,format:'json',full_response:true}};$.submitAjax(dataObj,{ok:function(result){$.gallery.displayVimeo(albumKey,result);}});},displayVimeo:function(albumKey,result){$.overlay.hideAjaxMessages();var videos=result.response.videos;var album=this.vimeo.albums.album[albumKey];videos.title=album.title;videos.album_uid=album.id;$('#dataImport').val(JSON.stringify(videos));$('#dataPairedType').val('vimeo');for(var i=0;i<videos.video.length;i++){var video=videos.video[i];var media={count:i*1+1,type:'video',src:this.getVimeoThumb(video,"medium"),lowsrc:this.getVimeoThumb(video,"small"),height:video.height,width:video.width};this.objs.serviceMedia.append(this.getImportHtml(media));}
this.objs.services.find('h3').show().find('.title').html('Your Videos Tracks from "'+album.title.truncate(30)+'"');$('#settings_nav').hide();this.objs.services.find('.service').hide();},getVimeoThumb:function(video,size){switch(size){case"small":return video.thumbnails.thumbnail[0]._content;case"medium":return video.thumbnails.thumbnail[1]._content;case"large":return video.thumbnails.thumbnail[2]._content;}},getSelectOption:function(i,title){var html='';var selected='';if(i==0)
selected=' selected="selected"';html+='<option value="'+i+'"'+selected+'>'+title+'</option>';return html;},getUploadHtml:function(uid){var html='';html+='<li id="uploader-'+uid+'" class="uploader flash waiting" data-percent="0%" data-text="+&nbsp;&nbsp;Photo or Video">';html+='<input type="file" name="data[Build/Gallery]['+this.fileCount+']" class="file" data-type="image,video" data-sizes="collection" data-relation="collection" data-behavior="auto" data-desired-size="crop_240x180" data-page-id="'+virb.config.pageId+'" data-behavior="auto" />';html+='</li>';return html;},getMediaHtml:function(media){var html='';html+='<li class="landscape '+media.type+'">';html+='<p class="actions">';html+='<span class="modify move">move</span>';html+='<a href="#edit" class="modify edit">☰</a>';html+='<a href="#delete" class="modify delete deleteNew alt">×</a>';html+='<span class="modify type '+media.type+'">'+media.type+'</span>';html+='</p>';if(media.type=='video'){html+='<p class="encode_status">';html+='<span class="status encoding"><span class="status_hide">Encoding...</span></span>';html+='<span class="message">Your video is being encoded for optimal playback. Feel free to save the page and continue building.</span>';html+='</p>';}else{html+='<p class="thumbnail">';html+='<img src="'+media.src+'" onload="if($(this).height() >= $(this).width()) $(this).closest(\'li\').addClass(\'portrait\').removeClass(\'landscape\')" />';html+='</p>';}
var hideClass='hide';if(media.hide)
hideClass='';html+='<div id="edit_'+media.type+'_'+media.id+'" class="media_edit '+hideClass+'">';if(media.type!='embed_photo'&&media.type!='embed_video'){html+='<div class="edit_section top">';html+='<img src="'+media.src+'" />';html+='</div>';}
html+='<div class="edit_section">';if(media.type=='video'){html+='<a href="#" class="regenerate_thumb modify" params="{&quot;id&quot;:&quot;'+media.id+'&quot;}">Regenerate random thumbnail</a>';}else if(media.type=='embed_photo'){html+='<input type="hidden" name="data['+media.controller+'][CollectionItem]['+media.item_id+'][url]" value="'+media.original+'" />';}else if(media.type=='embed_video'){html+='<input type="hidden" name="data['+media.controller+'][CollectionItem]['+media.item_id+'][url]" value="'+media.original+'" />';html+='<textarea name="data['+media.controller+'][CollectionItem]['+media.item_id+'][embed]" class="hide" >'+media.embed+'</textarea>';}
html+='<input type="hidden" name="data['+media.controller+'][CollectionItem]['+media.item_id+'][type]" value="'+media.type+'" />';if(media.response){html+='<textarea name="data['+media.controller+'][CollectionItem]['+media.item_id+'][response]" class="hide">'+$.encodeHTML(media.response)+'</textarea>';}
html+='<span class="field"><input type="text" name="data['+media.controller+'][CollectionItem]['+media.item_id+'][title]" class="titleinside" title="Title..." value="'+media.title+'" /></span>';html+='<span class="field"><textarea name="data['+media.controller+'][CollectionItem]['+media.item_id+'][body]" class="titleinside" title="Description..." rows="3" >'+media.body+'</textarea></span>';if(media.type=='video'){html+='<span class="field checkbox"><input name="data['+media.controller+'][CollectionItem]['+media.item_id+'][allow_embed]" type="checkbox" value="yes" class="checkbox" />Allow Embedding</span>';}else{html+='<label>Link this to:</label>';html+='<span class="field"><input name="data['+media.controller+'][CollectionItem]['+media.item_id+'][link]" type="text" class="titleinside" title="http://" value="" /></span>';}
html+='<input name="data['+media.controller+'][CollectionItem]['+media.item_id+'][id]" type="hidden" value="'+media.id+'" />';html+='<input name="data['+media.controller+'][CollectionItem]['+media.item_id+'][item_id]" type="hidden" value="'+media.item_id+'" />';html+='<a href="#save" class="modify save add">Done</a>';html+='</div>';html+='</div>';html+='</li>';return html;},getImportHtml:function(media){var html='';var listClass='landscape';if(media.height>=media.width)
listClass='portrait';if(media.count%6==0&&$('ul.imported.media.mini').length>0)
listClass+=' end';else if(media.count%4==0&&$('ul.imported.media.mini').length<=0)
listClass+=' end';listClass+=' '+media.type;html+='<li class="'+listClass+'">';html+='<p class="actions">';html+='<span class="modify type '+media.type+'">'+media.type+'</span>';html+='</p>';html+='<p class="thumbnail">';html+='<img src="'+media.src+'" lowsrc="'+media.lowsrc+'" />';html+='</p>';html+='</li>';return html;},processItem:function(result){var media={count:1,type:result.type,src:result.url,lowsrc:result.url,height:180,width:240,controller:'Build/Gallery',id:result.id,item_id:result.item_id,title:'',body:''};var $mediaHtml=$(this.getMediaHtml(media)).hide();if(result.flash&&$('#uploader-'+result.uid).length>0){$('#uploader-'+result.uid).replaceWith($mediaHtml.show());}else{$mediaHtml.prependTo($('#media_virb_section ul.virb.media')).fadeIn();}
$mediaHtml.find('.titleinside').attachTitleInside();this.order();},replaceItem:function(result){$('.uploader[data-id="'+result.file.closest('.uploader').data('id')+'"]').removeClass('finished').removeClass('waiting').removeClass('uploading').addClass('upload').closest('li').find('img').attr({src:result.url});},order:function(){$('ul.media').each(function(){var $virbMedia=$(this);var count=1;if($virbMedia.hasClass('imported'))
count=0;$virbMedia.find('li:visible').not('.ui-sortable-helper').each(function(i){var $this=$(this);$this.css({'z-index':998-i});$this.removeClass('end');if(count%6==5&&$virbMedia.hasClass('mini'))
$this.addClass('end');else if(count%3==2&&false==$virbMedia.hasClass('mini'))
$this.addClass('end');count++;});});},orderImport:function(){var $virbMedia=$('ul.imported.media');var count=0;$virbMedia.find('li:visible').not('.ui-sortable-helper').each(function(i){var $this=$(this);$this.css({'z-index':2000-i});$this.removeClass('end');if(count%8==7&&$virbMedia.hasClass('mini'))
$this.addClass('end');else if(count%4==3&&false==$virbMedia.hasClass('mini'))
$this.addClass('end');count++;});},refreshService:function($clickObj){$.overlay.ajaxMessage('processing','Refreshing...');var dataObj={model:'Build/Gallery',params:{id:$clickObj.attr('data-id'),model:$clickObj.attr('data-model'),action:'refresh'}};$.submitAjax(dataObj,{ok:function(){$.overlay.ajaxMessage('success','Your refresh request has been sent successfully.');}});},generateThumbnail:function($clickObj){$.overlay.ajaxMessage('processing','Regenerating thumbnail...');var params=$.parseJSON($clickObj.attr('params'));var dataObj={model:'Build/Gallery',params:{id:params.id,action:'generateThumb'}};$.submitAjax(dataObj,{ok:function(response){response=response.response;var $li=$('div[data-id="'+response.id+'"]').closest('li');if(response.generating_thumbs===true){$.overlay.ajaxMessage('success','We are re-encoding your video to generate thumbnails.');var html='<p class="encode_status">';html+='<span class="status encoding"><span class="status_hide">Encoding...</span></span>';html+='<span class="message">Your video is being encoded for optimal playback. Feel free to save the page and continue building.</span>';html+='</p>';$li.prepend(html);return;}
$li.find('img').attr('src',response.image);$.overlay.ajaxMessage('success','Your thumbnail was regenerated successfully!');}});},getMediaAsset:function(){$.overlay.ajaxMessage('processing','Retrieving link information.');var url=$('#promptValue').val();;if(url==''){$.overlay.ajaxMessage('error','You did not specify a valid URL');return false;}
var dataObj={model:'Build/MediaAsset',params:{url:url,action:'get',import:true,relation:'collection',sizes:'collection',desired_size:'crop_240x180'}};$.submitAjax(dataObj,{ok:function(result){$.overlay.hideAjaxMessages();var uid=$.getUID();var response=result.response;if($.isArray(result.response)){response=result.response[0];}
if(response.media_type&&response.media_type=='image'){$.overlay.ajaxMessage('processing','Importing your media. This usually takes less than a minute.');virb.uploader.trackImport(uid,response);return;}
if(result.response.type!='photo'&&result.response.type!='video'){$.overlay.ajaxMessage('error','We could not find a video or image associated with that link. Please try again.');return false;}
$.gallery.objs.virbMedia.find('li').each(function(){$.gallery.saveDetails($(this));});var media={count:1,type:'embed_'+result.response.type,src:"/_assets/_graphics/_gallery/embedded_image.png",lowsrc:"/_assets/_graphics/_gallery/embedded_image.png",height:180,width:240,controller:'Build/Gallery',id:$.getUID(),item_id:$.getUID(),title:'',body:''};if(result.response.title)
media.title=result.response.title;if(result.response.body)
media.body=result.response.body;if(result.response.model&&result.response.model=='PageImage'){media.id=result.response.id;media.item_id=result.response.item_id;media.type='embed_photo';media.response=JSON.stringify(result.response);media.original=result.response.url;media.src=result.response.url;media.lowsrc=result.response.url;}else if(result.response.oembed){if(result.response.type=='photo'){media.original=result.response.url;media.src=result.response.url;media.lowsrc=result.response.url;}else if(result.response.type=='video'){if(!result.response.thumbnail){$.overlay.ajaxMessage('error','We could not find a video or image associated with that link. Please try again.');return false;}
media.embed=result.response.embed;media.original=result.response.thumbnail;media.src=result.response.thumbnail;media.lowsrc=result.response.thumbnail;}}else if(result.response.type=='photo'||result.response.type=='video'){media.response=JSON.stringify(result.response);media.original=result.response.sizes.original;media.src=result.response.sizes.resize_500;media.lowsrc=result.response.sizes.resize_100;}
var $mediaHtml=$($.gallery.getMediaHtml(media)).hide();$mediaHtml.prependTo($('#media_virb_section ul.virb.media')).fadeIn().find('.titleinside').attachTitleInside();$.gallery.order();}});},finishInstagramAuth:function(){this.loadInstagramPhotos();},loadInstagramPhotos:function(){$.overlay.ajaxMessage('processing','Loading photos...');var dataObj={model:'Build/InstagramAuth',params:{action:'get',path:'/users/self/media/recent',count:50}};$.submitAjax(dataObj,{ok:function(result){$.gallery.displayInstagram(result);}});},displayInstagram:function(result){$.overlay.hideAjaxMessages();var photos=result.response;$('#dataImport').val(JSON.stringify(photos));$('#dataPairedType').val('instagram');for(var i=0;i<photos.data.length;i++){var photo=photos.data[i];var media={count:i*1+1,type:'photo',src:photo.images.low_resolution.url,lowsrc:photo.images.low_resolution.url,height:photo.images.low_resolution.height,width:photo.images.low_resolution.width,};this.objs.serviceMedia.append(this.getImportHtml(media));}
$('#gallery_format').appendTo('#service_title');$('#pageTitle').addClass('focus').val('Instagram');$('#pageUrl').addClass('focus').val('instagram');this.objs.services.find('h3').show().find('.title').html('Your Photos from Instagram');$('#settings_nav').hide();this.objs.services.find('.service').hide();},getDribbbleHtml:function(){var html='';html+='<form action="" id="dribbble-form" method="post" onsubmit="virb.$.gallery.dribbbleConnect(); return false;">';html+='<h1>Enter your Dribbble username</h1>';html+='<span class="field">http://dribbble.com/ <input id="dribbble-username" value="" title="Dribbble username" class="titleinside validate[required]"></span>';html+='<div id="form_submit" class="overlay_footer">';html+='<input type="button" class="modify add big" value="Connect" onclick="virb.$.gallery.dribbbleConnect(); return false;">';html+='</div>';html+='</form>';return html;},dribbbleConnect:function(){var username=$('input#dribbble-username').val();this.dribbble.username=username;$.overlay.hide(true);$.overlay.ajaxMessage('processing','Connecting to Dribbble...');$.gallery.disableConnectButtons();var playerObj={model:'Build/Dribbble',params:{action:'getPlayer',player:username,path:'users/'+username}}
$.submitAjax(playerObj,{ok:function(){$.gallery.requestShots(username);},fail:function(result){$.overlay.ajaxMessage('error',result.message);$.gallery.attachServiceButtonEvents();}});},requestShots:function(username){var shotObj={model:'Build/Dribbble',params:{per_page:60,action:'getShots',path:'users/'+username+'/shots'}}
$.submitAjax(shotObj,{ok:function(result){$.gallery.loadDribbbleShots(result);},fail:function(result){$.overlay.ajaxMessage('error',result.message);$.gallery.attachServiceButtonEvents();}});},loadDribbbleShots:function(result){$.overlay.ajaxMessage('processing','Loading shots...');this.dribbble.shots=result.response;$('#dataImport').val(JSON.stringify(this.dribbble));$('#dataPairedType').val('dribbble');$.overlay.hideAjaxMessages();$('.gallery-settings').css('marginTop','70px').find('ul.options').html($.gallery.getDribbbleSettingsHtml());$('#info-toggle').bind('click',function(e){e.preventDefault();$(this).toggleSlider();});$('#meta-toggle').bind('click',function(e){e.preventDefault();$(this).toggleSlider();});if(result.response.shots<=0){$('ul#dribbble-grid').append('<li class="no_content"><p>You do not have any shots.</p></li>');}else{this.buildDribbbleGrid();}},buildDribbbleGrid:function(){var itemHtml='';for(var i=0;i<this.dribbble.shots.length;i++){itemHtml+=this.getDribbbleItemHtml(i);}
$('ul#dribbble-grid').html(itemHtml);$('#gallery_format').appendTo('#service_title');$('#settings_nav').hide();this.objs.services.find('.service').hide();$('#media-dribbble').show();$('#pageTitle').addClass('focus').val('Dribbble');$('#pageUrl').addClass('focus').val('dribbble');this.objs.services.find('h3').show().find('.title').html('Your Shots from Dribbble');$('a.visibility').click(function(e){$.gallery.toggleDribbbleShotVisibility($(this));e.preventDefault();});$('li textarea.titleinside').attachTitleInside();$('li textarea.titleinside').showTitleInside();},getDribbbleItemHtml:function(index){var endClass='',html='';if(index%6==5){endClass='end';}
html+='<li class="landscape image '+endClass+'">';html+='<input type="hidden" id="item-id" name="data[Build/Gallery][dribbble_item]['+this.dribbble.shots[index].id+'][id]" value="'+this.dribbble.shots[index].id+'">';html+='<input type="hidden" class="visibility" id="item-visibility" name="data[Build/Gallery][dribbble_item]['+this.dribbble.shots[index].id+'][is_visible]" value="">';html+='<p class="actions">';html+='<a href="#edit" class="modify edit image">☰</a>';html+='<a href="#" id="" class="modify toggle visibility on">';html+='<span class="off">hidden</span>';html+='<span class="on">visible</span>';html+='</a>';html+='</p>';html+='<p class="thumbnail"><img src="'+this.dribbble.shots[index].images.normal+'"></p>';html+='<div class="media_edit hide">';html+='<div class="edit_section top">';html+='<p class="title">'+this.dribbble.shots[index].title+'</p>';html+='<span class="field">';html+='<textarea name="data[Build/Gallery][dribbble_item]['+this.dribbble.shots[index].id+'][body]" class="titleinside" title="Add a description..." rows="5"></textarea>';html+='</span>';html+='<a href="#save" class="modify save add">Done</a>';html+='</div>';html+='</div>';html+='</li>';return html;},getDribbbleSettingsHtml:function(){var html='';html+='<li><p>Gallery formats are not currently supported with a Dribbble gallery.</p></li>';html+='<li>';html+='<a class="info right" data-info="Show title and description of your shots">Show shot info</a>';html+='<div class="toggle-switches">';html+='<input type="hidden" name="data[Build/Gallery][show_shot_info]" value="yes"> <a href="#toggle" id="info-toggle" class="modify slider on" data-input="data[Build/Gallery][show_shot_info]" data-status="on" data-submit="yes" name="meta-toggle"><span class="off">off</span> <span class="on">on</span></a>';html+='</div>';html+='</li>';html+='<li>';html+='<a class="info right" data-info="Display individual shot view count, comment count, and more.">Show shot meta</a>';html+='<div class="toggle-switches">';html+='<input type="hidden" name="data[Build/Gallery][show_shot_meta]" value="no"> <a href="#toggle" id="meta-toggle" class="modify slider off" data-input="data[Build/Gallery][show_shot_meta]" data-status="off" data-submit="no" name="meta-toggle"><span class="off">off</span> <span class="on">on</span></a>';html+='</div>';html+='</li>';return html;},toggleDribbbleShotVisibility:function($obj){var hiddenField=$obj.parents('li').find('input.visibility');if($obj.hasClass('off')){$.gallery.hideShots($obj,hiddenField);}else{$.gallery.showShots($obj,hiddenField);}},toggleAllDribbbleShotVisibility:function($obj){var visibilityFields=$('input.visibility'),visibilitySwitches=$('a.visibility');if($obj.hasClass('show-mode')){$obj.removeClass('show-mode').html('Show All');$.gallery.showShots(visibilitySwitches,visibilityFields);}else{$obj.addClass('show-mode').html('Hide All');$.gallery.hideShots(visibilitySwitches,visibilityFields);}},visibilityToggleManager:function(){var activeHiddenFields=$('input.visibility[value="false"]'),toggleButton=$('#show-hide-toggle');if(activeHiddenFields.length>=1){toggleButton.removeClass('show-mode').html('Show All');}
toggleButton.click(function(e){$.gallery.toggleAllDribbbleShotVisibility(toggleButton);e.preventDefault();});},showShots:function($switch,$field){$field.val('false');$switch.removeClass('on').addClass('off');},hideShots:function($switch,$field){$field.val('true');$switch.removeClass('off').addClass('on');},deleteItem:function(id){var self=this,$item=$('#item_'+id).closest('li'),$pairedId=$item.data('paired-id');$item.addClass('deleted').fadeOut(function(){self.order();});$('<input>').attr({class:'deleted',type:'hidden',name:'data[Build/Gallery][CollectionItem]['+$pairedId+'][deleted]',value:'deleted'}).appendTo($item);},addFileFieldFromFlash:function(uid){$.preventNav(true);var $html=$(this.getUploadHtml(uid)).hide();$html.prependTo($('ul.virb.media')).fadeIn();this.order();}};virb.$.gallery=$.gallery;$(function(){$.gallery.init();});})(virb.$);;
/* jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.core.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;return!b.href||!g||f.nodeName.toLowerCase()!=="map"?!1:(h=a("img[usemap=#"+g+"]")[0],!!h&&d(h))}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(a.ui.version)return;a.extend(a.ui,{version:"1.8.23",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function h(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),f&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)}),c}var e=d==="Width"?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?g["inner"+d].call(this):this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return typeof b!="number"?g["outer"+d].call(this,b):this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));c.offsetHeight,a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.curCSS||(a.curCSS=a.css),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!d||!a.element[0].parentNode)return;for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}})})(jQuery);;
/* jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.widget.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&e.charAt(0)==="_"?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b)return h=f,!1}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}})(jQuery);;
/* jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.mouse.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(c)return;this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted)return b.preventDefault(),!0}return!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0},_mouseMove:function(b){return!a.browser.msie||document.documentMode>=9||!!b.button?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})})(jQuery);;
/* jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.slider.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c=5;a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var b=this,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=d.values&&d.values.length||1,h=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(d.disabled?" ui-slider-disabled ui-disabled":"")),this.range=a([]),d.range&&(d.range===!0&&(d.values||(d.values=[this._valueMin(),this._valueMin()]),d.values.length&&d.values.length!==2&&(d.values=[d.values[0],d.values[0]])),this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(d.range==="min"||d.range==="max"?" ui-slider-range-"+d.range:"")));for(var i=e.length;i<g;i+=1)h.push(f);this.handles=e.add(a(h.join("")).appendTo(b.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){d.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){d.disabled?a(this).blur():(a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),a(this).addClass("ui-state-focus"))}).blur(function(){a(this).removeClass("ui-state-focus")}),this.handles.each(function(b){a(this).data("index.ui-slider-handle",b)}),this.handles.keydown(function(d){var e=a(this).data("index.ui-slider-handle"),f,g,h,i;if(b.options.disabled)return;switch(d.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:d.preventDefault();if(!b._keySliding){b._keySliding=!0,a(this).addClass("ui-state-active"),f=b._start(d,e);if(f===!1)return}}i=b.options.step,b.options.values&&b.options.values.length?g=h=b.values(e):g=h=b.value();switch(d.keyCode){case a.ui.keyCode.HOME:h=b._valueMin();break;case a.ui.keyCode.END:h=b._valueMax();break;case a.ui.keyCode.PAGE_UP:h=b._trimAlignValue(g+(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.PAGE_DOWN:h=b._trimAlignValue(g-(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(g===b._valueMax())return;h=b._trimAlignValue(g+i);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(g===b._valueMin())return;h=b._trimAlignValue(g-i)}b._slide(d,e,h)}).keyup(function(c){var d=a(this).data("index.ui-slider-handle");b._keySliding&&(b._keySliding=!1,b._stop(c,d),b._change(c,d),a(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(b){var c=this.options,d,e,f,g,h,i,j,k,l;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),d={x:b.pageX,y:b.pageY},e=this._normValueFromMouse(d),f=this._valueMax()-this._valueMin()+1,h=this,this.handles.each(function(b){var c=Math.abs(e-h.values(b));f>c&&(f=c,g=a(this),i=b)}),c.range===!0&&this.values(1)===c.min&&(i+=1,g=a(this.handles[i])),j=this._start(b,i),j===!1?!1:(this._mouseSliding=!0,h._handleIndex=i,g.addClass("ui-state-active").focus(),k=g.offset(),l=!a(b.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:b.pageX-k.left-g.width()/2,top:b.pageY-k.top-g.height()/2-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,i,e),this._animateOff=!0,!0))},_mouseStart:function(a){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return this.orientation==="horizontal"?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),d<0&&(d=0),this.orientation==="vertical"&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),this.options.values.length===2&&this.options.range===!0&&(b===0&&c>d||b===1&&c<d)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c,!0))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("change",a,c)}},value:function(a){if(arguments.length){this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(b,c){var d,e,f;if(arguments.length>1){this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),this._change(null,b);return}if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();d=this.options.values,e=arguments[0];for(f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments);switch(b){case"disabled":c?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a),a},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b),b;c=this.options.values.slice();for(d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return Math.abs(c)*2>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b=this.options.range,c=this.options,d=this,e=this._animateOff?!1:c.animate,f,g={},h,i,j,k;this.options.values&&this.options.values.length?this.handles.each(function(b,i){f=(d.values(b)-d._valueMin())/(d._valueMax()-d._valueMin())*100,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",a(this).stop(1,1)[e?"animate":"css"](g,c.animate),d.options.range===!0&&(d.orientation==="horizontal"?(b===0&&d.range.stop(1,1)[e?"animate":"css"]({left:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({width:f-h+"%"},{queue:!1,duration:c.animate})):(b===0&&d.range.stop(1,1)[e?"animate":"css"]({bottom:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({height:f-h+"%"},{queue:!1,duration:c.animate}))),h=f}):(i=this.value(),j=this._valueMin(),k=this._valueMax(),f=k!==j?(i-j)/(k-j)*100:0,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",this.handle.stop(1,1)[e?"animate":"css"](g,c.animate),b==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[e?"animate":"css"]({width:f+"%"},c.animate),b==="max"&&this.orientation==="horizontal"&&this.range[e?"animate":"css"]({width:100-f+"%"},{queue:!1,duration:c.animate}),b==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[e?"animate":"css"]({height:f+"%"},c.animate),b==="max"&&this.orientation==="vertical"&&this.range[e?"animate":"css"]({height:100-f+"%"},{queue:!1,duration:c.animate}))}}),a.extend(a.ui.slider,{version:"1.8.23"})})(jQuery);;
/* jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.draggable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(b),this.handle?(c.iframeFix&&a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),c.containment&&this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute");if(!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=!1;a.ui.ddmanager&&!this.options.dropBehaviour&&(c=a.ui.ddmanager.drop(this,b)),this.dropped&&(c=this.dropped,this.dropped=!1);var d=this.element[0],e=!1;while(d&&(d=d.parentNode))d==document&&(e=!0);if(!e&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var f=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){f._trigger("stop",b)!==!1&&f._clear()})}else this._trigger("stop",b)!==!1&&this._clear();return!1},_mouseUp:function(b){return this.options.iframeFix===!0&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){var c=!this.options.handle||!a(this.options.handle,this.element).length?!0:!1;return a(this.options.handle,this.element).find("*").andSelf().each(function(){this==b.target&&(c=!0)}),c},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):c.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo),d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[b.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,b.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(b.containment=="document"?0:a(window).scrollLeft())+a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(b.containment=="document"?0:a(window).scrollTop())+(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)&&b.containment.constructor!=Array){var c=a(b.containment),d=c[0];if(!d)return;var e=c.offset(),f=a(d).css("overflow")!="hidden";this.containment=[(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0),(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0),(f?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(f?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}else b.containment.constructor==Array&&(this.containment=b.containment)},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName),f=b.pageX,g=b.pageY;if(this.originalPosition){var h;if(this.containment){if(this.relative_container){var i=this.relative_container.offset();h=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]}else h=this.containment;b.pageX-this.offset.click.left<h[0]&&(f=h[0]+this.offset.click.left),b.pageY-this.offset.click.top<h[1]&&(g=h[1]+this.offset.click.top),b.pageX-this.offset.click.left>h[2]&&(f=h[2]+this.offset.click.left),b.pageY-this.offset.click.top>h[3]&&(g=h[3]+this.offset.click.top)}if(c.grid){var j=c.grid[1]?this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY;g=h?j-this.offset.click.top<h[1]||j-this.offset.click.top>h[3]?j-this.offset.click.top<h[1]?j+c.grid[1]:j-c.grid[1]:j:j;var k=c.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0]:this.originalPageX;f=h?k-this.offset.click.left<h[0]||k-this.offset.click.left>h[2]?k-this.offset.click.left<h[0]?k+c.grid[0]:k-c.grid[0]:k:k}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),b=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(a){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.extend(a.ui.draggable,{version:"1.8.23"}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,d.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("draggable"),e=this,f=function(b){var c=this.offset.click.top,d=this.offset.click.left,e=this.positionAbs.top,f=this.positionAbs.left,g=b.height,h=b.width,i=b.top,j=b.left;return a.ui.isOver(e+c,f+d,i,j,g,h)};a.each(d.sortables,function(f){this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c){var d=a("body"),e=a(this).data("draggable").options;d.css("cursor")&&(e._cursor=d.css("cursor")),d.css("cursor",e.cursor)},stop:function(b,c){var d=a(this).data("draggable").options;d._cursor&&a("body").css("cursor",d._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(b,c){var d=a(this).data("draggable");d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"&&(d.overflowOffset=d.scrollParent.offset())},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=!1;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"){if(!e.axis||e.axis!="x")d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<e.scrollSensitivity?d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop-e.scrollSpeed);if(!e.axis||e.axis!="y")d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<e.scrollSensitivity?d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft-e.scrollSpeed)}else{if(!e.axis||e.axis!="x")b.pageY-a(document).scrollTop()<e.scrollSensitivity?f=a(document).scrollTop(a(document).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<e.scrollSensitivity&&(f=a(document).scrollTop(a(document).scrollTop()+e.scrollSpeed));if(!e.axis||e.axis!="y")b.pageX-a(document).scrollLeft()<e.scrollSensitivity?f=a(document).scrollLeft(a(document).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<e.scrollSensitivity&&(f=a(document).scrollLeft(a(document).scrollLeft()+e.scrollSpeed))}f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c){var d=a(this).data("draggable"),e=d.options;d.snapElements=[],a(e.snap.constructor!=String?e.snap.items||":data(draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!=d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=e.snapTolerance,g=c.offset.left,h=g+d.helperProportions.width,i=c.offset.top,j=i+d.helperProportions.height;for(var k=d.snapElements.length-1;k>=0;k--){var l=d.snapElements[k].left,m=l+d.snapElements[k].width,n=d.snapElements[k].top,o=n+d.snapElements[k].height;if(!(l-f<g&&g<m+f&&n-f<i&&i<o+f||l-f<g&&g<m+f&&n-f<j&&j<o+f||l-f<h&&h<m+f&&n-f<i&&i<o+f||l-f<h&&h<m+f&&n-f<j&&j<o+f)){d.snapElements[k].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=!1;continue}if(e.snapMode!="inner"){var p=Math.abs(n-j)<=f,q=Math.abs(o-i)<=f,r=Math.abs(l-h)<=f,s=Math.abs(m-g)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n-d.helperProportions.height,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l-d.helperProportions.width}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m}).left-d.margins.left)}var t=p||q||r||s;if(e.snapMode!="outer"){var p=Math.abs(n-i)<=f,q=Math.abs(o-j)<=f,r=Math.abs(l-g)<=f,s=Math.abs(m-h)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o-d.helperProportions.height,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m-d.helperProportions.width}).left-d.margins.left)}!d.snapElements[k].snapping&&(p||q||r||s||t)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=p||q||r||s||t}}}),a.ui.plugin.add("draggable","stack",{start:function(b,c){var d=a(this).data("draggable").options,e=a.makeArray(a(d.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});if(!e.length)return;var f=parseInt(e[0].style.zIndex)||0;a(e).each(function(a){this.style.zIndex=f+a}),this[0].style.zIndex=f+e.length}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})})(jQuery);;
/* jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.droppable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var b=this.options,c=b.accept;this.isover=0,this.isout=1,this.accept=a.isFunction(c)?c:function(a){return a.is(c)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},a.ui.ddmanager.droppables[b.scope]=a.ui.ddmanager.droppables[b.scope]||[],a.ui.ddmanager.droppables[b.scope].push(this),b.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];for(var c=0;c<b.length;c++)b[c]==this&&b.splice(c,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(b,c){b=="accept"&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return;this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return;this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current;if(!d||(d.currentItem||d.element)[0]==this.element[0])return!1;var e=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"droppable");if(b.options.greedy&&!b.options.disabled&&b.options.scope==d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance))return e=!0,!1}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.extend(a.ui.droppable,{version:"1.8.23"}),a.ui.intersect=function(b,c,d){if(!c.offset)return!1;var e=(b.positionAbs||b.position.absolute).left,f=e+b.helperProportions.width,g=(b.positionAbs||b.position.absolute).top,h=g+b.helperProportions.height,i=c.offset.left,j=i+c.proportions.width,k=c.offset.top,l=k+c.proportions.height;switch(d){case"fit":return i<=e&&f<=j&&k<=g&&h<=l;case"intersect":return i<e+b.helperProportions.width/2&&f-b.helperProportions.width/2<j&&k<g+b.helperProportions.height/2&&h-b.helperProportions.height/2<l;case"pointer":var m=(b.positionAbs||b.position.absolute).left+(b.clickOffset||b.offset.click).left,n=(b.positionAbs||b.position.absolute).top+(b.clickOffset||b.offset.click).top,o=a.ui.isOver(n,m,k,i,c.proportions.height,c.proportions.width);return o;case"touch":return(g>=k&&g<=l||h>=k&&h<=l||g<k&&h>l)&&(e>=i&&e<=j||f>=i&&f<=j||e<i&&f>j);default:return!1}},a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d=a.ui.ddmanager.droppables[b.options.scope]||[],e=c?c.type:null,f=(b.currentItem||b.element).find(":data(droppable)").andSelf();g:for(var h=0;h<d.length;h++){if(d[h].options.disabled||b&&!d[h].accept.call(d[h].element[0],b.currentItem||b.element))continue;for(var i=0;i<f.length;i++)if(f[i]==d[h].element[0]){d[h].proportions.height=0;continue g}d[h].visible=d[h].element.css("display")!="none";if(!d[h].visible)continue;e=="mousedown"&&d[h]._activate.call(d[h],c),d[h].offset=d[h].element.offset(),d[h].proportions={width:d[h].element[0].offsetWidth,height:d[h].element[0].offsetHeight}}},drop:function(b,c){var d=!1;return a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,c))}),d},dragStart:function(b,c){b.element.parents(":not(body,html)").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var d=a.ui.intersect(b,this,this.options.tolerance),e=!d&&this.isover==1?"isout":d&&this.isover==0?"isover":null;if(!e)return;var f;if(this.options.greedy){var g=this.element.parents(":data(droppable):eq(0)");g.length&&(f=a.data(g[0],"droppable"),f.greedyChild=e=="isover"?1:0)}f&&e=="isover"&&(f.isover=0,f.isout=1,f._out.call(f,c)),this[e]=1,this[e=="isout"?"isover":"isout"]=0,this[e=="isover"?"_over":"_out"].call(this,c),f&&e=="isout"&&(f.isout=0,f.isover=1,f._over.call(f,c))})},dragStop:function(b,c){b.element.parents(":not(body,html)").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}})(jQuery);;
/* jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.sortable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?a.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},destroy:function(){a.Widget.prototype.destroy.call(this),this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var b=this.items.length-1;b>=0;b--)this.items[b].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){b==="disabled"?(this.options[b]=c,this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(b);var e=null,f=this,g=a(b.target).parents().each(function(){if(a.data(this,d.widgetName+"-item")==f)return e=a(this),!1});a.data(b.target,d.widgetName+"-item")==f&&(e=a(b.target));if(!e)return!1;if(this.options.handle&&!c){var h=!1;a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(h=!0)});if(!h)return!1}return this.currentItem=e,this._removeCurrentsFromItems(),!0},_mouseStart:function(b,c,d){var e=this.options,f=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),e.containment&&this._setContainment(),e.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",e.cursor)),e.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",e.opacity)),e.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",e.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!d)for(var g=this.containers.length-1;g>=0;g--)this.containers[g]._trigger("activate",b,f._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var c=this.options,d=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],g=f.item[0],h=this._intersectsWithPointer(f);if(!h)continue;if(g!=this.currentItem[0]&&this.placeholder[h==1?"next":"prev"]()[0]!=g&&!a.ui.contains(this.placeholder[0],g)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],g):!0)){this.direction=h==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(f))this._rearrange(b,f);else break;this._trigger("change",b,this._uiHash());break}}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(!b)return;a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b);if(this.options.revert){var d=this,e=d.placeholder.offset();d.reverting=!0,a(this.helper).animate({left:e.left-this.offset.parent.left-d.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-d.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1},cancel:function(){var b=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--)this.containers[c]._trigger("deactivate",null,b._uiHash(this)),this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",null,b._uiHash(this)),this.containers[c].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l=d+j>h&&d+j<i&&b+k>f&&b+k<g;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c=this.options.axis==="x"||a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height),d=this.options.axis==="y"||a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&g=="right"||f=="down"?2:1:f&&(f=="down"?2:1):!1},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?f=="right"&&d||f=="left"&&!d:e&&(e=="down"&&c||e=="up"&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return a!=0&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return a!=0&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=this,d=[],e=[],f=this._connectWith();if(f&&b)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&e.push([a.isFunction(j.options.items)?j.options.items.call(j.element):a(j.options.items,j.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),j])}}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var g=e.length-1;g>=0;g--)e[g][0].each(function(){d.push(this)});return a(d)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");for(var b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,d=this,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],f=this._connectWith();if(f&&this.ready)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&(e.push([a.isFunction(j.options.items)?j.options.items.call(j.element[0],b,{item:this.currentItem}):a(j.options.items,j.element),j]),this.containers.push(j))}}for(var g=e.length-1;g>=0;g--){var k=e[g][1],l=e[g][0];for(var i=0,m=l.length;i<m;i++){var n=a(l[i]);n.data(this.widgetName+"-item",k),c.push({item:n,instance:k,width:0,height:0,left:0,top:0})}}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var d=this.items[c];if(d.instance!=this.currentContainer&&this.currentContainer&&d.item[0]!=this.currentItem[0])continue;var e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item;b||(d.width=e.outerWidth(),d.height=e.outerHeight());var f=e.offset();d.left=f.left,d.top=f.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var c=this.containers.length-1;c>=0;c--){var f=this.containers[c].element.offset();this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(b){var c=b||this,d=c.options;if(!d.placeholder||d.placeholder.constructor==String){var e=d.placeholder;d.placeholder={element:function(){var b=a(document.createElement(c.currentItem[0].nodeName)).addClass(e||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return e||(b.style.visibility="hidden"),b},update:function(a,b){if(e&&!d.forcePlaceholderSize)return;b.height()||b.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}c.placeholder=a(d.placeholder.element.call(c.element,c.currentItem)),c.currentItem.after(c.placeholder),d.placeholder.update(c,c.placeholder)},_contactContainers:function(b){var c=null,d=null;for(var e=this.containers.length-1;e>=0;e--){if(a.ui.contains(this.currentItem[0],this.containers[e].element[0]))continue;if(this._intersectsWith(this.containers[e].containerCache)){if(c&&a.ui.contains(this.containers[e].element[0],c.element[0]))continue;c=this.containers[e],d=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0)}if(!c)return;if(this.containers.length===1)this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1;else if(this.currentContainer!=this.containers[d]){var f=1e4,g=null,h=this.positionAbs[this.containers[d].floating?"left":"top"];for(var i=this.items.length-1;i>=0;i--){if(!a.ui.contains(this.containers[d].element[0],this.items[i].item[0]))continue;var j=this.containers[d].floating?this.items[i].item.offset().left:this.items[i].item.offset().top;Math.abs(j-h)<f&&(f=Math.abs(j-h),g=this.items[i],this.direction=j-h>0?"down":"up")}if(!g&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[d],g?this._rearrange(b,g,null,!0):this._rearrange(b,null,this.containers[d].element,!0),this._trigger("change",b,this._uiHash()),this.containers[d]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem;return d.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(d[0].style.width==""||c.forceHelperSize)&&d.width(this.currentItem.width()),(d[0].style.height==""||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0],d=a(b.containment).offset(),e=a(c).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var f=b.pageX,g=b.pageY;if(this.originalPosition){this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top));if(c.grid){var h=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h;var i=this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+c.grid[0]:i-c.grid[0]:i:i}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this,f=this.counter;window.setTimeout(function(){f==e.counter&&e.refreshPositions(!d)},0)},_clear:function(b,c){this.reverting=!1;var d=[],e=this;!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var f in this._storedCSS)if(this._storedCSS[f]=="auto"||this._storedCSS[f]=="static")this._storedCSS[f]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c&&d.push(function(a){this._trigger("update",a,this._uiHash())});if(!a.ui.contains(this.element[0],this.currentItem[0])){c||d.push(function(a){this._trigger("remove",a,this._uiHash())});for(var f=this.containers.length-1;f>=0;f--)a.ui.contains(this.containers[f].element[0],this.currentItem[0])&&!c&&(d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.containers[f])),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.containers[f])))}for(var f=this.containers.length-1;f>=0;f--)c||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!1}c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!c){for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.extend(a.ui.sortable,{version:"1.8.23"})})(jQuery);;